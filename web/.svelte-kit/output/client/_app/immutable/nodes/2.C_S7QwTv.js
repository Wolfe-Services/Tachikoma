import{y as at,s as ct,n as tt,c as et}from"../chunks/C-NO07ga.js";import{S as ut,i as dt,d as v,s as q,a as Q,b as c,y as ft,m as _,c as h,e as y,z as A,g as I,f as E,h as p,j as b,t as j,A as ht}from"../chunks/B-eSy4nV.js";import{d as it,w as pt}from"../chunks/jsLhJHwu.js";function st(n){return n?.length!==void 0?n:Array.from(n)}class gt extends Error{constructor(t,e,o){super(t),this.channel=e,this.originalError=o,this.name="IpcError"}}function mt(n,t){const e=t instanceof Error?t.message:String(t);return console.error(`IPC Error on channel '${n}':`,t),new gt(`IPC call failed: ${e}`,n,t)}function nt(){return typeof window<"u"&&!!window.tachikoma}class vt{listeners=new Map;async invoke(t,e){if(!nt())throw new Error("Tachikoma IPC not available");try{return window.tachikoma.invoke(t,e)}catch(o){throw mt(t,o)}}on(t,e){return nt()?(this.listeners.has(t)||this.listeners.set(t,new Set),this.listeners.get(t).add(e),window.tachikoma.on(t,e),()=>{this.listeners.get(t)?.delete(e),window.tachikoma.off(t,e)}):()=>{}}}const D=new vt;function wt(){const{subscribe:n,set:t,update:e}=pt({current:null,logs:[],loading:!1,error:null});return{subscribe:n,async start(o,u,l){e(s=>({...s,loading:!0,error:null}));try{const{missionId:s}=await D.invoke("mission:start",{specPath:o,backend:u,mode:l}),r=await D.invoke("mission:status",{missionId:s});return e(i=>({...i,current:r,loading:!1})),s}catch(s){throw e(r=>({...r,loading:!1,error:String(s)})),s}},async stop(){const o=at({subscribe:n});o.current&&(await D.invoke("mission:stop",{missionId:o.current.id}),e(u=>({...u,current:null})))},addLog(o,u){e(l=>({...l,logs:[...l.logs.slice(-99),{level:o,message:u,timestamp:new Date}]}))},clear(){t({current:null,logs:[],loading:!1,error:null})}}}const W=wt(),_t=it(W,n=>n.current?.state==="running"),Ct=it(W,n=>n.current?.progress??0);function lt(n,t,e){const o=n.slice();return o[5]=t[e],o}function rt(n){let t,e,o="Test Results:",u,l=st(n[1]),s=[];for(let r=0;r<l.length;r+=1)s[r]=ot(lt(n,l,r));return{c(){t=p("div"),e=p("h2"),e.textContent=o,u=b();for(let r=0;r<s.length;r+=1)s[r].c();this.h()},l(r){t=h(r,"DIV",{class:!0});var i=y(t);e=h(i,"H2",{class:!0,"data-svelte-h":!0}),A(e)!=="svelte-138hrta"&&(e.textContent=o),u=I(i);for(let a=0;a<s.length;a+=1)s[a].l(i);i.forEach(v),this.h()},h(){_(e,"class","svelte-1cj8r9l"),_(t,"class","test-results svelte-1cj8r9l")},m(r,i){Q(r,t,i),c(t,e),c(t,u);for(let a=0;a<s.length;a+=1)s[a]&&s[a].m(t,null)},p(r,i){if(i&2){l=st(r[1]);let a;for(a=0;a<l.length;a+=1){const C=lt(r,l,a);s[a]?s[a].p(C,i):(s[a]=ot(C),s[a].c(),s[a].m(t,null))}for(;a<s.length;a+=1)s[a].d(1);s.length=l.length}},d(r){r&&v(t),ht(s,r)}}}function ot(n){let t,e=n[5]+"",o;return{c(){t=p("div"),o=j(e),this.h()},l(u){t=h(u,"DIV",{class:!0});var l=y(t);o=E(l,e),l.forEach(v),this.h()},h(){_(t,"class","test-result svelte-1cj8r9l")},m(u,l){Q(u,t,l),c(t,o)},p(u,l){l&2&&e!==(e=u[5]+"")&&q(o,e)},d(u){u&&v(t)}}}function kt(n){let t,e,o="Tachikoma",u,l,s="Your squad of tireless AI coders",r,i,a,C,N,m,k,X="Test IPC Bridge",z,M,w,P,Z="Mission Status",L,S,O,V,U,x,Y,B,F,G,$,d=n[1].length>0&&rt(n);return{c(){t=p("main"),e=p("h1"),e.textContent=o,u=b(),l=p("p"),l.textContent=s,r=b(),i=p("p"),a=j("Running on: "),C=j(n[0]),N=b(),m=p("div"),k=p("button"),k.textContent=X,z=b(),d&&d.c(),M=b(),w=p("div"),P=p("h2"),P.textContent=Z,L=b(),S=p("p"),O=j("Running: "),V=j(n[2]),U=b(),x=p("p"),Y=j("Progress: "),B=j(n[3]),F=j("%"),this.h()},l(g){t=h(g,"MAIN",{class:!0});var f=y(t);e=h(f,"H1",{class:!0,"data-svelte-h":!0}),A(e)!=="svelte-3a5jxj"&&(e.textContent=o),u=I(f),l=h(f,"P",{"data-svelte-h":!0}),A(l)!=="svelte-eyy3n3"&&(l.textContent=s),r=I(f),i=h(f,"P",{class:!0});var J=y(i);a=E(J,"Running on: "),C=E(J,n[0]),J.forEach(v),N=I(f),m=h(f,"DIV",{class:!0});var T=y(m);k=h(T,"BUTTON",{class:!0,"data-svelte-h":!0}),A(k)!=="svelte-lndkln"&&(k.textContent=X),z=I(T),d&&d.l(T),M=I(T),w=h(T,"DIV",{class:!0});var R=y(w);P=h(R,"H2",{class:!0,"data-svelte-h":!0}),A(P)!=="svelte-11dwjby"&&(P.textContent=Z),L=I(R),S=h(R,"P",{});var K=y(S);O=E(K,"Running: "),V=E(K,n[2]),K.forEach(v),U=I(R),x=h(R,"P",{});var H=y(x);Y=E(H,"Progress: "),B=E(H,n[3]),F=E(H,"%"),H.forEach(v),R.forEach(v),T.forEach(v),f.forEach(v),this.h()},h(){_(e,"class","svelte-1cj8r9l"),_(i,"class","platform svelte-1cj8r9l"),_(k,"class","test-button svelte-1cj8r9l"),_(P,"class","svelte-1cj8r9l"),_(w,"class","mission-status svelte-1cj8r9l"),_(m,"class","test-section svelte-1cj8r9l"),_(t,"class","svelte-1cj8r9l")},m(g,f){Q(g,t,f),c(t,e),c(t,u),c(t,l),c(t,r),c(t,i),c(i,a),c(i,C),c(t,N),c(t,m),c(m,k),c(m,z),d&&d.m(m,null),c(m,M),c(m,w),c(w,P),c(w,L),c(w,S),c(S,O),c(S,V),c(w,U),c(w,x),c(x,Y),c(x,B),c(x,F),G||($=ft(k,"click",n[4]),G=!0)},p(g,[f]){f&1&&q(C,g[0]),g[1].length>0?d?d.p(g,f):(d=rt(g),d.c(),d.m(m,M)):d&&(d.d(1),d=null),f&4&&q(V,g[2]),f&8&&q(B,g[3])},i:tt,o:tt,d(g){g&&v(t),d&&d.d(),G=!1,$()}}}function It(n,t,e){let o,u;et(n,_t,i=>e(2,o=i)),et(n,Ct,i=>e(3,u=i));let l="unknown",s=[];typeof window<"u"&&window.tachikoma&&(l=window.tachikoma.platform);async function r(){e(1,s=["Testing IPC Bridge..."]);try{const i=await D.invoke("config:get",{});e(1,s=[...s,`✓ Config loaded: ${i.backend.brain}`]);const a=await D.invoke("spec:list",{});e(1,s=[...s,`✓ Specs listed: ${a.length} found`]);const C=await W.start("/test/path","claude","attended");e(1,s=[...s,`✓ Mission started: ${C}`]),e(1,s=[...s,"✅ All IPC tests passed!"])}catch(i){e(1,s=[...s,`❌ Test failed: ${i}`])}}return[l,s,o,u,r]}class yt extends ut{constructor(t){super(),dt(this,t,It,kt,ct,{})}}export{yt as component};
