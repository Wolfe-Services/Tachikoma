{"version":3,"file":"2.C_S7QwTv.js","sources":["../../../../../../node_modules/svelte/src/runtime/internal/each.js","../../../../../../src/lib/ipc/errors.ts","../../../../../../src/lib/ipc/client.ts","../../../../../../src/lib/stores/mission.ts","../../../../../../src/routes/+page.svelte"],"sourcesContent":["import { transition_in, transition_out } from './transitions.js';\nimport { run_all } from './utils.js';\n\n// general each functions:\n\nexport function ensure_array_like(array_like_or_iterator) {\n\treturn array_like_or_iterator?.length !== undefined\n\t\t? array_like_or_iterator\n\t\t: Array.from(array_like_or_iterator);\n}\n\n// keyed each functions:\n\n/** @returns {void} */\nexport function destroy_block(block, lookup) {\n\tblock.d(1);\n\tlookup.delete(block.key);\n}\n\n/** @returns {void} */\nexport function outro_and_destroy_block(block, lookup) {\n\ttransition_out(block, 1, 1, () => {\n\t\tlookup.delete(block.key);\n\t});\n}\n\n/** @returns {void} */\nexport function fix_and_destroy_block(block, lookup) {\n\tblock.f();\n\tdestroy_block(block, lookup);\n}\n\n/** @returns {void} */\nexport function fix_and_outro_and_destroy_block(block, lookup) {\n\tblock.f();\n\toutro_and_destroy_block(block, lookup);\n}\n\n/** @returns {any[]} */\nexport function update_keyed_each(\n\told_blocks,\n\tdirty,\n\tget_key,\n\tdynamic,\n\tctx,\n\tlist,\n\tlookup,\n\tnode,\n\tdestroy,\n\tcreate_each_block,\n\tnext,\n\tget_context\n) {\n\tlet o = old_blocks.length;\n\tlet n = list.length;\n\tlet i = o;\n\tconst old_indexes = {};\n\twhile (i--) old_indexes[old_blocks[i].key] = i;\n\tconst new_blocks = [];\n\tconst new_lookup = new Map();\n\tconst deltas = new Map();\n\tconst updates = [];\n\ti = n;\n\twhile (i--) {\n\t\tconst child_ctx = get_context(ctx, list, i);\n\t\tconst key = get_key(child_ctx);\n\t\tlet block = lookup.get(key);\n\t\tif (!block) {\n\t\t\tblock = create_each_block(key, child_ctx);\n\t\t\tblock.c();\n\t\t} else if (dynamic) {\n\t\t\t// defer updates until all the DOM shuffling is done\n\t\t\tupdates.push(() => block.p(child_ctx, dirty));\n\t\t}\n\t\tnew_lookup.set(key, (new_blocks[i] = block));\n\t\tif (key in old_indexes) deltas.set(key, Math.abs(i - old_indexes[key]));\n\t}\n\tconst will_move = new Set();\n\tconst did_move = new Set();\n\t/** @returns {void} */\n\tfunction insert(block) {\n\t\ttransition_in(block, 1);\n\t\tblock.m(node, next);\n\t\tlookup.set(block.key, block);\n\t\tnext = block.first;\n\t\tn--;\n\t}\n\twhile (o && n) {\n\t\tconst new_block = new_blocks[n - 1];\n\t\tconst old_block = old_blocks[o - 1];\n\t\tconst new_key = new_block.key;\n\t\tconst old_key = old_block.key;\n\t\tif (new_block === old_block) {\n\t\t\t// do nothing\n\t\t\tnext = new_block.first;\n\t\t\to--;\n\t\t\tn--;\n\t\t} else if (!new_lookup.has(old_key)) {\n\t\t\t// remove old block\n\t\t\tdestroy(old_block, lookup);\n\t\t\to--;\n\t\t} else if (!lookup.has(new_key) || will_move.has(new_key)) {\n\t\t\tinsert(new_block);\n\t\t} else if (did_move.has(old_key)) {\n\t\t\to--;\n\t\t} else if (deltas.get(new_key) > deltas.get(old_key)) {\n\t\t\tdid_move.add(new_key);\n\t\t\tinsert(new_block);\n\t\t} else {\n\t\t\twill_move.add(old_key);\n\t\t\to--;\n\t\t}\n\t}\n\twhile (o--) {\n\t\tconst old_block = old_blocks[o];\n\t\tif (!new_lookup.has(old_block.key)) destroy(old_block, lookup);\n\t}\n\twhile (n) insert(new_blocks[n - 1]);\n\trun_all(updates);\n\treturn new_blocks;\n}\n\n/** @returns {void} */\nexport function validate_each_keys(ctx, list, get_context, get_key) {\n\tconst keys = new Map();\n\tfor (let i = 0; i < list.length; i++) {\n\t\tconst key = get_key(get_context(ctx, list, i));\n\t\tif (keys.has(key)) {\n\t\t\tlet value = '';\n\t\t\ttry {\n\t\t\t\tvalue = `with value '${String(key)}' `;\n\t\t\t} catch (e) {\n\t\t\t\t// can't stringify\n\t\t\t}\n\t\t\tthrow new Error(\n\t\t\t\t`Cannot have duplicate keys in a keyed each: Keys at index ${keys.get(\n\t\t\t\t\tkey\n\t\t\t\t)} and ${i} ${value}are duplicates`\n\t\t\t);\n\t\t}\n\t\tkeys.set(key, i);\n\t}\n}\n","export class IpcError extends Error {\n  constructor(\n    message: string,\n    public channel: string,\n    public originalError?: unknown\n  ) {\n    super(message);\n    this.name = 'IpcError';\n  }\n}\n\nexport function handleIpcError(channel: string, error: unknown): IpcError {\n  const message = error instanceof Error ? error.message : String(error);\n  console.error(`IPC Error on channel '${channel}':`, error);\n  return new IpcError(`IPC call failed: ${message}`, channel, error);\n}\n\nexport function isIpcAvailable(): boolean {\n  return typeof window !== 'undefined' && !!window.tachikoma;\n}","import type { IpcChannels, IpcEvents } from './types';\nimport { handleIpcError, isIpcAvailable } from './errors';\n\nclass TachikomaIpc {\n  private listeners = new Map<string, Set<Function>>();\n\n  async invoke<K extends keyof IpcChannels>(\n    channel: K,\n    request: IpcChannels[K]['request']\n  ): Promise<IpcChannels[K]['response']> {\n    if (!isIpcAvailable()) {\n      throw new Error('Tachikoma IPC not available');\n    }\n    \n    try {\n      return window.tachikoma.invoke(channel, request) as Promise<IpcChannels[K]['response']>;\n    } catch (error) {\n      throw handleIpcError(channel, error);\n    }\n  }\n\n  on<K extends keyof IpcEvents>(\n    channel: K,\n    callback: (data: IpcEvents[K]) => void\n  ): () => void {\n    if (!isIpcAvailable()) {\n      return () => {};\n    }\n\n    if (!this.listeners.has(channel)) {\n      this.listeners.set(channel, new Set());\n    }\n    this.listeners.get(channel)!.add(callback);\n\n    window.tachikoma.on(channel, callback as any);\n\n    // Return unsubscribe function\n    return () => {\n      this.listeners.get(channel)?.delete(callback);\n      window.tachikoma.off(channel, callback as any);\n    };\n  }\n}\n\nexport const ipc = new TachikomaIpc();","import { writable, derived, get } from 'svelte/store';\nimport { ipc } from '$lib/ipc/client';\nimport type { MissionStatus } from '$lib/ipc/types';\n\ninterface MissionState {\n  current: MissionStatus | null;\n  logs: Array<{ level: string; message: string; timestamp: Date }>;\n  loading: boolean;\n  error: string | null;\n}\n\nfunction createMissionStore() {\n  const { subscribe, set, update } = writable<MissionState>({\n    current: null,\n    logs: [],\n    loading: false,\n    error: null\n  });\n\n  return {\n    subscribe,\n\n    async start(specPath: string, backend: string, mode: 'attended' | 'unattended') {\n      update(s => ({ ...s, loading: true, error: null }));\n      try {\n        const { missionId } = await ipc.invoke('mission:start', { specPath, backend, mode });\n        const status = await ipc.invoke('mission:status', { missionId });\n        update(s => ({ ...s, current: status, loading: false }));\n        return missionId;\n      } catch (e) {\n        update(s => ({ ...s, loading: false, error: String(e) }));\n        throw e;\n      }\n    },\n\n    async stop() {\n      const state = get({ subscribe });\n      if (state.current) {\n        await ipc.invoke('mission:stop', { missionId: state.current.id });\n        update(s => ({ ...s, current: null }));\n      }\n    },\n\n    addLog(level: string, message: string) {\n      update(s => ({\n        ...s,\n        logs: [...s.logs.slice(-99), { level, message, timestamp: new Date() }]\n      }));\n    },\n\n    clear() {\n      set({ current: null, logs: [], loading: false, error: null });\n    }\n  };\n}\n\nexport const missionStore = createMissionStore();\n\n// Derived stores\nexport const isRunning = derived(missionStore, $m => $m.current?.state === 'running');\nexport const progress = derived(missionStore, $m => $m.current?.progress ?? 0);","<script lang=\"ts\">\n  import { onMount } from 'svelte';\n  import { missionStore, isRunning, progress } from '$lib/stores/mission';\n  import { ipc } from '$lib/ipc';\n  \n  let platform = 'unknown';\n  let testResults: string[] = [];\n\n  if (typeof window !== 'undefined' && window.tachikoma) {\n    platform = window.tachikoma.platform;\n  }\n\n  async function testIpc() {\n    testResults = ['Testing IPC Bridge...'];\n    \n    try {\n      // Test config\n      const config = await ipc.invoke('config:get', {});\n      testResults = [...testResults, `✓ Config loaded: ${config.backend.brain}`];\n      \n      // Test spec list\n      const specs = await ipc.invoke('spec:list', {});\n      testResults = [...testResults, `✓ Specs listed: ${specs.length} found`];\n      \n      // Test mission start\n      const mission = await missionStore.start('/test/path', 'claude', 'attended');\n      testResults = [...testResults, `✓ Mission started: ${mission}`];\n      \n      testResults = [...testResults, '✅ All IPC tests passed!'];\n    } catch (error) {\n      testResults = [...testResults, `❌ Test failed: ${error}`];\n    }\n  }\n</script>\n\n<main>\n  <h1>Tachikoma</h1>\n  <p>Your squad of tireless AI coders</p>\n  <p class=\"platform\">Running on: {platform}</p>\n  \n  <div class=\"test-section\">\n    <button \n      on:click={testIpc}\n      class=\"test-button\"\n    >\n      Test IPC Bridge\n    </button>\n    \n    {#if testResults.length > 0}\n      <div class=\"test-results\">\n        <h2>Test Results:</h2>\n        {#each testResults as result}\n          <div class=\"test-result\">{result}</div>\n        {/each}\n      </div>\n    {/if}\n    \n    <div class=\"mission-status\">\n      <h2>Mission Status</h2>\n      <p>Running: {$isRunning}</p>\n      <p>Progress: {$progress}%</p>\n    </div>\n  </div>\n</main>\n\n<style>\n  main {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    min-height: 100vh;\n    font-family: system-ui, -apple-system, sans-serif;\n    padding: 2rem;\n  }\n\n  h1 {\n    font-size: 3rem;\n    margin-bottom: 0.5rem;\n  }\n\n  .platform {\n    color: var(--text-muted, #666);\n    font-size: 0.875rem;\n    margin-bottom: 2rem;\n  }\n\n  .test-section {\n    width: 100%;\n    max-width: 600px;\n  }\n\n  .test-button {\n    background: #3b82f6;\n    color: white;\n    border: none;\n    padding: 0.75rem 1.5rem;\n    border-radius: 0.5rem;\n    cursor: pointer;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n  }\n\n  .test-button:hover {\n    background: #2563eb;\n  }\n\n  .test-results {\n    background: #f3f4f6;\n    padding: 1rem;\n    border-radius: 0.5rem;\n    margin-bottom: 1rem;\n  }\n\n  .test-results h2 {\n    font-size: 1.25rem;\n    margin-bottom: 0.5rem;\n  }\n\n  .test-result {\n    font-family: 'Monaco', 'Courier New', monospace;\n    font-size: 0.875rem;\n    margin-bottom: 0.25rem;\n  }\n\n  .mission-status {\n    background: #f9fafb;\n    padding: 1rem;\n    border-radius: 0.5rem;\n  }\n\n  .mission-status h2 {\n    font-size: 1.25rem;\n    margin-bottom: 0.5rem;\n  }\n</style>"],"names":["ensure_array_like","array_like_or_iterator","IpcError","message","channel","originalError","handleIpcError","error","isIpcAvailable","TachikomaIpc","request","callback","ipc","createMissionStore","subscribe","set","update","writable","specPath","backend","mode","missionId","status","s","e","state","get","level","missionStore","isRunning","derived","$m","progress","ctx","i","insert_hydration","target","div","anchor","append_hydration","h2","set_data","t","t_value","create_if_block","main","h1","p0","p1","div1","button","div0","p2","p3","platform","testResults","testIpc","$$invalidate","config","specs","mission"],"mappings":"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","x_google_ignoreList":[0]}