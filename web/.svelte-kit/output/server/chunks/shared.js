import*as x from"devalue";import{t as z,b as p,c as j}from"./utils.js";const S=!1;function I(i,t,e){t.startsWith("n:")?(t=t.slice(2),e=e===""?void 0:parseFloat(e)):t.startsWith("b:")&&(t=t.slice(2),e=e==="on"),T(i,M(t),e)}function R(i){const t={};for(let e of i.keys()){const n=e.endsWith("[]");let r=i.getAll(e);if(n&&(e=e.slice(0,-2)),r.length>1&&!n)throw new Error(`Form cannot contain duplicated keys â€” "${e}" has ${r.length} values`);r=r.filter(s=>typeof s=="string"||s.name!==""||s.size>0),e.startsWith("n:")?(e=e.slice(2),r=r.map(s=>s===""?void 0:parseFloat(s))):e.startsWith("b:")&&(e=e.slice(2),r=r.map(s=>s==="on")),I(t,e,n?r:r[0])}return t}const P="application/x-sveltekit-formdata",L=0;async function W(i){if(i.headers.get("content-type")!==P){const o=await i.formData();return{data:R(o),meta:{},form_data:o}}if(!i.body)throw new Error("Could not deserialize binary form: no body");const t=i.body.getReader(),e=[];async function n(o){if(o in e)return e[o];let a=e.length;for(;a<=o;)e[a]=t.read().then(c=>c.value),a++;return e[o]}async function r(o,a){let c,d=0,m;for(m=0;;m++){const y=await n(m);if(!y)return null;const O=d+y.byteLength;if(o>=d&&o<O){c=y;break}d=O}if(o+a<=d+c.byteLength)return c.subarray(o-d,o+a-d);const A=new Uint8Array(a);A.set(c.subarray(o-d));let k=c.byteLength-o+d;for(;k<a;){m++;let y=await n(m);if(!y)return null;y.byteLength>a-k&&(y=y.subarray(0,a-k)),A.set(y,k),k+=y.byteLength}return A}const s=await r(0,7);if(!s)throw new Error("Could not deserialize binary form: too short");if(s[0]!==L)throw new Error(`Could not deserialize binary form: got version ${s[0]}, expected version ${L}`);const u=new DataView(s.buffer,s.byteOffset,s.byteLength),l=u.getUint32(1,!0),b=u.getUint16(5,!0),_=await r(7,l);if(!_)throw new Error("Could not deserialize binary form: data too short");let f,h;if(b>0){const o=await r(7+l,b);if(!o)throw new Error("Could not deserialize binary form: file offset table too short");f=JSON.parse(z.decode(o)),h=7+l+b}const[w,E]=x.parse(z.decode(_),{File:([o,a,c,d,m])=>new Proxy(new v(o,a,c,d,n,h+f[m]),{getPrototypeOf(){return File.prototype}})});return(async()=>{let o=!0;for(;o;)o=!!await n(e.length)})(),{data:w,meta:E,form_data:null}}class v{#t;#e;constructor(t,e,n,r,s,u){this.name=t,this.type=e,this.size=n,this.lastModified=r,this.webkitRelativePath="",this.#t=s,this.#e=u,this.arrayBuffer=this.arrayBuffer.bind(this),this.bytes=this.bytes.bind(this),this.slice=this.slice.bind(this),this.stream=this.stream.bind(this),this.text=this.text.bind(this)}#r;async arrayBuffer(){return this.#r??=await new Response(this.stream()).arrayBuffer(),this.#r}async bytes(){return new Uint8Array(await this.arrayBuffer())}slice(t=0,e=this.size,n=this.type){t<0?t=Math.max(this.size+t,0):t=Math.min(t,this.size),e<0?e=Math.max(this.size+e,0):e=Math.min(e,this.size);const r=Math.max(e-t,0);return new v(this.name,n,r,this.lastModified,this.#t,this.#e+t)}stream(){let t=0,e=0;return new ReadableStream({start:async n=>{let r=0,s=null;for(e=0;;e++){const u=await this.#t(e);if(!u)return null;const l=r+u.byteLength;if(this.#e>=r&&this.#e<l){s=u;break}r=l}this.#e+this.size<=r+s.byteLength?(n.enqueue(s.subarray(this.#e-r,this.#e+this.size-r)),n.close()):(n.enqueue(s.subarray(this.#e-r)),t=s.byteLength-this.#e+r)},pull:async n=>{e++;let r=await this.#t(e);if(!r){n.error("Could not deserialize binary form: incomplete file data"),n.close();return}r.byteLength>this.size-t&&(r=r.subarray(0,this.size-t)),n.enqueue(r),t+=r.byteLength,t>=this.size&&n.close()}})}async text(){return z.decode(await this.arrayBuffer())}}const B=/^[a-zA-Z_$]\w*(\.[a-zA-Z_$]\w*|\[\d+\])*$/;function M(i){if(!B.test(i))throw new Error(`Invalid path ${i}`);return i.split(/\.|\[|\]/).filter(Boolean)}function $(i){if(i==="__proto__"||i==="constructor"||i==="prototype")throw new Error(`Invalid key "${i}"`)}function T(i,t,e){let n=i;for(let s=0;s<t.length-1;s+=1){const u=t[s];$(u);const l=/^\d+$/.test(t[s+1]),b=Object.hasOwn(n,u),_=n[u];if(b&&l!==Array.isArray(_))throw new Error(`Invalid array key ${t[s+1]}`);b||(n[u]=l?[]:{}),n=n[u]}const r=t[t.length-1];$(r),n[r]=e}function U(i,t=!1){const e={name:"",path:[],message:i.message,server:t};if(i.path!==void 0){let n="";for(const r of i.path){const s=typeof r=="object"?r.key:r;e.path.push(s),typeof s=="number"?n+=`[${s}]`:typeof s=="string"&&(n+=n===""?s:"."+s)}e.name=n}return e}function Y(i){const t={};for(const e of i){(t.$??=[]).push(e);let n="";if(e.path!==void 0)for(const r of e.path)typeof r=="number"?n+=`[${r}]`:typeof r=="string"&&(n+=n===""?r:"."+r),(t[n]??=[]).push(e)}return t}function F(i,t){let e=i;for(const n of t){if(e==null||typeof e!="object")return e;e=e[n]}return e}function g(i,t,e,n,r=[]){const s=()=>F(t(),r);return new Proxy(i,{get(u,l){if(typeof l=="symbol")return u[l];if(/^\d+$/.test(l))return g({},t,e,n,[...r,parseInt(l,10)]);const b=D(r);return l==="set"?g(function(f){return e(r,f),f},t,e,n,[...r,l]):l==="value"?g(s,t,e,n,[...r,l]):l==="issues"||l==="allIssues"?g(()=>{const f=n()[b===""?"$":b];return l==="allIssues"?f?.map(h=>({path:h.path,message:h.message})):f?.filter(h=>h.name===b)?.map(h=>({path:h.path,message:h.message}))},t,e,n,[...r,l]):l==="as"?g((f,h)=>{const w=f==="file multiple"||f==="select multiple"||f==="checkbox"&&typeof h=="string",o={name:(f==="number"||f==="range"?"n:":f==="checkbox"&&!w?"b:":"")+b+(w?"[]":""),get"aria-invalid"(){const a=n();return b in a?"true":void 0}};return f!=="text"&&f!=="select"&&f!=="select multiple"&&(o.type=f==="file multiple"?"file":f),f==="submit"||f==="hidden"?Object.defineProperties(o,{value:{value:h,enumerable:!0}}):f==="select"||f==="select multiple"?Object.defineProperties(o,{multiple:{value:w,enumerable:!0},value:{enumerable:!0,get(){return s()}}}):f==="checkbox"||f==="radio"?Object.defineProperties(o,{value:{value:h??"on",enumerable:!0},checked:{enumerable:!0,get(){const a=s();return f==="radio"?a===h:w?(a??[]).includes(h):a}}}):f==="file"||f==="file multiple"?Object.defineProperties(o,{multiple:{value:w,enumerable:!0},files:{enumerable:!0,get(){const a=s();if(a instanceof File){if(typeof DataTransfer<"u"){const c=new DataTransfer;return c.items.add(a),c.files}return{0:a,length:1}}if(Array.isArray(a)&&a.every(c=>c instanceof File)){if(typeof DataTransfer<"u"){const d=new DataTransfer;return a.forEach(m=>d.items.add(m)),d.files}const c={length:a.length};return a.forEach((d,m)=>{c[m]=d}),c}return null}}}):Object.defineProperties(o,{value:{enumerable:!0,get(){const a=s();return a!=null?String(a):""}}})},t,e,n,[...r,"as"]):g({},t,e,n,[...r,l])}})}function D(i){let t="";for(const e of i)typeof e=="number"?t+=`[${e}]`:t+=t===""?e:"."+e;return t}const V="x-sveltekit-invalidated",Z="x-sveltekit-trailing-slash";function N(i,t){const e=Object.fromEntries(Object.entries(t).map(([n,r])=>[n,r.encode]));return x.stringify(i,e)}function G(i,t){if(i===void 0)return"";const e=N(i,t),n=new TextEncoder().encode(e);return p(n).replaceAll("=","").replaceAll("+","-").replaceAll("/","_")}function H(i,t){if(!i)return;const e=z.decode(j(i.replaceAll("-","+").replaceAll("_","/"))),n=Object.fromEntries(Object.entries(t).map(([r,s])=>[r,s.decode]));return x.parse(e,n)}function J(i,t){return i+"/"+t}export{P as B,V as I,Z as T,S as a,G as b,J as c,W as d,g as e,Y as f,I as g,T as h,U as n,H as p,N as s};
