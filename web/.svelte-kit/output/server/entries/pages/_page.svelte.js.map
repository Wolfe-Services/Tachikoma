{"version":3,"file":"_page.svelte.js","sources":["../../../../../src/lib/ipc/errors.ts","../../../../../src/lib/ipc/client.ts","../../../../../src/lib/stores/mission.ts","../../../../../src/routes/+page.svelte"],"sourcesContent":["export class IpcError extends Error {\n  constructor(\n    message: string,\n    public channel: string,\n    public originalError?: unknown\n  ) {\n    super(message);\n    this.name = 'IpcError';\n  }\n}\n\nexport function handleIpcError(channel: string, error: unknown): IpcError {\n  const message = error instanceof Error ? error.message : String(error);\n  console.error(`IPC Error on channel '${channel}':`, error);\n  return new IpcError(`IPC call failed: ${message}`, channel, error);\n}\n\nexport function isIpcAvailable(): boolean {\n  return typeof window !== 'undefined' && !!window.tachikoma;\n}","import type { IpcChannels, IpcEvents } from './types';\nimport { handleIpcError, isIpcAvailable } from './errors';\n\nclass TachikomaIpc {\n  private listeners = new Map<string, Set<Function>>();\n\n  async invoke<K extends keyof IpcChannels>(\n    channel: K,\n    request: IpcChannels[K]['request']\n  ): Promise<IpcChannels[K]['response']> {\n    if (!isIpcAvailable()) {\n      throw new Error('Tachikoma IPC not available');\n    }\n    \n    try {\n      return window.tachikoma.invoke(channel, request) as Promise<IpcChannels[K]['response']>;\n    } catch (error) {\n      throw handleIpcError(channel, error);\n    }\n  }\n\n  on<K extends keyof IpcEvents>(\n    channel: K,\n    callback: (data: IpcEvents[K]) => void\n  ): () => void {\n    if (!isIpcAvailable()) {\n      return () => {};\n    }\n\n    if (!this.listeners.has(channel)) {\n      this.listeners.set(channel, new Set());\n    }\n    this.listeners.get(channel)!.add(callback);\n\n    window.tachikoma.on(channel, callback as any);\n\n    // Return unsubscribe function\n    return () => {\n      this.listeners.get(channel)?.delete(callback);\n      window.tachikoma.off(channel, callback as any);\n    };\n  }\n}\n\nexport const ipc = new TachikomaIpc();","import { writable, derived, get } from 'svelte/store';\nimport { ipc } from '$lib/ipc/client';\nimport type { MissionStatus } from '$lib/ipc/types';\n\ninterface MissionState {\n  current: MissionStatus | null;\n  logs: Array<{ level: string; message: string; timestamp: Date }>;\n  loading: boolean;\n  error: string | null;\n}\n\nfunction createMissionStore() {\n  const { subscribe, set, update } = writable<MissionState>({\n    current: null,\n    logs: [],\n    loading: false,\n    error: null\n  });\n\n  return {\n    subscribe,\n\n    async start(specPath: string, backend: string, mode: 'attended' | 'unattended') {\n      update(s => ({ ...s, loading: true, error: null }));\n      try {\n        const { missionId } = await ipc.invoke('mission:start', { specPath, backend, mode });\n        const status = await ipc.invoke('mission:status', { missionId });\n        update(s => ({ ...s, current: status, loading: false }));\n        return missionId;\n      } catch (e) {\n        update(s => ({ ...s, loading: false, error: String(e) }));\n        throw e;\n      }\n    },\n\n    async stop() {\n      const state = get({ subscribe });\n      if (state.current) {\n        await ipc.invoke('mission:stop', { missionId: state.current.id });\n        update(s => ({ ...s, current: null }));\n      }\n    },\n\n    addLog(level: string, message: string) {\n      update(s => ({\n        ...s,\n        logs: [...s.logs.slice(-99), { level, message, timestamp: new Date() }]\n      }));\n    },\n\n    clear() {\n      set({ current: null, logs: [], loading: false, error: null });\n    }\n  };\n}\n\nexport const missionStore = createMissionStore();\n\n// Derived stores\nexport const isRunning = derived(missionStore, $m => $m.current?.state === 'running');\nexport const progress = derived(missionStore, $m => $m.current?.progress ?? 0);","<script lang=\"ts\">\n  import { onMount } from 'svelte';\n  import { missionStore, isRunning, progress } from '$lib/stores/mission';\n  import { ipc } from '$lib/ipc';\n  \n  let platform = 'unknown';\n  let testResults: string[] = [];\n\n  if (typeof window !== 'undefined' && window.tachikoma) {\n    platform = window.tachikoma.platform;\n  }\n\n  async function testIpc() {\n    testResults = ['Testing IPC Bridge...'];\n    \n    try {\n      // Test config\n      const config = await ipc.invoke('config:get', {});\n      testResults = [...testResults, `✓ Config loaded: ${config.backend.brain}`];\n      \n      // Test spec list\n      const specs = await ipc.invoke('spec:list', {});\n      testResults = [...testResults, `✓ Specs listed: ${specs.length} found`];\n      \n      // Test mission start\n      const mission = await missionStore.start('/test/path', 'claude', 'attended');\n      testResults = [...testResults, `✓ Mission started: ${mission}`];\n      \n      testResults = [...testResults, '✅ All IPC tests passed!'];\n    } catch (error) {\n      testResults = [...testResults, `❌ Test failed: ${error}`];\n    }\n  }\n</script>\n\n<main>\n  <h1>Tachikoma</h1>\n  <p>Your squad of tireless AI coders</p>\n  <p class=\"platform\">Running on: {platform}</p>\n  \n  <div class=\"test-section\">\n    <button \n      on:click={testIpc}\n      class=\"test-button\"\n    >\n      Test IPC Bridge\n    </button>\n    \n    {#if testResults.length > 0}\n      <div class=\"test-results\">\n        <h2>Test Results:</h2>\n        {#each testResults as result}\n          <div class=\"test-result\">{result}</div>\n        {/each}\n      </div>\n    {/if}\n    \n    <div class=\"mission-status\">\n      <h2>Mission Status</h2>\n      <p>Running: {$isRunning}</p>\n      <p>Progress: {$progress}%</p>\n    </div>\n  </div>\n</main>\n\n<style>\n  main {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    min-height: 100vh;\n    font-family: system-ui, -apple-system, sans-serif;\n    padding: 2rem;\n  }\n\n  h1 {\n    font-size: 3rem;\n    margin-bottom: 0.5rem;\n  }\n\n  .platform {\n    color: var(--text-muted, #666);\n    font-size: 0.875rem;\n    margin-bottom: 2rem;\n  }\n\n  .test-section {\n    width: 100%;\n    max-width: 600px;\n  }\n\n  .test-button {\n    background: #3b82f6;\n    color: white;\n    border: none;\n    padding: 0.75rem 1.5rem;\n    border-radius: 0.5rem;\n    cursor: pointer;\n    font-size: 1rem;\n    margin-bottom: 1rem;\n  }\n\n  .test-button:hover {\n    background: #2563eb;\n  }\n\n  .test-results {\n    background: #f3f4f6;\n    padding: 1rem;\n    border-radius: 0.5rem;\n    margin-bottom: 1rem;\n  }\n\n  .test-results h2 {\n    font-size: 1.25rem;\n    margin-bottom: 0.5rem;\n  }\n\n  .test-result {\n    font-family: 'Monaco', 'Courier New', monospace;\n    font-size: 0.875rem;\n    margin-bottom: 0.25rem;\n  }\n\n  .mission-status {\n    background: #f9fafb;\n    padding: 1rem;\n    border-radius: 0.5rem;\n  }\n\n  .mission-status h2 {\n    font-size: 1.25rem;\n    margin-bottom: 0.5rem;\n  }\n</style>"],"names":["IpcError","message","channel","originalError","handleIpcError","error","isIpcAvailable","TachikomaIpc","request","callback","ipc","createMissionStore","subscribe","set","update","writable","specPath","backend","mode","s","missionId","status","e","state","get","level","missionStore","isRunning","derived","$m","progress","platform","testResults","escape","result","$isRunning","$progress"],"mappings":"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"}