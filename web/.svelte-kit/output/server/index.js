import{B as Gt,a as te,c as Bt,p as _e,s as ce,d as ft,T as Be,I as Je}from"./chunks/shared.js";import{json as J,text as z,error as ve}from"@sveltejs/kit";import{HttpError as ne,SvelteKitError as L,Redirect as B,ActionFailure as be}from"@sveltejs/kit/internal";import{with_request_store as U,merge_tracing as oe}from"@sveltejs/kit/internal/server";import{a as V,b as N,c as se,r as Jt,o as Vt,d as Ve}from"./chunks/environment.js";import*as I from"devalue";import{m as Xt,d as pt,a as ht,v as Kt,b as Yt,c as Qt,e as Zt,n as Ne,r as Xe,f as er}from"./chunks/exports.js";import{b as Ke,t as tr,a as fe,g as rr}from"./chunks/utils.js";import{r as nr,w as Ye}from"./chunks/index.js";import{p as Te,r as Qe,o as sr,s as ar,a as or,g as ir,b as cr}from"./chunks/internal.js";import{parse as me,serialize as Ae}from"cookie";import*as Ze from"set-cookie-parser";function _t(){let e,t;return{promise:new Promise((n,s)=>{e=n,t=s}),resolve:e,reject:t}}const lr=[101,103,204,205,304],ur=!!globalThis.process?.versions?.webcontainer,dr="/_svelte_kit_assets",mt=["GET","POST","PUT","PATCH","DELETE","OPTIONS","HEAD"],fr=["GET","POST","HEAD"];function Ue(e,t){const r=[];e.split(",").forEach((a,o)=>{const i=/([^/ \t]+)\/([^; \t]+)[ \t]*(?:;[ \t]*q=([0-9.]+))?/.exec(a);if(i){const[,c,u,l="1"]=i;r.push({type:c,subtype:u,q:+l,i:o})}}),r.sort((a,o)=>a.q!==o.q?o.q-a.q:a.subtype==="*"!=(o.subtype==="*")?a.subtype==="*"?1:-1:a.type==="*"!=(o.type==="*")?a.type==="*"?1:-1:a.i-o.i);let n,s=1/0;for(const a of t){const[o,i]=a.split("/"),c=r.findIndex(u=>(u.type===o||u.type==="*")&&(u.subtype===i||u.subtype==="*"));c!==-1&&c<s&&(n=a,s=c)}return n}function pr(e,...t){const r=e.headers.get("content-type")?.split(";",1)[0].trim()??"";return t.includes(r.toLowerCase())}function He(e){return pr(e,"application/x-www-form-urlencoded","multipart/form-data","text/plain",Gt)}function hr(e){return e instanceof Error||e&&e.name&&e.message?e:new Error(JSON.stringify(e))}function ae(e){return e instanceof ne||e instanceof L?e.status:500}function _r(e){return e instanceof L?e.text:"Internal Error"}const yt={"&":"&amp;",'"':"&quot;"},gt={"&":"&amp;","<":"&lt;"},wt="[\\ud800-\\udbff](?![\\udc00-\\udfff])|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\udc00-\\udfff]",mr=new RegExp(`[${Object.keys(yt).join("")}]|`+wt,"g"),yr=new RegExp(`[${Object.keys(gt).join("")}]|`+wt,"g");function Ie(e,t){const r=t?yt:gt;return e.replace(t?mr:yr,s=>s.length===2?s:r[s]??`&#${s.charCodeAt(0)};`)}function bt(e,t){return z(`${t} method not allowed`,{status:405,headers:{allow:gr(e).join(", ")}})}function gr(e){const t=mt.filter(r=>r in e);return"GET"in e&&!("HEAD"in e)&&t.push("HEAD"),t}function kt(e){return`__sveltekit_${e.version_hash}`}function ye(e,t,r){let n=e.templates.error({status:t,message:Ie(r)});return z(n,{headers:{"content-type":"text/html; charset=utf-8"},status:t})}async function et(e,t,r,n){n=n instanceof ne?n:hr(n);const s=ae(n),a=await D(e,t,r,n),o=Ue(e.request.headers.get("accept")||"text/html",["application/json","text/html"]);return e.isDataRequest||o==="application/json"?J(a,{status:s}):ye(r,s,a.message)}async function D(e,t,r,n){if(n instanceof ne)return{message:"Unknown Error",...n.body};const s=ae(n),a=_r(n);return await U({event:e,state:t},()=>r.hooks.handleError({error:n,event:e,status:s,message:a}))??{message:a}}function ge(e,t){return new Response(void 0,{status:e,headers:{location:t}})}function $t(e,t){return t.path?`Data returned from \`load\` while rendering ${e.route.id} is not serializable: ${t.message} (${t.path}). If you need to serialize/deserialize custom types, use transport hooks: https://svelte.dev/docs/kit/hooks#Universal-hooks-transport.`:t.path===""?`Data returned from \`load\` while rendering ${e.route.id} is not a plain object`:t.message}function vt(e){const t={};return e.uses&&e.uses.dependencies.size>0&&(t.dependencies=Array.from(e.uses.dependencies)),e.uses&&e.uses.search_params.size>0&&(t.search_params=Array.from(e.uses.search_params)),e.uses&&e.uses.params.size>0&&(t.params=Array.from(e.uses.params)),e.uses?.parent&&(t.parent=1),e.uses?.route&&(t.route=1),e.uses?.url&&(t.url=1),t}function Et(e,t){return e._.prerendered_routes.has(t)||t.at(-1)==="/"&&e._.prerendered_routes.has(t.slice(0,-1))}function wr(e,t,r){const n=`
\x1B[1;31m[${e}] ${r.request.method} ${r.url.pathname}\x1B[0m`;return e===404?n:`${n}
${t.stack}`}function xt(e){const r=e?.split("/")?.at(-1);return r?r.split(".").slice(0,-1).join("."):"unknown"}async function br(e,t,r,n){const s=e.request.method;let a=r[s]||r.fallback;if(s==="HEAD"&&!r.HEAD&&r.GET&&(a=r.GET),!a)return bt(r,s);const o=r.prerender??n.prerender_default;if(o&&(r.POST||r.PATCH||r.PUT||r.DELETE))throw new Error("Cannot prerender endpoints that have mutative methods");if(n.prerendering&&!n.prerendering.inside_reroute&&!o){if(n.depth>0)throw new Error(`${e.route.id} is not prerenderable`);return new Response(void 0,{status:204})}t.is_endpoint_request=!0;try{const i=await U({event:e,state:t},()=>a(e));if(!(i instanceof Response))throw new Error(`Invalid response from route ${e.url.pathname}: handler should return a Response object`);if(n.prerendering&&(!n.prerendering.inside_reroute||o)){const c=new Response(i.clone().body,{status:i.status,statusText:i.statusText,headers:new Headers(i.headers)});if(c.headers.set("x-sveltekit-prerender",String(o)),n.prerendering.inside_reroute&&o)c.headers.set("x-sveltekit-routeid",encodeURI(e.route.id)),n.prerendering.dependencies.set(e.url.pathname,{response:c,body:null});else return c}return i}catch(i){if(i instanceof B)return new Response(void 0,{status:i.status,headers:{location:i.location}});throw i}}function kr(e){const{method:t,headers:r}=e.request;if(mt.includes(t)&&!fr.includes(t))return!0;if(t==="POST"&&r.get("x-sveltekit-action")==="true")return!1;const n=e.request.headers.get("accept")??"*/*";return Ue(n,["*","text/html"])!=="text/html"}function Oe(e){return e.filter(t=>t!=null)}const Le="/__data.json",we=".html__data.json";function $r(e){return e.endsWith(Le)||e.endsWith(we)}function De(e){return e.endsWith(".html")?e.replace(/\.html$/,we):e.replace(/\/$/,"")+Le}function vr(e){return e.endsWith(we)?e.slice(0,-we.length)+".html":e.slice(0,-Le.length)}const We="/__route.js";function Er(e){return e.endsWith(We)}function Rt(e){return e.replace(/\/$/,"")+We}function xr(e){return e.slice(0,-We.length)}const Rr={spanContext(){return jr},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this},addLink(){return this},addLinks(){return this}},jr={traceId:"",spanId:"",traceFlags:0};async function ee({name:e,attributes:t,fn:r}){return r(Rr)}function jt(e){return Ue(e.request.headers.get("accept")??"*/*",["application/json","text/html"])==="application/json"&&e.request.method==="POST"}async function Sr(e,t,r,n){const s=n?.actions;if(!s){const a=new L(405,"Method Not Allowed","POST method not allowed. No form actions exist for this page");return le({type:"error",error:await D(e,t,r,a)},{status:a.status,headers:{allow:"GET"}})}Tt(s);try{const a=await At(e,t,s);return a instanceof be?le({type:"failure",status:a.status,data:tt(a.data,e.route.id,r.hooks.transport)}):le({type:"success",status:a?200:204,data:tt(a,e.route.id,r.hooks.transport)})}catch(a){const o=a;return o instanceof B?St(o):le({type:"error",error:await D(e,t,r,Me(o))},{status:ae(o)})}}function Me(e){return e instanceof be?new Error('Cannot "throw fail()". Use "return fail()"'):e}function St(e){return le({type:"redirect",status:e.status,location:e.location})}function le(e,t){return J(e,t)}function Tr(e){return e.request.method==="POST"}async function Ar(e,t,r){const n=r?.actions;if(!n)return e.setHeaders({allow:"GET"}),{type:"error",error:new L(405,"Method Not Allowed","POST method not allowed. No form actions exist for this page")};Tt(n);try{const s=await At(e,t,n);return s instanceof be?{type:"failure",status:s.status,data:s.data}:{type:"success",status:200,data:s}}catch(s){const a=s;return a instanceof B?{type:"redirect",status:a.status,location:a.location}:{type:"error",error:Me(a)}}}function Tt(e){if(e.default&&Object.keys(e).length>1)throw new Error("When using named actions, the default action cannot be used. See the docs for more info: https://svelte.dev/docs/kit/form-actions#named-actions")}async function At(e,t,r){const n=new URL(e.request.url);let s="default";for(const o of n.searchParams)if(o[0].startsWith("/")){if(s=o[0].slice(1),s==="default")throw new Error('Cannot use reserved action name "default"');break}const a=r[s];if(!a)throw new L(404,"Not Found",`No action with name '${s}' found`);if(!He(e.request))throw new L(415,"Unsupported Media Type",`Form actions expect form-encoded data — received ${e.request.headers.get("content-type")}`);return ee({name:"sveltekit.form_action",attributes:{"http.route":e.route.id||"unknown"},fn:async o=>{const i=oe(e,o),c=await U({event:i,state:t},()=>a(i));return c instanceof be&&o.setAttributes({"sveltekit.form_action.result.type":"failure","sveltekit.form_action.result.status":c.status}),c}})}function Or(e,t,r){const n=s=>{for(const a in r){const o=r[a].encode(s);if(o)return`app.decode('${a}', ${I.uneval(o,n)})`}};return Ot(e,s=>I.uneval(s,n),t)}function tt(e,t,r){const n=Object.fromEntries(Object.entries(r).map(([s,a])=>[s,a.encode]));return Ot(e,s=>I.stringify(s,n),t)}function Ot(e,t,r){try{return t(e)}catch(n){const s=n;if(e instanceof Response)throw new Error(`Data returned from action inside ${r} is not serializable. Form actions need to return plain objects or fail(). E.g. return { success: true } or return fail(400, { message: "invalid" });`);if("path"in s){let a=`Data returned from action inside ${r} is not serializable: ${s.message}`;throw s.path!==""&&(a+=` (data.${s.path})`),new Error(a)}throw s}}function qt(){let e=-1,t=-1;const r=[];return{iterate:(n=s=>s)=>({[Symbol.asyncIterator](){return{next:async()=>{const s=r[++t];if(!s)return{value:null,done:!0};const a=await s.promise;return{value:n(a),done:!1}}}}}),add:n=>{r.push(_t()),n.then(s=>{r[++e].resolve(s)})}}}function ue(e,t,r){let n=1,s=-1;const a=qt(),o=kt(r);function i(u){return function l(_){if(typeof _?.then=="function"){const g=n++,h=_.then(f=>({data:f})).catch(async f=>({error:await D(e,t,r,f)})).then(async({data:f,error:d})=>{let y;try{y=I.uneval(d?[,d]:[f],l)}catch{d=await D(e,t,r,new Error(`Failed to serialize promise while rendering ${e.route.id}`)),f=void 0,y=I.uneval([,d],l)}return{index:u,str:`${o}.resolve(${g}, ${y.includes("app.decode")?`(app) => ${y}`:`() => ${y}`})`}});return a.add(h),`${o}.defer(${g})`}else for(const g in r.hooks.transport){const h=r.hooks.transport[g].encode(_);if(h)return`app.decode('${g}', ${I.uneval(h,l)})`}}}const c=[];return{set_max_nodes(u){s=u},add_node(u,l){try{if(!l){c[u]="null";return}const _={type:"data",data:l.data,uses:vt(l)};l.slash&&(_.slash=l.slash),c[u]=I.uneval(_,i(u))}catch(_){throw _.path=_.path.slice(1),new Error($t(e,_))}},get_data(u){const l=`<script${u.script_needs_nonce?` nonce="${u.nonce}"`:""}>`,_=`<\/script>
`;return{data:`[${Oe(s>-1?c.slice(0,s):c).join(",")}]`,chunks:n>1?a.iterate(({index:g,str:h})=>s>-1&&g>=s?"":l+h+_):null}}}}function Pt(e,t,r){let n=1;const s=qt(),a={...Object.fromEntries(Object.entries(r.hooks.transport).map(([i,c])=>[i,c.encode])),Promise:i=>{if(typeof i?.then!="function")return;const c=n++;let u="data";const l=i.catch(async _=>(u="error",D(e,t,r,_))).then(async _=>{let g;try{g=I.stringify(_,a)}catch{const h=await D(e,t,r,new Error(`Failed to serialize promise while rendering ${e.route.id}`));u="error",g=I.stringify(h,a)}return`{"type":"chunk","id":${c},"${u}":${g}}
`});return s.add(l),c}},o=[];return{add_node(i,c){try{if(!c){o[i]="null";return}if(c.type==="error"||c.type==="skip"){o[i]=JSON.stringify(c);return}o[i]=`{"type":"data","data":${I.stringify(c.data,a)},"uses":${JSON.stringify(vt(c))}${c.slash?`,"slash":${JSON.stringify(c.slash)}`:""}}`}catch(u){throw u.path="data"+u.path,new Error($t(e,u))}},get_data(){return{data:`{"type":"data","nodes":[${o.join(",")}]}
`,chunks:n>1?s.iterate():null}}}}async function Fe({event:e,event_state:t,state:r,node:n,parent:s}){if(!n?.server)return null;let a=!0;const o={dependencies:new Set,params:new Set,parent:!1,route:!1,url:!1,search_params:new Set},i=n.server.load,c=n.server.trailingSlash;if(!i)return{type:"data",data:null,uses:o,slash:c};const u=Xt(e.url,()=>{a&&(o.url=!0)},_=>{a&&o.search_params.add(_)});return r.prerendering&&pt(u),{type:"data",data:await ee({name:"sveltekit.load",attributes:{"sveltekit.load.node_id":n.server_id||"unknown","sveltekit.load.node_type":xt(n.server_id),"http.route":e.route.id||"unknown"},fn:async _=>{const g=oe(e,_);return await U({event:g,state:t},()=>i.call(null,{...g,fetch:(f,d)=>(new URL(f instanceof Request?f.url:f,e.url),e.fetch(f,d)),depends:(...f)=>{for(const d of f){const{href:y}=new URL(d,e.url);o.dependencies.add(y)}},params:new Proxy(e.params,{get:(f,d)=>(a&&o.params.add(d),f[d])}),parent:async()=>(a&&(o.parent=!0),s()),route:new Proxy(e.route,{get:(f,d)=>(a&&(o.route=!0),f[d])}),url:u,untrack(f){a=!1;try{return f()}finally{a=!0}}}))}})??null,uses:o,slash:c}}async function Ct({event:e,event_state:t,fetched:r,node:n,parent:s,server_data_promise:a,state:o,resolve_opts:i,csr:c}){const u=await a,l=n?.universal?.load;return l?await ee({name:"sveltekit.load",attributes:{"sveltekit.load.node_id":n.universal_id||"unknown","sveltekit.load.node_type":xt(n.universal_id),"http.route":e.route.id||"unknown"},fn:async g=>{const h=oe(e,g);return await U({event:h,state:t},()=>l.call(null,{url:e.url,params:e.params,data:u?.data??null,route:e.route,fetch:qr(e,o,r,c,i),setHeaders:e.setHeaders,depends:()=>{},parent:s,untrack:f=>f(),tracing:h.tracing}))}})??null:u?.data??null}function qr(e,t,r,n,s){const a=async(o,i)=>{const c=o instanceof Request&&o.body?o.clone().body:null,u=o instanceof Request&&[...o.headers].length?new Headers(o.headers):i?.headers;let l=await e.fetch(o,i);const _=new URL(o instanceof Request?o.url:o,e.url),g=_.origin===e.url.origin;let h;if(g)t.prerendering&&(h={response:l,body:null},t.prerendering.dependencies.set(_.pathname,h));else if(_.protocol==="https:"||_.protocol==="http:")if((o instanceof Request?o.mode:i?.mode??"cors")==="no-cors")l=new Response("",{status:l.status,statusText:l.statusText,headers:l.headers});else{const w=l.headers.get("access-control-allow-origin");if(!w||w!==e.url.origin&&w!=="*")throw new Error(`CORS error: ${w?"Incorrect":"No"} 'Access-Control-Allow-Origin' header is present on the requested resource`)}let f;const d=new Proxy(l,{get(y,w,$){async function R(p,b){const m=Number(y.status);if(isNaN(m))throw new Error(`response.status is not a number. value: "${y.status}" type: ${typeof y.status}`);r.push({url:g?_.href.slice(e.url.origin.length):_.href,method:e.request.method,request_body:o instanceof Request&&c?await Pr(c):i?.body,request_headers:u,response_body:p,response:y,is_b64:b})}if(w==="body"){if(y.body===null)return null;if(f)return f;const[p,b]=y.body.tee();return(async()=>{let m=new Uint8Array;for await(const k of p){const E=new Uint8Array(m.length+k.length);E.set(m,0),E.set(k,m.length),m=E}h&&(h.body=new Uint8Array(m)),R(Ke(m),!0)})(),f=b}if(w==="arrayBuffer")return async()=>{const p=await y.arrayBuffer(),b=new Uint8Array(p);return h&&(h.body=b),p instanceof ArrayBuffer&&await R(Ke(b),!0),p};async function v(){const p=await y.text();if(p===""&&lr.includes(y.status)){await R(void 0,!1);return}return(!p||typeof p=="string")&&await R(p,!1),h&&(h.body=p),p}if(w==="text")return v;if(w==="json")return async()=>{const p=await v();return p?JSON.parse(p):void 0};const S=Reflect.get(y,w,y);return S instanceof Function?Object.defineProperties(function(){return Reflect.apply(S,this===$?y:this,arguments)},{name:{value:S.name},length:{value:S.length}}):S}});if(n){const y=l.headers.get;l.headers.get=w=>{const $=w.toLowerCase(),R=y.call(l.headers,$);if(R&&!$.startsWith("x-sveltekit-")&&!s.filterSerializedResponseHeaders($,R))throw new Error(`Failed to get response header "${$}" — it must be included by the \`filterSerializedResponseHeaders\` option: https://svelte.dev/docs/kit/hooks#Server-hooks-handle (at ${e.route.id})`);return R}}return d};return(o,i)=>{const c=a(o,i);return c.catch(()=>{}),c}}async function Pr(e){let t="";const r=e.getReader();for(;;){const{done:n,value:s}=await r.read();if(n)break;t+=tr.decode(s)}return t}function zt(...e){let t=5381;for(const r of e)if(typeof r=="string"){let n=r.length;for(;n;)t=t*33^r.charCodeAt(--n)}else if(ArrayBuffer.isView(r)){const n=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);let s=n.length;for(;s;)t=t*33^n[--s]}else throw new TypeError("value must be a string or TypedArray");return(t>>>0).toString(36)}const Nt={"<":"\\u003C","\u2028":"\\u2028","\u2029":"\\u2029"},Cr=new RegExp(`[${Object.keys(Nt).join("")}]`,"g");function zr(e,t,r=!1){const n={};let s=null,a=null,o=!1;for(const[l,_]of e.response.headers)t(l,_)&&(n[l]=_),l==="cache-control"?s=_:l==="age"?a=_:l==="vary"&&_.trim()==="*"&&(o=!0);const i={status:e.response.status,statusText:e.response.statusText,headers:n,body:e.response_body},c=JSON.stringify(i).replace(Cr,l=>Nt[l]),u=['type="application/json"',"data-sveltekit-fetched",`data-url="${Ie(e.url,!0)}"`];if(e.is_b64&&u.push("data-b64"),e.request_headers||e.request_body){const l=[];e.request_headers&&l.push([...new Headers(e.request_headers)].join(",")),e.request_body&&l.push(e.request_body),u.push(`data-hash="${zt(...l)}"`)}if(!r&&e.method==="GET"&&s&&!o){const l=/s-maxage=(\d+)/g.exec(s)??/max-age=(\d+)/g.exec(s);if(l){const _=+l[1]-+(a??"0");u.push(`data-ttl="${_}"`)}}return`<script ${u.join(" ")}>${c}<\/script>`}const H=JSON.stringify;function rt(e){qe[0]||Nr();const t=Ut.slice(0),r=Ur(e);for(let s=0;s<r.length;s+=16){const a=r.subarray(s,s+16);let o,i,c,u=t[0],l=t[1],_=t[2],g=t[3],h=t[4],f=t[5],d=t[6],y=t[7];for(let w=0;w<64;w++)w<16?o=a[w]:(i=a[w+1&15],c=a[w+14&15],o=a[w&15]=(i>>>7^i>>>18^i>>>3^i<<25^i<<14)+(c>>>17^c>>>19^c>>>10^c<<15^c<<13)+a[w&15]+a[w+9&15]|0),o=o+y+(h>>>6^h>>>11^h>>>25^h<<26^h<<21^h<<7)+(d^h&(f^d))+qe[w],y=d,d=f,f=h,h=g+o|0,g=_,_=l,l=u,u=o+(l&_^g&(l^_))+(l>>>2^l>>>13^l>>>22^l<<30^l<<19^l<<10)|0;t[0]=t[0]+u|0,t[1]=t[1]+l|0,t[2]=t[2]+_|0,t[3]=t[3]+g|0,t[4]=t[4]+h|0,t[5]=t[5]+f|0,t[6]=t[6]+d|0,t[7]=t[7]+y|0}const n=new Uint8Array(t.buffer);return Ht(n),btoa(String.fromCharCode(...n))}const Ut=new Uint32Array(8),qe=new Uint32Array(64);function Nr(){function e(r){return(r-Math.floor(r))*4294967296}let t=2;for(let r=0;r<64;t++){let n=!0;for(let s=2;s*s<=t;s++)if(t%s===0){n=!1;break}n&&(r<8&&(Ut[r]=e(t**(1/2))),qe[r]=e(t**(1/3)),r++)}}function Ht(e){for(let t=0;t<e.length;t+=4){const r=e[t+0],n=e[t+1],s=e[t+2],a=e[t+3];e[t+0]=a,e[t+1]=s,e[t+2]=n,e[t+3]=r}}function Ur(e){const t=fe.encode(e),r=t.length*8,n=512*Math.ceil((r+65)/512),s=new Uint8Array(n/8);s.set(t),s[t.length]=128,Ht(s);const a=new Uint32Array(s.buffer);return a[a.length-2]=Math.floor(r/4294967296),a[a.length-1]=r,a}const nt=new Uint8Array(16);function Hr(){return crypto.getRandomValues(nt),btoa(String.fromCharCode(...nt))}const Ir=new Set(["self","unsafe-eval","unsafe-hashes","unsafe-inline","none","strict-dynamic","report-sample","wasm-unsafe-eval","script"]),Lr=/^(nonce|sha\d\d\d)-/;class It{#e;#t;#c;#l;#u;#d;#f;#p;#n;#s;#a;#o;#i;#r;#h;constructor(t,r,n){this.#e=t,this.#n=r;const s=this.#n;this.#s=[],this.#a=[],this.#o=[],this.#i=[],this.#r=[];const a=s["script-src"]||s["default-src"],o=s["script-src-elem"],i=s["style-src"]||s["default-src"],c=s["style-src-attr"],u=s["style-src-elem"],l=_=>!!_&&!_.some(g=>g==="unsafe-inline");this.#c=l(a),this.#l=l(o),this.#d=l(i),this.#f=l(c),this.#p=l(u),this.#t=this.#c||this.#l,this.#u=this.#d||this.#f||this.#p,this.script_needs_nonce=this.#t&&!this.#e,this.style_needs_nonce=this.#u&&!this.#e,this.#h=n}add_script(t){if(!this.#t)return;const r=this.#e?`sha256-${rt(t)}`:`nonce-${this.#h}`;this.#c&&this.#s.push(r),this.#l&&this.#a.push(r)}add_style(t){if(!this.#u)return;const r=this.#e?`sha256-${rt(t)}`:`nonce-${this.#h}`;if(this.#d&&this.#o.push(r),this.#f&&this.#i.push(r),this.#p){const n="sha256-9OlNO0DNEeaVzHL4RZwCLsBHA8WBQ8toBp/4F5XV2nc=",s=this.#n;s["style-src-elem"]&&!s["style-src-elem"].includes(n)&&!this.#r.includes(n)&&this.#r.push(n),r!==n&&this.#r.push(r)}}get_header(t=!1){const r=[],n={...this.#n};this.#o.length>0&&(n["style-src"]=[...n["style-src"]||n["default-src"]||[],...this.#o]),this.#i.length>0&&(n["style-src-attr"]=[...n["style-src-attr"]||[],...this.#i]),this.#r.length>0&&(n["style-src-elem"]=[...n["style-src-elem"]||[],...this.#r]),this.#s.length>0&&(n["script-src"]=[...n["script-src"]||n["default-src"]||[],...this.#s]),this.#a.length>0&&(n["script-src-elem"]=[...n["script-src-elem"]||[],...this.#a]);for(const s in n){if(t&&(s==="frame-ancestors"||s==="report-uri"||s==="sandbox"))continue;const a=n[s];if(!a)continue;const o=[s];Array.isArray(a)&&a.forEach(i=>{Ir.has(i)||Lr.test(i)?o.push(`'${i}'`):o.push(i)}),r.push(o.join(" "))}return r.join("; ")}}class Dr extends It{get_meta(){const t=this.get_header(!0);if(t)return`<meta http-equiv="content-security-policy" content="${Ie(t,!0)}">`}}class Wr extends It{constructor(t,r,n){if(super(t,r,n),Object.values(r).filter(s=>!!s).length>0){const s=r["report-to"]?.length??!1,a=r["report-uri"]?.length??!1;if(!s&&!a)throw Error("`content-security-policy-report-only` must be specified with either the `report-to` or `report-uri` directives, or both")}}}class Mr{nonce=Hr();csp_provider;report_only_provider;constructor({mode:t,directives:r,reportOnly:n},{prerender:s}){const a=t==="hash"||t==="auto"&&s;this.csp_provider=new Dr(a,r,this.nonce),this.report_only_provider=new Wr(a,n,this.nonce)}get script_needs_nonce(){return this.csp_provider.script_needs_nonce||this.report_only_provider.script_needs_nonce}get style_needs_nonce(){return this.csp_provider.style_needs_nonce||this.report_only_provider.style_needs_nonce}add_script(t){this.csp_provider.add_script(t),this.report_only_provider.add_script(t)}add_style(t){this.csp_provider.add_style(t),this.report_only_provider.add_style(t)}}function Lt(e,t,r){const n={},s=e.slice(1),a=s.filter(i=>i!==void 0);let o=0;for(let i=0;i<t.length;i+=1){const c=t[i];let u=s[i-o];if(c.chained&&c.rest&&o&&(u=s.slice(i-o,i+1).filter(l=>l).join("/"),o=0),u===void 0){c.rest&&(n[c.name]="");continue}if(!c.matcher||r[c.matcher](u)){n[c.name]=u;const l=t[i+1],_=s[i+1];l&&!l.rest&&l.optional&&_&&c.chained&&(o=0),!l&&!_&&Object.keys(n).length===a.length&&(o=0);continue}if(c.optional&&c.chained){o++;continue}return}if(!o)return n}function Dt(e,t,r){const{errors:n,layouts:s,leaf:a}=e,o=[...n,...s.map(i=>i?.[1]),a[1]].filter(i=>typeof i=="number").map(i=>`'${i}': () => ${Wt(r._.client.nodes?.[i],t)}`).join(`,
		`);return[`{
	id: ${H(e.id)}`,`errors: ${H(e.errors)}`,`layouts: ${H(e.layouts)}`,`leaf: ${H(e.leaf)}`,`nodes: {
		${o}
	}
}`].join(`,
	`)}function Wt(e,t){if(!e)return"Promise.resolve({})";if(e[0]==="/")return`import('${e}')`;if(V!=="")return`import('${V}/${e}')`;let r=rr(t.pathname,`${N}/${e}`);return r[0]!=="."&&(r=`./${r}`),`import('${r}')`}async function Fr(e,t,r){if(!r._.client.routes)return z("Server-side route resolution disabled",{status:400});let n=null,s={};const a=await r._.matchers();for(const o of r._.client.routes){const i=o.pattern.exec(e);if(!i)continue;const c=Lt(i,o.params,a);if(c){n=o,s=ht(c);break}}return Mt(n,s,t,r).response}function Mt(e,t,r,n){const s=new Headers({"content-type":"application/javascript; charset=utf-8"});if(e){const a=Dt(e,r,n),o=`${Gr(e,r,n)}
export const route = ${a}; export const params = ${JSON.stringify(t)};`;return{response:z(o,{headers:s}),body:o}}else return{response:z("",{headers:s}),body:""}}function Gr(e,t,r){const{errors:n,layouts:s,leaf:a}=e;let o="";for(const i of[...n,...s.map(c=>c?.[1]),a[1]]){if(typeof i!="number")continue;const c=r._.client.css?.[i];for(const u of c??[])o+=`'${V||N}/${u}',`}return o?`${Wt(r._.client.start,t)}.then(x => x.load_css([${o}]));`:""}const Br={...nr(!1),check:()=>!1};async function de({branch:e,fetched:t,options:r,manifest:n,state:s,page_config:a,status:o,error:i=null,event:c,event_state:u,resolve_opts:l,action_result:_,data_serializer:g}){if(s.prerendering){if(r.csp.mode==="nonce")throw new Error('Cannot use prerendering if config.kit.csp.mode === "nonce"');if(r.app_template_contains_nonce)throw new Error("Cannot use prerendering if page template contains %sveltekit.nonce%")}const{client:h}=n._,f=new Set(h.imports),d=new Set(h.stylesheets),y=new Set(h.fonts),w=new Set,$=new Set,R=new Map;let v;const S=_?.type==="success"||_?.type==="failure"?_.data??null:null;let p=N,b=V,m=H(N);if(s.prerendering?.fallback?r.hash_routing&&(m="new URL('.', location).pathname.slice(0, -1)"):(p=c.url.pathname.slice(N.length).split("/").slice(2).map(()=>"..").join("/")||".",m=`new URL(${H(p)}, location).pathname.slice(0, -1)`,(!V||V[0]==="/"&&V!==dr)&&(b=p)),a.ssr){const j={stores:{page:Ye(null),navigating:Ye(null),updated:Br},constructors:await Promise.all(e.map(({node:q})=>{if(!q.component)throw new Error(`Missing +page.svelte component for route ${c.route.id}`);return q.component()})),form:S};let A={};for(let q=0;q<e.length;q+=1)A={...A,...e[q].data},j[`data_${q}`]=A;j.page={error:i,params:c.params,route:c.route,status:o,url:c.url,data:A,form:S,state:{}};const G={context:new Map([["__request__",{page:j.page}]])},re=globalThis.fetch;try{v=await U({event:c,state:u},async()=>{Jt&&Vt({base:p,assets:b});const q=r.root.render(j,G),W=r.async&&"then"in q?q.then(O=>O):q;r.async&&Ve();const{head:Q,html:pe,css:he}=r.async?await W:W;return{head:Q,html:pe,css:he}})}finally{Ve()}for(const{node:q}of e){for(const W of q.imports)f.add(W);for(const W of q.stylesheets)d.add(W);for(const W of q.fonts)y.add(W);q.inline_styles&&!h.inline&&Object.entries(await q.inline_styles()).forEach(([W,Q])=>R.set(W,Q))}}else v={head:"",html:"",css:{code:"",map:null}};let k="",E=v.html;const x=new Mr(r.csp,{prerender:!!s.prerendering}),T=j=>j.startsWith("/")?N+j:`${b}/${j}`,P=h.inline?h.inline?.style:Array.from(R.values()).join(`
`);if(P){const j=[];x.style_needs_nonce&&j.push(` nonce="${x.nonce}"`),x.add_style(P),k+=`
	<style${j.join("")}>${P}</style>`}for(const j of d){const A=T(j),G=['rel="stylesheet"'];R.has(j)?G.push("disabled",'media="(max-width: 0)"'):l.preload({type:"css",path:A})&&w.add(`<${encodeURI(A)}>; rel="preload"; as="style"; nopush`),k+=`
		<link href="${A}" ${G.join(" ")}>`}for(const j of y){const A=T(j);if(l.preload({type:"font",path:A})){const G=j.slice(j.lastIndexOf(".")+1);$.add(`<link rel="preload" as="font" type="font/${G}" href="${A}" crossorigin>`),w.add(`<${encodeURI(A)}>; rel="preload"; as="font"; type="font/${G}"; crossorigin; nopush`)}}const M=kt(r),{data:F,chunks:X}=g.get_data(x);if(a.ssr&&a.csr&&(E+=`
			${t.map(j=>zr(j,l.filterSerializedResponseHeaders,!!s.prerendering)).join(`
			`)}`),a.csr){const j=n._.client.routes?.find(O=>O.id===c.route.id)??null;if(h.uses_env_dynamic_public&&s.prerendering&&f.add(`${se}/env.js`),!h.inline){const O=Array.from(f,C=>T(C)).filter(C=>l.preload({type:"js",path:C}));for(const C of O)w.add(`<${encodeURI(C)}>; rel="modulepreload"; nopush`),r.preload_strategy!=="modulepreload"?k+=`
		<link rel="preload" as="script" crossorigin="anonymous" href="${C}">`:$.add(`<link rel="modulepreload" href="${C}">`)}if(s.prerendering&&$.size>0&&(k+=Array.from($).map(O=>`
		${O}`).join("")),n._.client.routes&&s.prerendering&&!s.prerendering.fallback){const O=Rt(c.url.pathname);s.prerendering.dependencies.set(O,Mt(j,c.params,new URL(O,c.url),n))}const A=[],G=h.uses_env_dynamic_public&&s.prerendering,re=[`base: ${m}`];if(V&&re.push(`assets: ${H(V)}`),h.uses_env_dynamic_public&&re.push(`env: ${G?"null":H(Te)}`),X){A.push("const deferred = new Map();"),re.push(`defer: (id) => new Promise((fulfil, reject) => {
							deferred.set(id, { fulfil, reject });
						})`);let O="";Object.keys(r.hooks.transport).length>0&&(h.inline?O=`const app = __sveltekit_${r.version_hash}.app.app;`:h.app?O=`const app = await import(${H(T(h.app))});`:O=`const { app } = await import(${H(T(h.start))});`);const C=O?`${O}
							const [data, error] = fn(app);`:"const [data, error] = fn();";re.push(`resolve: async (id, fn) => {
							${C}

							const try_to_resolve = () => {
								if (!deferred.has(id)) {
									setTimeout(try_to_resolve, 0);
									return;
								}
								const { fulfil, reject } = deferred.get(id);
								deferred.delete(id);
								if (error) reject(error);
								else fulfil(data);
							}
							try_to_resolve();
						}`)}A.push(`${M} = {
						${re.join(`,
						`)}
					};`);const q=["element"];if(A.push("const element = document.currentScript.parentElement;"),a.ssr){const O={form:"null",error:"null"};S&&(O.form=Or(S,c.route.id,r.hooks.transport)),i&&(O.error=I.uneval(i));const C=[`node_ids: [${e.map(({node:Y})=>Y.index).join(", ")}]`,`data: ${F}`,`form: ${O.form}`,`error: ${O.error}`];if(o!==200&&C.push(`status: ${o}`),n._.client.routes){if(j){const Y=Dt(j,c.url,n).replaceAll(`
`,`
							`);C.push(`params: ${I.uneval(c.params)}`,`server_route: ${Y}`)}}else r.embedded&&C.push(`params: ${I.uneval(c.params)}`,`route: ${H(c.route)}`);const Z="	".repeat(G?7:6);q.push(`{
${Z}	${C.join(`,
${Z}	`)}
${Z}}`)}const{remote_data:W}=u;let Q="";if(W){const O={};for(const[Z,Y]of W)if(Z.id)for(const ie in Y)O[Bt(Z.id,ie)]=await Y[ie];const C=Z=>{for(const Y in r.hooks.transport){const ie=r.hooks.transport[Y].encode(Z);if(ie)return`app.decode('${Y}', ${I.uneval(ie,C)})`}};Q=`${M}.data = ${I.uneval(O,C)};

						`}const pe=h.inline?`${h.inline.script}

					${Q}${M}.app.start(${q.join(", ")});`:h.app?`Promise.all([
						import(${H(T(h.start))}),
						import(${H(T(h.app))})
					]).then(([kit, app]) => {
						${Q}kit.start(app, ${q.join(", ")});
					});`:`import(${H(T(h.start))}).then((app) => {
						${Q}app.start(${q.join(", ")})
					});`;if(G?A.push(`import(${H(`${p}/${se}/env.js`)}).then(({ env }) => {
						${M}.env = env;

						${pe.replace(/\n/g,`
	`)}
					});`):A.push(pe),r.service_worker){let O="";if(r.service_worker_options!=null){const C={...r.service_worker_options};O=`, ${H(C)}`}A.push(`if ('serviceWorker' in navigator) {
						addEventListener('load', function () {
							navigator.serviceWorker.register('${T("service-worker.js")}'${O});
						});
					}`)}const he=`
				{
					${A.join(`

					`)}
				}
			`;x.add_script(he),E+=`
			<script${x.script_needs_nonce?` nonce="${x.nonce}"`:""}>${he}<\/script>
		`}const K=new Headers({"x-sveltekit-page":"true","content-type":"text/html"});if(s.prerendering){const j=[],A=x.csp_provider.get_meta();A&&j.push(A),s.prerendering.cache&&j.push(`<meta http-equiv="cache-control" content="${s.prerendering.cache}">`),j.length>0&&(k=j.join(`
`)+k)}else{const j=x.csp_provider.get_header();j&&K.set("content-security-policy",j);const A=x.report_only_provider.get_header();A&&K.set("content-security-policy-report-only",A),w.size&&K.set("link",Array.from(w).join(", "))}k+=v.head;const ke=r.templates.app({head:k,body:E,assets:b,nonce:x.nonce,env:Te}),$e=await l.transformPageChunk({html:ke,done:!0})||"";return X||K.set("etag",`"${zt($e)}"`),X?new Response(new ReadableStream({async start(j){j.enqueue(fe.encode($e+`
`));for await(const A of X)A.length&&j.enqueue(fe.encode(A));j.close()},type:"bytes"}),{headers:K}):z($e,{status:o,headers:K})}class Ge{data;constructor(t){this.data=t}layouts(){return this.data.slice(0,-1)}page(){return this.data.at(-1)}validate(){for(const r of this.layouts())r&&(Kt(r.server,r.server_id),Yt(r.universal,r.universal_id));const t=this.page();t&&(Qt(t.server,t.server_id),Zt(t.universal,t.universal_id))}#e(t){return this.data.reduce((r,n)=>n?.universal?.[t]??n?.server?.[t]??r,void 0)}csr(){return this.#e("csr")??!0}ssr(){return this.#e("ssr")??!0}prerender(){return this.#e("prerender")??!1}trailing_slash(){return this.#e("trailingSlash")??"never"}get_config(){let t={};for(const r of this.data)!r?.universal?.config&&!r?.server?.config||(t={...t,...r?.universal?.config,...r?.server?.config});return Object.keys(t).length?t:void 0}should_prerender_data(){return this.data.some(t=>t?.server?.load||t?.server?.trailingSlash!==void 0)}}async function Ft({event:e,event_state:t,options:r,manifest:n,state:s,status:a,error:o,resolve_opts:i}){if(e.request.headers.get("x-sveltekit-error"))return ye(r,a,o.message);const c=[];try{const u=[],l=await n._.nodes[0](),_=new Ge([l]),g=_.ssr(),h=_.csr(),f=ue(e,t,r);if(g){s.error=!0;const d=Fe({event:e,event_state:t,state:s,node:l,parent:async()=>({})}),y=await d;f.add_node(0,y);const w=await Ct({event:e,event_state:t,fetched:c,node:l,parent:async()=>({}),resolve_opts:i,server_data_promise:d,state:s,csr:h});u.push({node:l,server_data:y,data:w},{node:await n._.nodes[1](),data:null,server_data:null})}return await de({options:r,manifest:n,state:s,page_config:{ssr:g,csr:h},status:a,error:await D(e,t,r,o),branch:u,fetched:c,event:e,event_state:t,resolve_opts:i,data_serializer:f})}catch(u){return u instanceof B?ge(u.status,u.location):ye(r,ae(u),(await D(e,t,r,u)).message)}}async function Jr(e,t,r,n,s){return ee({name:"sveltekit.remote.call",attributes:{},fn:a=>{const o=oe(e,a);return U({event:o,state:t},()=>Vr(o,t,r,n,s))}})}async function Vr(e,t,r,n,s){const[a,o,i]=s.split("/"),c=n._.remotes;c[a]||ve(404);const l=(await c[a]()).default[o];l||ve(404);const _=l.__,g=r.hooks.transport;e.tracing.current.setAttributes({"sveltekit.remote.call.type":_.type,"sveltekit.remote.call.name":_.name});let h;try{if(_.type==="query_batch"){if(e.request.method!=="POST")throw new L(405,"Method Not Allowed",`\`query.batch\` functions must be invoked via POST request, not ${e.request.method}`);const{payloads:w}=await e.request.json(),$=w.map(S=>_e(S,g)),R=await U({event:e,state:t},()=>_.run($)),v=await Promise.all($.map(async(S,p)=>{try{return{type:"result",data:R(S,p)}}catch(b){return{type:"error",error:await D(e,t,r,b),status:b instanceof ne||b instanceof L?b.status:500}}}));return J({type:"result",result:ce(v,g)})}if(_.type==="form"){if(e.request.method!=="POST")throw new L(405,"Method Not Allowed",`\`form\` functions must be invoked via POST request, not ${e.request.method}`);if(!He(e.request))throw new L(415,"Unsupported Media Type",`\`form\` functions expect form-encoded data — received ${e.request.headers.get("content-type")}`);const{data:w,meta:$,form_data:R}=await ft(e.request);i&&!("id"in w)&&(w.id=JSON.parse(decodeURIComponent(i)));const v=_.fn,S=await U({event:e,state:t},()=>v(w,$,R));return J({type:"result",result:ce(S,g),refreshes:S.issues?void 0:await f($.remote_refreshes)})}if(_.type==="command"){const{payload:w,refreshes:$}=await e.request.json(),R=_e(w,g),v=await U({event:e,state:t},()=>l(R));return J({type:"result",result:ce(v,g),refreshes:await f($)})}const d=_.type==="prerender"?i:new URL(e.request.url).searchParams.get("payload"),y=await U({event:e,state:t},()=>l(_e(d,g)));return J({type:"result",result:ce(y,g)})}catch(d){if(d instanceof B)return J({type:"redirect",location:d.location,refreshes:await f(h)});const y=d instanceof ne||d instanceof L?d.status:500;return J({type:"error",error:await D(e,t,r,d),status:y},{status:t.prerendering?y:void 0,headers:{"cache-control":"private, no-store"}})}async function f(d){const y=t.refreshes??{};if(d)for(const w of d){if(y[w]!==void 0)continue;const[$,R,v]=w.split("/"),S=n._.remotes[$],p=(await S?.())?.default?.[R];p||ve(400,"Bad Request"),y[w]=U({event:e,state:t},()=>p(_e(v,g)))}if(Object.keys(y).length!==0)return ce(Object.fromEntries(await Promise.all(Object.entries(y).map(async([w,$])=>[w,await $]))),g)}}async function Xr(e,t,r,n){return ee({name:"sveltekit.remote.form.post",attributes:{},fn:s=>{const a=oe(e,s);return U({event:a,state:t},()=>Kr(a,t,r,n))}})}async function Kr(e,t,r,n){const[s,a,o]=n.split("/");let u=(await r._.remotes[s]?.())?.default[a];if(!u)return e.setHeaders({allow:"GET"}),{type:"error",error:new L(405,"Method Not Allowed","POST method not allowed. No form actions exist for this page")};o&&(u=U({event:e,state:t},()=>u.for(JSON.parse(o))));try{const l=u.__.fn,{data:_,meta:g,form_data:h}=await ft(e.request);return o&&!("id"in _)&&(_.id=JSON.parse(decodeURIComponent(o))),await U({event:e,state:t},()=>l(_,g,h)),{type:"success",status:200}}catch(l){const _=l;return _ instanceof B?{type:"redirect",status:_.status,location:_.location}:{type:"error",error:Me(_)}}}function Yr(e){return e.pathname.startsWith(`${N}/${se}/remote/`)&&e.pathname.replace(`${N}/${se}/remote/`,"")}function Qr(e){return e.searchParams.get("/remote")}const Zr=10;async function en(e,t,r,n,s,a,o,i){if(a.depth>Zr)return z(`Not found: ${e.url.pathname}`,{status:404});if(jt(e)){const c=await s._.nodes[r.leaf]();return Sr(e,t,n,c?.server)}try{const c=o.page();let u=200,l;if(Tr(e)){const b=Qr(e.url);if(b?l=await Xr(e,t,s,b):l=await Ar(e,t,c.server),l?.type==="redirect")return ge(l.status,l.location);l?.type==="error"&&(u=ae(l.error)),l?.type==="failure"&&(u=l.status)}const _=o.prerender();if(_){if(c.server?.actions)throw new Error("Cannot prerender pages with actions")}else if(a.prerendering)return new Response(void 0,{status:204});a.prerender_default=_;const g=o.should_prerender_data(),h=De(e.url.pathname),f=[],d=o.ssr(),y=o.csr();if(d===!1&&!(a.prerendering&&g))return te&&l&&e.request.headers.has("x-sveltekit-action"),await de({branch:[],fetched:f,page_config:{ssr:!1,csr:y},status:u,error:null,event:e,event_state:t,options:n,manifest:s,state:a,resolve_opts:i,data_serializer:ue(e,t,n)});const w=[];let $=null;const R=ue(e,t,n),v=a.prerendering&&g?Pt(e,t,n):null,S=o.data.map((b,m)=>{if($)throw $;return Promise.resolve().then(async()=>{try{if(b===c&&l?.type==="error")throw l.error;const k=await Fe({event:e,event_state:t,state:a,node:b,parent:async()=>{const E={};for(let x=0;x<m;x+=1){const T=await S[x];T&&Object.assign(E,T.data)}return E}});return b&&R.add_node(m,k),v?.add_node(m,k),k}catch(k){throw $=k,$}})}),p=o.data.map((b,m)=>{if($)throw $;return Promise.resolve().then(async()=>{try{return await Ct({event:e,event_state:t,fetched:f,node:b,parent:async()=>{const k={};for(let E=0;E<m;E+=1)Object.assign(k,await p[E]);return k},resolve_opts:i,server_data_promise:S[m],state:a,csr:y})}catch(k){throw $=k,$}})});for(const b of S)b.catch(()=>{});for(const b of p)b.catch(()=>{});for(let b=0;b<o.data.length;b+=1){const m=o.data[b];if(m)try{const k=await S[b],E=await p[b];w.push({node:m,server_data:k,data:E})}catch(k){const E=k;if(E instanceof B){if(a.prerendering&&g){const P=JSON.stringify({type:"redirect",location:E.location});a.prerendering.dependencies.set(h,{response:z(P),body:P})}return ge(E.status,E.location)}const x=ae(E),T=await D(e,t,n,E);for(;b--;)if(r.errors[b]){const P=r.errors[b],M=await s._.nodes[P]();let F=b;for(;!w[F];)F-=1;R.set_max_nodes(F+1);const X=Oe(w.slice(0,F+1)),K=new Ge(X.map(ke=>ke.node));return await de({event:e,event_state:t,options:n,manifest:s,state:a,resolve_opts:i,page_config:{ssr:K.ssr(),csr:K.csr()},status:x,error:T,branch:X.concat({node:M,data:null,server_data:null}),fetched:f,data_serializer:R})}return ye(n,x,T.message)}else w.push(null)}if(a.prerendering&&v){let{data:b,chunks:m}=v.get_data();if(m)for await(const k of m)b+=k;a.prerendering.dependencies.set(h,{response:z(b),body:b})}return await de({event:e,event_state:t,options:n,manifest:s,state:a,resolve_opts:i,page_config:{csr:y,ssr:d},status:u,error:null,branch:d===!1?[]:Oe(w),action_result:l,fetched:f,data_serializer:d===!1?ue(e,t,n):R})}catch(c){return await Ft({event:e,event_state:t,options:n,manifest:s,state:a,status:500,error:c,resolve_opts:i})}}function tn(e){let t=!1,r;return()=>t?r:(t=!0,r=e())}async function rn(e,t,r,n,s,a,o,i){if(!r.page)return new Response(void 0,{status:404});try{const c=[...r.page.layouts,r.page.leaf],u=o??c.map(()=>!0);let l=!1;const _=new URL(e.url);_.pathname=Ne(_.pathname,i);const g={...e,url:_},h=c.map((v,S)=>tn(async()=>{try{if(l)return{type:"skip"};const p=v==null?v:await s._.nodes[v]();return Fe({event:g,event_state:t,state:a,node:p,parent:async()=>{const b={};for(let m=0;m<S;m+=1){const k=await h[m]();k&&Object.assign(b,k.data)}return b}})}catch(p){throw l=!0,p}})),f=h.map(async(v,S)=>u[S]?v():{type:"skip"});let d=f.length;const y=await Promise.all(f.map((v,S)=>v.catch(async p=>{if(p instanceof B)throw p;return d=Math.min(d,S+1),{type:"error",error:await D(e,t,n,p),status:p instanceof ne||p instanceof L?p.status:void 0}}))),w=Pt(e,t,n);for(let v=0;v<y.length;v++)w.add_node(v,y[v]);const{data:$,chunks:R}=w.get_data();return R?new Response(new ReadableStream({async start(v){v.enqueue(fe.encode($));for await(const S of R)v.enqueue(fe.encode(S));v.close()},type:"bytes"}),{headers:{"content-type":"text/sveltekit-data","cache-control":"private, no-store"}}):Pe($)}catch(c){const u=c;return u instanceof B?Ce(u):Pe(await D(e,t,n,u),500)}}function Pe(e,t=200){return z(typeof e=="string"?e:JSON.stringify(e),{status:t,headers:{"content-type":"application/json","cache-control":"private, no-store"}})}function Ce(e){return Pe({type:"redirect",location:e.location})}const nn=/[\x00-\x1F\x7F()<>@,;:"/[\]?={} \t]/;function Ee(e){if(e?.path===void 0)throw new Error("You must specify a `path` when setting, deleting or serializing cookies")}function sn(e,t,r){return`${e||""}${t}?${encodeURIComponent(r)}`}function an(e,t){const r=e.headers.get("cookie")??"",n=me(r,{decode:g=>g});let s;const a=new Map,o={httpOnly:!0,sameSite:"lax",secure:!(t.hostname==="localhost"&&t.protocol==="http:")},i={get(g,h){const f=Array.from(a.values()).filter(w=>w.name===g&&xe(t.hostname,w.options.domain)&&Re(t.pathname,w.options.path)).sort((w,$)=>$.options.path.length-w.options.path.length)[0];return f?f.options.maxAge===0?void 0:f.value:me(r,{decode:h?.decode})[g]},getAll(g){const h=me(r,{decode:g?.decode}),f=new Map;for(const d of a.values())if(xe(t.hostname,d.options.domain)&&Re(t.pathname,d.options.path)){const y=f.get(d.name);(!y||d.options.path.length>y.options.path.length)&&f.set(d.name,d)}for(const d of f.values())h[d.name]=d.value;return Object.entries(h).map(([d,y])=>({name:d,value:y}))},set(g,h,f){const d=g.match(nn);d&&console.warn(`The cookie name "${g}" will be invalid in SvelteKit 3.0 as it contains ${d.join(" and ")}. See RFC 2616 for more details https://datatracker.ietf.org/doc/html/rfc2616#section-2.2`),Ee(f),l(g,h,{...o,...f})},delete(g,h){Ee(h),i.set(g,"",{...h,maxAge:0})},serialize(g,h,f){Ee(f);let d=f.path;if(!f.domain||f.domain===t.hostname){if(!s)throw new Error("Cannot serialize cookies until after the route is determined");d=Xe(s,d)}return Ae(g,h,{...o,...f,path:d})}};function c(g,h){const f={...n};for(const d of a.values()){if(!xe(g.hostname,d.options.domain)||!Re(g.pathname,d.options.path))continue;const y=d.options.encode||encodeURIComponent;f[d.name]=y(d.value)}if(h){const d=me(h,{decode:y=>y});for(const y in d)f[y]=d[y]}return Object.entries(f).map(([d,y])=>`${d}=${y}`).join("; ")}const u=[];function l(g,h,f){if(!s){u.push(()=>l(g,h,f));return}let d=f.path;(!f.domain||f.domain===t.hostname)&&(d=Xe(s,d));const y=sn(f.domain,d,g),w={name:g,value:h,options:{...f,path:d}};a.set(y,w)}function _(g){s=Ne(t.pathname,g),u.forEach(h=>h())}return{cookies:i,new_cookies:a,get_cookie_header:c,set_internal:l,set_trailing_slash:_}}function xe(e,t){if(!t)return!0;const r=t[0]==="."?t.slice(1):t;return e===r?!0:e.endsWith("."+r)}function Re(e,t){if(!t)return!0;const r=t.endsWith("/")?t.slice(0,-1):t;return e===r?!0:e.startsWith(r+"/")}function st(e,t){for(const r of t){const{name:n,value:s,options:a}=r;if(e.append("set-cookie",Ae(n,s,a)),a.path.endsWith(".html")){const o=De(a.path);e.append("set-cookie",Ae(n,s,{...a,path:o}))}}}function on({event:e,options:t,manifest:r,state:n,get_cookie_header:s,set_internal:a}){const o=async(i,c)=>{const u=at(i,c,e.url);let l=(i instanceof Request?i.mode:c?.mode)??"cors",_=(i instanceof Request?i.credentials:c?.credentials)??"same-origin";return t.hooks.handleFetch({event:e,request:u,fetch:async(g,h)=>{const f=at(g,h,e.url),d=new URL(f.url);if(f.headers.has("origin")||f.headers.set("origin",e.url.origin),g!==u&&(l=(g instanceof Request?g.mode:h?.mode)??"cors",_=(g instanceof Request?g.credentials:h?.credentials)??"same-origin"),(f.method==="GET"||f.method==="HEAD")&&(l==="no-cors"&&d.origin!==e.url.origin||d.origin===e.url.origin)&&f.headers.delete("origin"),d.origin!==e.url.origin){if(`.${d.hostname}`.endsWith(`.${e.url.hostname}`)&&_!=="omit"){const m=s(d,f.headers.get("cookie"));m&&f.headers.set("cookie",m)}return fetch(f)}const y=V||N,w=decodeURIComponent(d.pathname),$=(w.startsWith(y)?w.slice(y.length):w).slice(1),R=`${$}/index.html`,v=r.assets.has($)||$ in r._.server_assets,S=r.assets.has(R)||R in r._.server_assets;if(v||S){const m=v?$:R;if(n.read){const k=v?r.mimeTypes[$.slice($.lastIndexOf("."))]:"text/html";return new Response(n.read(m),{headers:k?{"content-type":k}:{}})}else if(Qe&&m in r._.server_assets){const k=r._.server_assets[m],E=r.mimeTypes[m.slice(m.lastIndexOf("."))];return new Response(Qe(m),{headers:{"Content-Length":""+k,"Content-Type":E}})}return await fetch(f)}if(Et(r,N+w))return await fetch(f);if(_!=="omit"){const m=s(d,f.headers.get("cookie"));m&&f.headers.set("cookie",m);const k=e.request.headers.get("authorization");k&&!f.headers.has("authorization")&&f.headers.set("authorization",k)}f.headers.has("accept")||f.headers.set("accept","*/*"),f.headers.has("accept-language")||f.headers.set("accept-language",e.request.headers.get("accept-language"));const p=await cn(f,t,r,n),b=p.headers.get("set-cookie");if(b)for(const m of Ze.splitCookiesString(b)){const{name:k,value:E,...x}=Ze.parseString(m,{decodeValues:!1}),T=x.path??(d.pathname.split("/").slice(0,-1).join("/")||"/");a(k,E,{path:T,encode:P=>P,...x})}return p}})};return(i,c)=>{const u=o(i,c);return u.catch(()=>{}),u}}function at(e,t,r){return e instanceof Request?e:new Request(typeof e=="string"?new URL(e,r):e,t)}async function cn(e,t,r,n){if(e.signal){if(e.signal.aborted)throw new DOMException("The operation was aborted.","AbortError");let s=()=>{};const a=new Promise((i,c)=>{const u=()=>{c(new DOMException("The operation was aborted.","AbortError"))};e.signal.addEventListener("abort",u,{once:!0}),s=()=>e.signal.removeEventListener("abort",u)}),o=await Promise.race([ze(e,t,r,{...n,depth:n.depth+1}),a]);return s(),o}else return await ze(e,t,r,{...n,depth:n.depth+1})}let ot,je,Se;function ln(e){return ot??=`export const env=${JSON.stringify(Te)}`,je??=`W/${Date.now()}`,Se??=new Headers({"content-type":"application/javascript; charset=utf-8",etag:je}),e.headers.get("if-none-match")===je?new Response(void 0,{status:304,headers:Se}):new Response(ot,{headers:Se})}const it=({html:e})=>e,ct=()=>!1,lt=({type:e})=>e==="js"||e==="css",un=new Set(["GET","HEAD","POST"]),dn=new Set(["GET","HEAD","OPTIONS"]);const ze=hn(fn);async function fn(e,t,r,n){const s=new URL(e.url),a=Er(s.pathname),o=$r(s.pathname),i=Yr(s);{const p=e.headers.get("origin");if(i){if(e.method!=="GET"&&p!==s.origin)return J({message:"Cross-site remote requests are forbidden"},{status:403})}else if(t.csrf_check_origin&&He(e)&&(e.method==="POST"||e.method==="PUT"||e.method==="PATCH"||e.method==="DELETE")&&p!==s.origin&&(!p||!t.csrf_trusted_origins.includes(p))){const m=`Cross-site ${e.method} form submissions are forbidden`,k={status:403};return e.headers.get("accept")==="application/json"?J({message:m},k):z(m,k)}}if(t.hash_routing&&s.pathname!==N+"/"&&s.pathname!=="/[fallback]")return z("Not found",{status:404});let c;a?s.pathname=xr(s.pathname):o?(s.pathname=vr(s.pathname)+(s.searchParams.get(Be)==="1"?"/":"")||"/",s.searchParams.delete(Be),c=s.searchParams.get(Je)?.split("").map(p=>p==="1"),s.searchParams.delete(Je)):i&&(s.pathname=e.headers.get("x-sveltekit-pathname")??N,s.search=e.headers.get("x-sveltekit-search")??"");const u={},{cookies:l,new_cookies:_,get_cookie_header:g,set_internal:h,set_trailing_slash:f}=an(e,s),d={prerendering:n.prerendering,transport:t.hooks.transport,handleValidationError:t.hooks.handleValidationError,tracing:{record_span:ee},is_in_remote_function:!1},y={cookies:l,fetch:null,getClientAddress:n.getClientAddress||(()=>{throw new Error("@sveltejs/adapter-static does not specify getClientAddress. Please raise an issue")}),locals:{},params:{},platform:n.platform,request:e,route:{id:null},setHeaders:p=>{for(const b in p){const m=b.toLowerCase(),k=p[b];if(m==="set-cookie")throw new Error("Use `event.cookies.set(name, value, options)` instead of `event.setHeaders` to set cookies");if(m in u)if(m==="server-timing")u[m]+=", "+k;else throw new Error(`"${b}" header is already set`);else u[m]=k,n.prerendering&&m==="cache-control"&&(n.prerendering.cache=k)}},url:s,isDataRequest:o,isSubRequest:n.depth>0,isRemoteRequest:!!i};y.fetch=on({event:y,options:t,manifest:r,state:n,get_cookie_header:g,set_internal:h}),n.emulator?.platform&&(y.platform=await n.emulator.platform({config:{},prerender:!!n.prerendering?.fallback}));let w=s.pathname;if(!i){const p=n.prerendering?.inside_reroute;try{n.prerendering&&(n.prerendering.inside_reroute=!0),w=await t.hooks.reroute({url:new URL(s),fetch:y.fetch})??s.pathname}catch{return z("Internal Server Error",{status:500})}finally{n.prerendering&&(n.prerendering.inside_reroute=p)}}try{w=er(w)}catch{return z("Malformed URI",{status:400})}if(w!==s.pathname&&!n.prerendering?.fallback&&Et(r,w)){const p=new URL(e.url);p.pathname=o?De(w):a?Rt(w):w;const b=await fetch(p,e),m=new Headers(b.headers);return m.has("content-encoding")&&(m.delete("content-encoding"),m.delete("content-length")),new Response(b.body,{headers:m,status:b.status,statusText:b.statusText})}let $=null;if(N&&!n.prerendering?.fallback){if(!w.startsWith(N))return z("Not found",{status:404});w=w.slice(N.length)||"/"}if(a)return Fr(w,new URL(e.url),r);if(w===`/${se}/env.js`)return ln(e);if(!i&&w.startsWith(`/${se}`)){const p=new Headers;return p.set("cache-control","public, max-age=0, must-revalidate"),z("Not found",{status:404,headers:p})}if(!n.prerendering?.fallback){const p=await r._.matchers();for(const b of r._.routes){const m=b.pattern.exec(w);if(!m)continue;const k=Lt(m,b.params,p);if(k){$=b,y.route={id:$.id},y.params=ht(k);break}}}let R={transformPageChunk:it,filterSerializedResponseHeaders:ct,preload:lt},v="never";try{const p=$?.page?new Ge(await pn($.page,r)):void 0;if($&&!i){if(s.pathname===N||s.pathname===N+"/"?v="always":p?v=p.trailing_slash():$.endpoint&&(v=(await $.endpoint()).trailingSlash??"never"),!o){const m=Ne(s.pathname,v);if(m!==s.pathname&&!n.prerendering?.fallback)return new Response(void 0,{status:308,headers:{"x-sveltekit-normalize":"1",location:(m.startsWith("//")?s.origin+m:m)+(s.search==="?"?"":s.search)}})}if(n.before_handle||n.emulator?.platform){let m={},k=!1;if($.endpoint){const E=await $.endpoint();m=E.config??m,k=E.prerender??k}else p&&(m=p.get_config()??m,k=p.prerender());n.before_handle&&n.before_handle(y,m,k),n.emulator?.platform&&(y.platform=await n.emulator.platform({config:m,prerender:k}))}}f(v),n.prerendering&&!n.prerendering.fallback&&!n.prerendering.inside_reroute&&pt(s);const b=await ee({name:"sveltekit.handle.root",attributes:{"http.route":y.route.id||"unknown","http.method":y.request.method,"http.url":y.url.href,"sveltekit.is_data_request":o,"sveltekit.is_sub_request":y.isSubRequest},fn:async m=>{const k={...y,tracing:{enabled:!1,root:m,current:m}};return await U({event:k,state:d},()=>t.hooks.handle({event:k,resolve:(E,x)=>ee({name:"sveltekit.resolve",attributes:{"http.route":E.route.id||"unknown"},fn:T=>U(null,()=>S(oe(E,T),p,x).then(P=>{for(const M in u){const F=u[M];P.headers.set(M,F)}return st(P.headers,_.values()),n.prerendering&&E.route.id!==null&&P.headers.set("x-sveltekit-routeid",encodeURI(E.route.id)),T.setAttributes({"http.response.status_code":P.status,"http.response.body.size":P.headers.get("content-length")||"unknown"}),P}))})}))}});if(b.status===200&&b.headers.has("etag")){let m=e.headers.get("if-none-match");m?.startsWith('W/"')&&(m=m.substring(2));const k=b.headers.get("etag");if(m===k){const E=new Headers({etag:k});for(const x of["cache-control","content-location","date","expires","vary","set-cookie"]){const T=b.headers.get(x);T&&E.set(x,T)}return new Response(void 0,{status:304,headers:E})}}if(o&&b.status>=300&&b.status<=308){const m=b.headers.get("location");if(m)return Ce(new B(b.status,m))}return b}catch(p){if(p instanceof B){const b=o||i?Ce(p):$?.page&&jt(y)?St(p):ge(p.status,p.location);return st(b.headers,_.values()),b}return await et(y,d,t,p)}async function S(p,b,m){try{if(m&&(R={transformPageChunk:m.transformPageChunk||it,filterSerializedResponseHeaders:m.filterSerializedResponseHeaders||ct,preload:m.preload||lt}),t.hash_routing||n.prerendering?.fallback)return await de({event:p,event_state:d,options:t,manifest:r,state:n,page_config:{ssr:!1,csr:!0},status:200,error:null,branch:[],fetched:[],resolve_opts:R,data_serializer:ue(p,d,t)});if(i)return await Jr(p,d,t,r,i);if($){const E=p.request.method;let x;if(o)x=await rn(p,d,$,t,r,n,c,v);else if($.endpoint&&(!$.page||kr(p)))x=await br(p,d,await $.endpoint(),n);else if($.page)if(b)if(un.has(E))x=await en(p,d,$.page,t,r,n,b,R);else{const T=new Set(dn);if((await r._.nodes[$.page.leaf]())?.server?.actions&&T.add("POST"),E==="OPTIONS")x=new Response(null,{status:204,headers:{allow:Array.from(T.values()).join(", ")}});else{const M=[...T].reduce((F,X)=>(F[X]=!0,F),{});x=bt(M,E)}}else throw new Error("page_nodes not found. This should never happen");else throw new Error("Route is neither page nor endpoint. This should never happen");if(e.method==="GET"&&$.page&&$.endpoint){const T=x.headers.get("vary")?.split(",")?.map(P=>P.trim().toLowerCase());T?.includes("accept")||T?.includes("*")||(x=new Response(x.body,{status:x.status,statusText:x.statusText,headers:new Headers(x.headers)}),x.headers.append("Vary","Accept"))}return x}if(n.error&&p.isSubRequest){const E=new Headers(e.headers);return E.set("x-sveltekit-error","true"),await fetch(e,{headers:E})}if(n.error)return z("Internal Server Error",{status:500});if(n.depth===0)return te&&p.url.pathname,await Ft({event:p,event_state:d,options:t,manifest:r,state:n,status:404,error:new L(404,"Not Found",`Not found: ${p.url.pathname}`),resolve_opts:R});if(n.prerendering)return z("not found",{status:404});const k=await fetch(e);return new Response(k.body,k)}catch(k){return await et(p,d,t,k)}finally{p.cookies.set=()=>{throw new Error("Cannot use `cookies.set(...)` after the response has been generated")},p.setHeaders=()=>{throw new Error("Cannot use `setHeaders(...)` after the response has been generated")}}}}function pn(e,t){return Promise.all([...e.layouts.map(r=>r==null?r:t._.nodes[r]()),t._.nodes[e.leaf]()])}function hn(e){return async(t,...r)=>e(t,...r)}function ut(e,t,r){return Object.fromEntries(Object.entries(e).filter(([n])=>n.startsWith(t)&&(r===""||!n.startsWith(r))))}let _n,dt=null;class Tn{#e;#t;constructor(t){if(this.#e=sr,this.#t=t,ur){const r=this.respond.bind(this);this.respond=async(...n)=>{const{promise:s,resolve:a}=_t(),o=dt;return dt=s,await o,r(...n).finally(a)}}}async init({env:t,read:r}){const{env_public_prefix:n,env_private_prefix:s}=this.#e;ar(ut(t,s,n)),or(ut(t,n,s)),r&&cr(o=>{const i=r(o);return i instanceof ReadableStream?i:new ReadableStream({async start(c){try{const u=await Promise.resolve(i);if(!u){c.close();return}const l=u.getReader();for(;;){const{done:_,value:g}=await l.read();if(_)break;c.enqueue(g)}c.close()}catch(u){c.error(u)}}})}),await(_n??=(async()=>{try{const a=await ir();this.#e.hooks={handle:a.handle||(({event:o,resolve:i})=>i(o)),handleError:a.handleError||(({status:o,error:i,event:c})=>{const u=wr(o,i,c);console.error(u)}),handleFetch:a.handleFetch||(({request:o,fetch:i})=>i(o)),handleValidationError:a.handleValidationError||(({issues:o})=>(console.error("Remote function schema validation failed:",o),{message:"Bad Request"})),reroute:a.reroute||(()=>{}),transport:a.transport||{}},a.transport&&Object.fromEntries(Object.entries(a.transport).map(([o,i])=>[o,i.decode])),a.init&&await a.init()}catch(a){throw a}})())}async respond(t,r){return ze(t,this.#e,this.#t,{...r,error:!1,depth:0})}}export{Tn as Server};
