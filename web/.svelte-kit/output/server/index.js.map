{"version":3,"file":"index.js","sources":["../../../node_modules/@sveltejs/kit/src/utils/promise.js","../../../node_modules/@sveltejs/kit/src/runtime/server/constants.js","../../../node_modules/@sveltejs/kit/src/constants.js","../../../node_modules/@sveltejs/kit/src/utils/http.js","../../../node_modules/@sveltejs/kit/src/utils/error.js","../../../node_modules/@sveltejs/kit/src/utils/escape.js","../../../node_modules/@sveltejs/kit/src/runtime/server/utils.js","../../../node_modules/@sveltejs/kit/src/runtime/server/endpoint.js","../../../node_modules/@sveltejs/kit/src/utils/array.js","../../../node_modules/@sveltejs/kit/src/runtime/pathname.js","../../../node_modules/@sveltejs/kit/src/runtime/telemetry/noop.js","../../../node_modules/@sveltejs/kit/src/runtime/telemetry/record_span.js","../../../node_modules/@sveltejs/kit/src/runtime/server/page/actions.js","../../../node_modules/@sveltejs/kit/src/utils/streaming.js","../../../node_modules/@sveltejs/kit/src/runtime/server/page/data_serializer.js","../../../node_modules/@sveltejs/kit/src/runtime/server/page/load_data.js","../../../node_modules/@sveltejs/kit/src/utils/hash.js","../../../node_modules/@sveltejs/kit/src/runtime/server/page/serialize_data.js","../../../node_modules/@sveltejs/kit/src/utils/misc.js","../../../node_modules/@sveltejs/kit/src/runtime/server/page/crypto.js","../../../node_modules/@sveltejs/kit/src/runtime/server/page/csp.js","../../../node_modules/@sveltejs/kit/src/utils/routing.js","../../../node_modules/@sveltejs/kit/src/runtime/server/page/server_routing.js","../../../node_modules/@sveltejs/kit/src/runtime/server/page/render.js","../../../node_modules/@sveltejs/kit/src/utils/page_nodes.js","../../../node_modules/@sveltejs/kit/src/runtime/server/page/respond_with_error.js","../../../node_modules/@sveltejs/kit/src/runtime/server/remote.js","../../../node_modules/@sveltejs/kit/src/runtime/server/page/index.js","../../../node_modules/@sveltejs/kit/src/utils/functions.js","../../../node_modules/@sveltejs/kit/src/runtime/server/data/index.js","../../../node_modules/@sveltejs/kit/src/runtime/server/cookie.js","../../../node_modules/@sveltejs/kit/src/runtime/server/fetch.js","../../../node_modules/@sveltejs/kit/src/runtime/server/env_module.js","../../../node_modules/@sveltejs/kit/src/runtime/server/respond.js","../../../node_modules/@sveltejs/kit/src/utils/env.js","../../../node_modules/@sveltejs/kit/src/runtime/server/index.js"],"sourcesContent":["/** @see https://github.com/microsoft/TypeScript/blob/904e7dd97dc8da1352c8e05d70829dff17c73214/src/lib/es2024.promise.d.ts */\n\n/**\n * @template T\n * @typedef {{\n *   promise: Promise<T>;\n *   resolve: (value: T | PromiseLike<T>) => void;\n *   reject: (reason?: any) => void;\n * }} PromiseWithResolvers<T>\n */\n\n/**\n * TODO: Whenever Node >21 is minimum supported version, we can use `Promise.withResolvers` to avoid this ceremony\n *\n * @template T\n * @returns {PromiseWithResolvers<T>}\n */\nexport function with_resolvers() {\n\tlet resolve;\n\tlet reject;\n\n\tconst promise = new Promise((res, rej) => {\n\t\tresolve = res;\n\t\treject = rej;\n\t});\n\n\t// @ts-expect-error `resolve` and `reject` are assigned!\n\treturn { promise, resolve, reject };\n}\n","export const NULL_BODY_STATUS = [101, 103, 204, 205, 304];\n\n// eslint-disable-next-line n/prefer-global/process\nexport const IN_WEBCONTAINER = !!globalThis.process?.versions?.webcontainer;\n","/**\n * A fake asset path used in `vite dev` and `vite preview`, so that we can\n * serve local assets while verifying that requests are correctly prefixed\n */\nexport const SVELTE_KIT_ASSETS = '/_svelte_kit_assets';\n\nexport const GENERATED_COMMENT = '// this file is generated — do not edit it\\n';\n\nexport const ENDPOINT_METHODS = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE', 'OPTIONS', 'HEAD'];\n\nexport const PAGE_METHODS = ['GET', 'POST', 'HEAD'];\n","import { BINARY_FORM_CONTENT_TYPE } from '../runtime/form-utils.js';\n\n/**\n * Given an Accept header and a list of possible content types, pick\n * the most suitable one to respond with\n * @param {string} accept\n * @param {string[]} types\n */\nexport function negotiate(accept, types) {\n\t/** @type {Array<{ type: string, subtype: string, q: number, i: number }>} */\n\tconst parts = [];\n\n\taccept.split(',').forEach((str, i) => {\n\t\tconst match = /([^/ \\t]+)\\/([^; \\t]+)[ \\t]*(?:;[ \\t]*q=([0-9.]+))?/.exec(str);\n\n\t\t// no match equals invalid header — ignore\n\t\tif (match) {\n\t\t\tconst [, type, subtype, q = '1'] = match;\n\t\t\tparts.push({ type, subtype, q: +q, i });\n\t\t}\n\t});\n\n\tparts.sort((a, b) => {\n\t\tif (a.q !== b.q) {\n\t\t\treturn b.q - a.q;\n\t\t}\n\n\t\tif ((a.subtype === '*') !== (b.subtype === '*')) {\n\t\t\treturn a.subtype === '*' ? 1 : -1;\n\t\t}\n\n\t\tif ((a.type === '*') !== (b.type === '*')) {\n\t\t\treturn a.type === '*' ? 1 : -1;\n\t\t}\n\n\t\treturn a.i - b.i;\n\t});\n\n\tlet accepted;\n\tlet min_priority = Infinity;\n\n\tfor (const mimetype of types) {\n\t\tconst [type, subtype] = mimetype.split('/');\n\t\tconst priority = parts.findIndex(\n\t\t\t(part) =>\n\t\t\t\t(part.type === type || part.type === '*') &&\n\t\t\t\t(part.subtype === subtype || part.subtype === '*')\n\t\t);\n\n\t\tif (priority !== -1 && priority < min_priority) {\n\t\t\taccepted = mimetype;\n\t\t\tmin_priority = priority;\n\t\t}\n\t}\n\n\treturn accepted;\n}\n\n/**\n * Returns `true` if the request contains a `content-type` header with the given type\n * @param {Request} request\n * @param  {...string} types\n */\nfunction is_content_type(request, ...types) {\n\tconst type = request.headers.get('content-type')?.split(';', 1)[0].trim() ?? '';\n\treturn types.includes(type.toLowerCase());\n}\n\n/**\n * @param {Request} request\n */\nexport function is_form_content_type(request) {\n\t// These content types must be protected against CSRF\n\t// https://developer.mozilla.org/en-US/docs/Web/API/HTMLFormElement/enctype\n\treturn is_content_type(\n\t\trequest,\n\t\t'application/x-www-form-urlencoded',\n\t\t'multipart/form-data',\n\t\t'text/plain',\n\t\tBINARY_FORM_CONTENT_TYPE\n\t);\n}\n","import { HttpError, SvelteKitError } from '@sveltejs/kit/internal';\n\n/**\n * @param {unknown} err\n * @return {Error}\n */\nexport function coalesce_to_error(err) {\n\treturn err instanceof Error ||\n\t\t(err && /** @type {any} */ (err).name && /** @type {any} */ (err).message)\n\t\t? /** @type {Error} */ (err)\n\t\t: new Error(JSON.stringify(err));\n}\n\n/**\n * This is an identity function that exists to make TypeScript less\n * paranoid about people throwing things that aren't errors, which\n * frankly is not something we should care about\n * @param {unknown} error\n */\nexport function normalize_error(error) {\n\treturn /** @type {import('../exports/internal/index.js').Redirect | HttpError | SvelteKitError | Error} */ (\n\t\terror\n\t);\n}\n\n/**\n * @param {unknown} error\n */\nexport function get_status(error) {\n\treturn error instanceof HttpError || error instanceof SvelteKitError ? error.status : 500;\n}\n\n/**\n * @param {unknown} error\n */\nexport function get_message(error) {\n\treturn error instanceof SvelteKitError ? error.text : 'Internal Error';\n}\n","/**\n * When inside a double-quoted attribute value, only `&` and `\"` hold special meaning.\n * @see https://html.spec.whatwg.org/multipage/parsing.html#attribute-value-(double-quoted)-state\n * @type {Record<string, string>}\n */\nconst escape_html_attr_dict = {\n\t'&': '&amp;',\n\t'\"': '&quot;'\n\t// Svelte also escapes < because the escape function could be called inside a `noscript` there\n\t// https://github.com/sveltejs/svelte/security/advisories/GHSA-8266-84wp-wv5c\n\t// However, that doesn't apply in SvelteKit\n};\n\n/**\n * @type {Record<string, string>}\n */\nconst escape_html_dict = {\n\t'&': '&amp;',\n\t'<': '&lt;'\n};\n\nconst surrogates = // high surrogate without paired low surrogate\n\t'[\\\\ud800-\\\\udbff](?![\\\\udc00-\\\\udfff])|' +\n\t// a valid surrogate pair, the only match with 2 code units\n\t// we match it so that we can match unpaired low surrogates in the same pass\n\t// TODO: use lookbehind assertions once they are widely supported: (?<![\\ud800-udbff])[\\udc00-\\udfff]\n\t'[\\\\ud800-\\\\udbff][\\\\udc00-\\\\udfff]|' +\n\t// unpaired low surrogate (see previous match)\n\t'[\\\\udc00-\\\\udfff]';\n\nconst escape_html_attr_regex = new RegExp(\n\t`[${Object.keys(escape_html_attr_dict).join('')}]|` + surrogates,\n\t'g'\n);\n\nconst escape_html_regex = new RegExp(\n\t`[${Object.keys(escape_html_dict).join('')}]|` + surrogates,\n\t'g'\n);\n\n/**\n * Escapes unpaired surrogates (which are allowed in js strings but invalid in HTML) and\n * escapes characters that are special.\n *\n * @param {string} str\n * @param {boolean} [is_attr]\n * @returns {string} escaped string\n * @example const html = `<tag data-value=\"${escape_html('value', true)}\">...</tag>`;\n */\nexport function escape_html(str, is_attr) {\n\tconst dict = is_attr ? escape_html_attr_dict : escape_html_dict;\n\tconst escaped_str = str.replace(is_attr ? escape_html_attr_regex : escape_html_regex, (match) => {\n\t\tif (match.length === 2) {\n\t\t\t// valid surrogate pair\n\t\t\treturn match;\n\t\t}\n\n\t\treturn dict[match] ?? `&#${match.charCodeAt(0)};`;\n\t});\n\n\treturn escaped_str;\n}\n","import { DEV } from 'esm-env';\nimport { json, text } from '@sveltejs/kit';\nimport { HttpError } from '@sveltejs/kit/internal';\nimport { with_request_store } from '@sveltejs/kit/internal/server';\nimport { coalesce_to_error, get_message, get_status } from '../../utils/error.js';\nimport { negotiate } from '../../utils/http.js';\nimport { fix_stack_trace } from '../shared-server.js';\nimport { ENDPOINT_METHODS } from '../../constants.js';\nimport { escape_html } from '../../utils/escape.js';\n\n/** @param {any} body */\nexport function is_pojo(body) {\n\tif (typeof body !== 'object') return false;\n\n\tif (body) {\n\t\tif (body instanceof Uint8Array) return false;\n\t\tif (body instanceof ReadableStream) return false;\n\t}\n\n\treturn true;\n}\n\n/**\n * @param {Partial<Record<import('types').HttpMethod, any>>} mod\n * @param {import('types').HttpMethod} method\n */\nexport function method_not_allowed(mod, method) {\n\treturn text(`${method} method not allowed`, {\n\t\tstatus: 405,\n\t\theaders: {\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/405\n\t\t\t// \"The server must generate an Allow header field in a 405 status code response\"\n\t\t\tallow: allowed_methods(mod).join(', ')\n\t\t}\n\t});\n}\n\n/** @param {Partial<Record<import('types').HttpMethod, any>>} mod */\nexport function allowed_methods(mod) {\n\tconst allowed = ENDPOINT_METHODS.filter((method) => method in mod);\n\n\t// if there's no HEAD handler, but we have a GET handler, we respond to\n\t// HEAD requests using the GET handler and omit the response body.\n\tif ('GET' in mod && !('HEAD' in mod)) {\n\t\tallowed.push('HEAD');\n\t}\n\n\treturn allowed;\n}\n\n/**\n * @param {import('types').SSROptions} options\n */\nexport function get_global_name(options) {\n\treturn DEV ? '__sveltekit_dev' : `__sveltekit_${options.version_hash}`;\n}\n\n/**\n * Return as a response that renders the error.html\n *\n * @param {import('types').SSROptions} options\n * @param {number} status\n * @param {string} message\n */\nexport function static_error_page(options, status, message) {\n\tlet page = options.templates.error({ status, message: escape_html(message) });\n\n\tif (DEV) {\n\t\t// inject Vite HMR client, for easier debugging\n\t\tpage = page.replace('</head>', '<script type=\"module\" src=\"/@vite/client\"></script></head>');\n\t}\n\n\treturn text(page, {\n\t\theaders: { 'content-type': 'text/html; charset=utf-8' },\n\t\tstatus\n\t});\n}\n\n/**\n * @param {import('@sveltejs/kit').RequestEvent} event\n * @param {import('types').RequestState} state\n * @param {import('types').SSROptions} options\n * @param {unknown} error\n */\nexport async function handle_fatal_error(event, state, options, error) {\n\terror = error instanceof HttpError ? error : coalesce_to_error(error);\n\tconst status = get_status(error);\n\tconst body = await handle_error_and_jsonify(event, state, options, error);\n\n\t// ideally we'd use sec-fetch-dest instead, but Safari — quelle surprise — doesn't support it\n\tconst type = negotiate(event.request.headers.get('accept') || 'text/html', [\n\t\t'application/json',\n\t\t'text/html'\n\t]);\n\n\tif (event.isDataRequest || type === 'application/json') {\n\t\treturn json(body, {\n\t\t\tstatus\n\t\t});\n\t}\n\n\treturn static_error_page(options, status, body.message);\n}\n\n/**\n * @param {import('@sveltejs/kit').RequestEvent} event\n * @param {import('types').RequestState} state\n * @param {import('types').SSROptions} options\n * @param {any} error\n * @returns {Promise<App.Error>}\n */\nexport async function handle_error_and_jsonify(event, state, options, error) {\n\tif (error instanceof HttpError) {\n\t\t// @ts-expect-error custom user errors may not have a message field if App.Error is overwritten\n\t\treturn { message: 'Unknown Error', ...error.body };\n\t}\n\n\tif (DEV && typeof error == 'object') {\n\t\tfix_stack_trace(error);\n\t}\n\n\tconst status = get_status(error);\n\tconst message = get_message(error);\n\n\treturn (\n\t\t(await with_request_store({ event, state }, () =>\n\t\t\toptions.hooks.handleError({ error, event, status, message })\n\t\t)) ?? { message }\n\t);\n}\n\n/**\n * @param {number} status\n * @param {string} location\n */\nexport function redirect_response(status, location) {\n\tconst response = new Response(undefined, {\n\t\tstatus,\n\t\theaders: { location }\n\t});\n\treturn response;\n}\n\n/**\n * @param {import('@sveltejs/kit').RequestEvent} event\n * @param {Error & { path: string }} error\n */\nexport function clarify_devalue_error(event, error) {\n\tif (error.path) {\n\t\treturn (\n\t\t\t`Data returned from \\`load\\` while rendering ${event.route.id} is not serializable: ${error.message} (${error.path}). ` +\n\t\t\t`If you need to serialize/deserialize custom types, use transport hooks: https://svelte.dev/docs/kit/hooks#Universal-hooks-transport.`\n\t\t);\n\t}\n\n\tif (error.path === '') {\n\t\treturn `Data returned from \\`load\\` while rendering ${event.route.id} is not a plain object`;\n\t}\n\n\t// belt and braces — this should never happen\n\treturn error.message;\n}\n\n/**\n * @param {import('types').ServerDataNode} node\n */\nexport function serialize_uses(node) {\n\tconst uses = {};\n\n\tif (node.uses && node.uses.dependencies.size > 0) {\n\t\tuses.dependencies = Array.from(node.uses.dependencies);\n\t}\n\n\tif (node.uses && node.uses.search_params.size > 0) {\n\t\tuses.search_params = Array.from(node.uses.search_params);\n\t}\n\n\tif (node.uses && node.uses.params.size > 0) {\n\t\tuses.params = Array.from(node.uses.params);\n\t}\n\n\tif (node.uses?.parent) uses.parent = 1;\n\tif (node.uses?.route) uses.route = 1;\n\tif (node.uses?.url) uses.url = 1;\n\n\treturn uses;\n}\n\n/**\n * Returns `true` if the given path was prerendered\n * @param {import('@sveltejs/kit').SSRManifest} manifest\n * @param {string} pathname Should include the base and be decoded\n */\nexport function has_prerendered_path(manifest, pathname) {\n\treturn (\n\t\tmanifest._.prerendered_routes.has(pathname) ||\n\t\t(pathname.at(-1) === '/' && manifest._.prerendered_routes.has(pathname.slice(0, -1)))\n\t);\n}\n\n/**\n * Formats the error into a nice message with sanitized stack trace\n * @param {number} status\n * @param {Error} error\n * @param {import('@sveltejs/kit').RequestEvent} event\n */\nexport function format_server_error(status, error, event) {\n\tconst formatted_text = `\\n\\x1b[1;31m[${status}] ${event.request.method} ${event.url.pathname}\\x1b[0m`;\n\n\tif (status === 404) {\n\t\treturn formatted_text;\n\t}\n\n\treturn `${formatted_text}\\n${DEV ? clean_up_stack_trace(error) : error.stack}`;\n}\n\n/**\n * In dev, tidy up stack traces by making paths relative to the current project directory\n * @param {string} file\n */\nlet relative = (file) => file;\n\nif (DEV) {\n\ttry {\n\t\tconst path = await import('node:path');\n\t\tconst process = await import('node:process');\n\n\t\trelative = (file) => path.relative(process.cwd(), file);\n\t} catch {\n\t\t// do nothing\n\t}\n}\n\n/**\n * Provides a refined stack trace by excluding lines following the last occurrence of a line containing +page. +layout. or +server.\n * @param {Error} error\n */\nexport function clean_up_stack_trace(error) {\n\tconst stack_trace = (error.stack?.split('\\n') ?? []).map((line) => {\n\t\treturn line.replace(/\\((.+)(:\\d+:\\d+)\\)$/, (_, file, loc) => `(${relative(file)}${loc})`);\n\t});\n\n\t// progressive enhancement for people who haven't configured kit.files.src to something else\n\tconst last_line_from_src_code = stack_trace.findLastIndex((line) => /\\(src[\\\\/]/.test(line));\n\n\tif (last_line_from_src_code === -1) {\n\t\t// default to the whole stack trace\n\t\treturn error.stack;\n\t}\n\n\treturn stack_trace.slice(0, last_line_from_src_code + 1).join('\\n');\n}\n\n/**\n * Returns the filename without the extension. e.g., `+page.server`, `+page`, etc.\n * @param {string | undefined} node_id\n * @returns {string}\n */\nexport function get_node_type(node_id) {\n\tconst parts = node_id?.split('/');\n\tconst filename = parts?.at(-1);\n\tif (!filename) return 'unknown';\n\tconst dot_parts = filename.split('.');\n\treturn dot_parts.slice(0, -1).join('.');\n}\n","import { Redirect } from '@sveltejs/kit/internal';\nimport { with_request_store } from '@sveltejs/kit/internal/server';\nimport { ENDPOINT_METHODS, PAGE_METHODS } from '../../constants.js';\nimport { negotiate } from '../../utils/http.js';\nimport { method_not_allowed } from './utils.js';\n\n/**\n * @param {import('@sveltejs/kit').RequestEvent} event\n * @param {import('types').RequestState} event_state\n * @param {import('types').SSREndpoint} mod\n * @param {import('types').SSRState} state\n * @returns {Promise<Response>}\n */\nexport async function render_endpoint(event, event_state, mod, state) {\n\tconst method = /** @type {import('types').HttpMethod} */ (event.request.method);\n\n\tlet handler = mod[method] || mod.fallback;\n\n\tif (method === 'HEAD' && !mod.HEAD && mod.GET) {\n\t\thandler = mod.GET;\n\t}\n\n\tif (!handler) {\n\t\treturn method_not_allowed(mod, method);\n\t}\n\n\tconst prerender = mod.prerender ?? state.prerender_default;\n\n\tif (prerender && (mod.POST || mod.PATCH || mod.PUT || mod.DELETE)) {\n\t\tthrow new Error('Cannot prerender endpoints that have mutative methods');\n\t}\n\n\tif (state.prerendering && !state.prerendering.inside_reroute && !prerender) {\n\t\tif (state.depth > 0) {\n\t\t\t// if request came from a prerendered page, bail\n\t\t\tthrow new Error(`${event.route.id} is not prerenderable`);\n\t\t} else {\n\t\t\t// if request came direct from the crawler, signal that\n\t\t\t// this route cannot be prerendered, but don't bail\n\t\t\treturn new Response(undefined, { status: 204 });\n\t\t}\n\t}\n\n\tevent_state.is_endpoint_request = true;\n\n\ttry {\n\t\tconst response = await with_request_store({ event, state: event_state }, () =>\n\t\t\thandler(/** @type {import('@sveltejs/kit').RequestEvent<Record<string, any>>} */ (event))\n\t\t);\n\n\t\tif (!(response instanceof Response)) {\n\t\t\tthrow new Error(\n\t\t\t\t`Invalid response from route ${event.url.pathname}: handler should return a Response object`\n\t\t\t);\n\t\t}\n\n\t\tif (state.prerendering && (!state.prerendering.inside_reroute || prerender)) {\n\t\t\t// The returned Response might have immutable Headers\n\t\t\t// so we should clone them before trying to mutate them.\n\t\t\t// We also need to clone the response body since it may be read twice during prerendering\n\t\t\tconst cloned = new Response(response.clone().body, {\n\t\t\t\tstatus: response.status,\n\t\t\t\tstatusText: response.statusText,\n\t\t\t\theaders: new Headers(response.headers)\n\t\t\t});\n\t\t\tcloned.headers.set('x-sveltekit-prerender', String(prerender));\n\n\t\t\tif (state.prerendering.inside_reroute && prerender) {\n\t\t\t\t// Without this, the route wouldn't be recorded as prerendered,\n\t\t\t\t// because there's nothing after reroute that would do that.\n\t\t\t\tcloned.headers.set(\n\t\t\t\t\t'x-sveltekit-routeid',\n\t\t\t\t\tencodeURI(/** @type {string} */ (event.route.id))\n\t\t\t\t);\n\t\t\t\tstate.prerendering.dependencies.set(event.url.pathname, { response: cloned, body: null });\n\t\t\t} else {\n\t\t\t\treturn cloned;\n\t\t\t}\n\t\t}\n\n\t\treturn response;\n\t} catch (e) {\n\t\tif (e instanceof Redirect) {\n\t\t\treturn new Response(undefined, {\n\t\t\t\tstatus: e.status,\n\t\t\t\theaders: { location: e.location }\n\t\t\t});\n\t\t}\n\n\t\tthrow e;\n\t}\n}\n\n/**\n * @param {import('@sveltejs/kit').RequestEvent} event\n */\nexport function is_endpoint_request(event) {\n\tconst { method, headers } = event.request;\n\n\t// These methods exist exclusively for endpoints\n\tif (ENDPOINT_METHODS.includes(method) && !PAGE_METHODS.includes(method)) {\n\t\treturn true;\n\t}\n\n\t// use:enhance uses a custom header to disambiguate\n\tif (method === 'POST' && headers.get('x-sveltekit-action') === 'true') return false;\n\n\t// GET/POST requests may be for endpoints or pages. We prefer endpoints if this isn't a text/html request\n\tconst accept = event.request.headers.get('accept') ?? '*/*';\n\treturn negotiate(accept, ['*', 'text/html']) !== 'text/html';\n}\n","/**\n * Removes nullish values from an array.\n *\n * @template T\n * @param {Array<T>} arr\n */\nexport function compact(arr) {\n\treturn arr.filter(/** @returns {val is NonNullable<T>} */ (val) => val != null);\n}\n","const DATA_SUFFIX = '/__data.json';\nconst HTML_DATA_SUFFIX = '.html__data.json';\n\n/** @param {string} pathname */\nexport function has_data_suffix(pathname) {\n\treturn pathname.endsWith(DATA_SUFFIX) || pathname.endsWith(HTML_DATA_SUFFIX);\n}\n\n/** @param {string} pathname */\nexport function add_data_suffix(pathname) {\n\tif (pathname.endsWith('.html')) return pathname.replace(/\\.html$/, HTML_DATA_SUFFIX);\n\treturn pathname.replace(/\\/$/, '') + DATA_SUFFIX;\n}\n\n/** @param {string} pathname */\nexport function strip_data_suffix(pathname) {\n\tif (pathname.endsWith(HTML_DATA_SUFFIX)) {\n\t\treturn pathname.slice(0, -HTML_DATA_SUFFIX.length) + '.html';\n\t}\n\n\treturn pathname.slice(0, -DATA_SUFFIX.length);\n}\n\nconst ROUTE_SUFFIX = '/__route.js';\n\n/**\n * @param {string} pathname\n * @returns {boolean}\n */\nexport function has_resolution_suffix(pathname) {\n\treturn pathname.endsWith(ROUTE_SUFFIX);\n}\n\n/**\n * Convert a regular URL to a route to send to SvelteKit's server-side route resolution endpoint\n * @param {string} pathname\n * @returns {string}\n */\nexport function add_resolution_suffix(pathname) {\n\treturn pathname.replace(/\\/$/, '') + ROUTE_SUFFIX;\n}\n\n/**\n * @param {string} pathname\n * @returns {string}\n */\nexport function strip_resolution_suffix(pathname) {\n\treturn pathname.slice(0, -ROUTE_SUFFIX.length);\n}\n","/** @import { Tracer, Span, SpanContext } from '@opentelemetry/api' */\n\n/**\n * Tracer implementation that does nothing (null object).\n * @type {Tracer}\n */\nexport const noop_tracer = {\n\t/**\n\t * @returns {Span}\n\t */\n\tstartSpan() {\n\t\treturn noop_span;\n\t},\n\n\t/**\n\t * @param {unknown} _name\n\t * @param {unknown} arg_1\n\t * @param {unknown} [arg_2]\n\t * @param {Function} [arg_3]\n\t * @returns {unknown}\n\t */\n\tstartActiveSpan(_name, arg_1, arg_2, arg_3) {\n\t\tif (typeof arg_1 === 'function') {\n\t\t\treturn arg_1(noop_span);\n\t\t}\n\t\tif (typeof arg_2 === 'function') {\n\t\t\treturn arg_2(noop_span);\n\t\t}\n\t\tif (typeof arg_3 === 'function') {\n\t\t\treturn arg_3(noop_span);\n\t\t}\n\t}\n};\n\n/**\n * @type {Span}\n */\nexport const noop_span = {\n\tspanContext() {\n\t\treturn noop_span_context;\n\t},\n\tsetAttribute() {\n\t\treturn this;\n\t},\n\tsetAttributes() {\n\t\treturn this;\n\t},\n\taddEvent() {\n\t\treturn this;\n\t},\n\tsetStatus() {\n\t\treturn this;\n\t},\n\tupdateName() {\n\t\treturn this;\n\t},\n\tend() {\n\t\treturn this;\n\t},\n\tisRecording() {\n\t\treturn false;\n\t},\n\trecordException() {\n\t\treturn this;\n\t},\n\taddLink() {\n\t\treturn this;\n\t},\n\taddLinks() {\n\t\treturn this;\n\t}\n};\n\n/**\n * @type {SpanContext}\n */\nconst noop_span_context = {\n\ttraceId: '',\n\tspanId: '',\n\ttraceFlags: 0\n};\n","/** @import { RecordSpan } from 'types' */\nimport { HttpError, Redirect } from '@sveltejs/kit/internal';\nimport { noop_span } from './noop.js';\nimport { otel } from './otel.js';\n\n/** @type {RecordSpan} */\nexport async function record_span({ name, attributes, fn }) {\n\tif (otel === null) {\n\t\treturn fn(noop_span);\n\t}\n\n\tconst { SpanStatusCode, tracer } = await otel;\n\n\treturn tracer.startActiveSpan(name, { attributes }, async (span) => {\n\t\ttry {\n\t\t\treturn await fn(span);\n\t\t} catch (error) {\n\t\t\tif (error instanceof HttpError) {\n\t\t\t\tspan.setAttributes({\n\t\t\t\t\t[`${name}.result.type`]: 'known_error',\n\t\t\t\t\t[`${name}.result.status`]: error.status,\n\t\t\t\t\t[`${name}.result.message`]: error.body.message\n\t\t\t\t});\n\t\t\t\tif (error.status >= 500) {\n\t\t\t\t\tspan.recordException({\n\t\t\t\t\t\tname: 'HttpError',\n\t\t\t\t\t\tmessage: error.body.message\n\t\t\t\t\t});\n\t\t\t\t\tspan.setStatus({\n\t\t\t\t\t\tcode: SpanStatusCode.ERROR,\n\t\t\t\t\t\tmessage: error.body.message\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (error instanceof Redirect) {\n\t\t\t\tspan.setAttributes({\n\t\t\t\t\t[`${name}.result.type`]: 'redirect',\n\t\t\t\t\t[`${name}.result.status`]: error.status,\n\t\t\t\t\t[`${name}.result.location`]: error.location\n\t\t\t\t});\n\t\t\t} else if (error instanceof Error) {\n\t\t\t\tspan.setAttributes({\n\t\t\t\t\t[`${name}.result.type`]: 'unknown_error'\n\t\t\t\t});\n\t\t\t\tspan.recordException({\n\t\t\t\t\tname: error.name,\n\t\t\t\t\tmessage: error.message,\n\t\t\t\t\tstack: error.stack\n\t\t\t\t});\n\t\t\t\tspan.setStatus({\n\t\t\t\t\tcode: SpanStatusCode.ERROR,\n\t\t\t\t\tmessage: error.message\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tspan.setAttributes({\n\t\t\t\t\t[`${name}.result.type`]: 'unknown_error'\n\t\t\t\t});\n\t\t\t\tspan.setStatus({ code: SpanStatusCode.ERROR });\n\t\t\t}\n\n\t\t\tthrow error;\n\t\t} finally {\n\t\t\tspan.end();\n\t\t}\n\t});\n}\n","/** @import { RequestEvent, ActionResult, Actions } from '@sveltejs/kit' */\n/** @import { SSROptions, SSRNode, ServerNode, ServerHooks } from 'types' */\nimport * as devalue from 'devalue';\nimport { DEV } from 'esm-env';\nimport { json } from '@sveltejs/kit';\nimport { HttpError, Redirect, ActionFailure, SvelteKitError } from '@sveltejs/kit/internal';\nimport { with_request_store, merge_tracing } from '@sveltejs/kit/internal/server';\nimport { get_status, normalize_error } from '../../../utils/error.js';\nimport { is_form_content_type, negotiate } from '../../../utils/http.js';\nimport { handle_error_and_jsonify } from '../utils.js';\nimport { record_span } from '../../telemetry/record_span.js';\n\n/** @param {RequestEvent} event */\nexport function is_action_json_request(event) {\n\tconst accept = negotiate(event.request.headers.get('accept') ?? '*/*', [\n\t\t'application/json',\n\t\t'text/html'\n\t]);\n\n\treturn accept === 'application/json' && event.request.method === 'POST';\n}\n\n/**\n * @param {RequestEvent} event\n * @param {import('types').RequestState} event_state\n * @param {SSROptions} options\n * @param {SSRNode['server'] | undefined} server\n */\nexport async function handle_action_json_request(event, event_state, options, server) {\n\tconst actions = server?.actions;\n\n\tif (!actions) {\n\t\tconst no_actions_error = new SvelteKitError(\n\t\t\t405,\n\t\t\t'Method Not Allowed',\n\t\t\t`POST method not allowed. No form actions exist for ${DEV ? `the page at ${event.route.id}` : 'this page'}`\n\t\t);\n\n\t\treturn action_json(\n\t\t\t{\n\t\t\t\ttype: 'error',\n\t\t\t\terror: await handle_error_and_jsonify(event, event_state, options, no_actions_error)\n\t\t\t},\n\t\t\t{\n\t\t\t\tstatus: no_actions_error.status,\n\t\t\t\theaders: {\n\t\t\t\t\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/405\n\t\t\t\t\t// \"The server must generate an Allow header field in a 405 status code response\"\n\t\t\t\t\tallow: 'GET'\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\tcheck_named_default_separate(actions);\n\n\ttry {\n\t\tconst data = await call_action(event, event_state, actions);\n\n\t\tif (DEV) {\n\t\t\tvalidate_action_return(data);\n\t\t}\n\n\t\tif (data instanceof ActionFailure) {\n\t\t\treturn action_json({\n\t\t\t\ttype: 'failure',\n\t\t\t\tstatus: data.status,\n\t\t\t\t// @ts-expect-error we assign a string to what is supposed to be an object. That's ok\n\t\t\t\t// because we don't use the object outside, and this way we have better code navigation\n\t\t\t\t// through knowing where the related interface is used.\n\t\t\t\tdata: stringify_action_response(\n\t\t\t\t\tdata.data,\n\t\t\t\t\t/** @type {string} */ (event.route.id),\n\t\t\t\t\toptions.hooks.transport\n\t\t\t\t)\n\t\t\t});\n\t\t} else {\n\t\t\treturn action_json({\n\t\t\t\ttype: 'success',\n\t\t\t\tstatus: data ? 200 : 204,\n\t\t\t\t// @ts-expect-error see comment above\n\t\t\t\tdata: stringify_action_response(\n\t\t\t\t\tdata,\n\t\t\t\t\t/** @type {string} */ (event.route.id),\n\t\t\t\t\toptions.hooks.transport\n\t\t\t\t)\n\t\t\t});\n\t\t}\n\t} catch (e) {\n\t\tconst err = normalize_error(e);\n\n\t\tif (err instanceof Redirect) {\n\t\t\treturn action_json_redirect(err);\n\t\t}\n\n\t\treturn action_json(\n\t\t\t{\n\t\t\t\ttype: 'error',\n\t\t\t\terror: await handle_error_and_jsonify(\n\t\t\t\t\tevent,\n\t\t\t\t\tevent_state,\n\t\t\t\t\toptions,\n\t\t\t\t\tcheck_incorrect_fail_use(err)\n\t\t\t\t)\n\t\t\t},\n\t\t\t{\n\t\t\t\tstatus: get_status(err)\n\t\t\t}\n\t\t);\n\t}\n}\n\n/**\n * @param {HttpError | Error} error\n */\nexport function check_incorrect_fail_use(error) {\n\treturn error instanceof ActionFailure\n\t\t? new Error('Cannot \"throw fail()\". Use \"return fail()\"')\n\t\t: error;\n}\n\n/**\n * @param {Redirect} redirect\n */\nexport function action_json_redirect(redirect) {\n\treturn action_json({\n\t\ttype: 'redirect',\n\t\tstatus: redirect.status,\n\t\tlocation: redirect.location\n\t});\n}\n\n/**\n * @param {ActionResult} data\n * @param {ResponseInit} [init]\n */\nfunction action_json(data, init) {\n\treturn json(data, init);\n}\n\n/**\n * @param {RequestEvent} event\n */\nexport function is_action_request(event) {\n\treturn event.request.method === 'POST';\n}\n\n/**\n * @param {RequestEvent} event\n * @param {import('types').RequestState} event_state\n * @param {SSRNode['server'] | undefined} server\n * @returns {Promise<ActionResult>}\n */\nexport async function handle_action_request(event, event_state, server) {\n\tconst actions = server?.actions;\n\n\tif (!actions) {\n\t\t// TODO should this be a different error altogether?\n\t\tevent.setHeaders({\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/405\n\t\t\t// \"The server must generate an Allow header field in a 405 status code response\"\n\t\t\tallow: 'GET'\n\t\t});\n\t\treturn {\n\t\t\ttype: 'error',\n\t\t\terror: new SvelteKitError(\n\t\t\t\t405,\n\t\t\t\t'Method Not Allowed',\n\t\t\t\t`POST method not allowed. No form actions exist for ${DEV ? `the page at ${event.route.id}` : 'this page'}`\n\t\t\t)\n\t\t};\n\t}\n\n\tcheck_named_default_separate(actions);\n\n\ttry {\n\t\tconst data = await call_action(event, event_state, actions);\n\n\t\tif (DEV) {\n\t\t\tvalidate_action_return(data);\n\t\t}\n\n\t\tif (data instanceof ActionFailure) {\n\t\t\treturn {\n\t\t\t\ttype: 'failure',\n\t\t\t\tstatus: data.status,\n\t\t\t\tdata: data.data\n\t\t\t};\n\t\t} else {\n\t\t\treturn {\n\t\t\t\ttype: 'success',\n\t\t\t\tstatus: 200,\n\t\t\t\t// @ts-expect-error this will be removed upon serialization, so `undefined` is the same as omission\n\t\t\t\tdata\n\t\t\t};\n\t\t}\n\t} catch (e) {\n\t\tconst err = normalize_error(e);\n\n\t\tif (err instanceof Redirect) {\n\t\t\treturn {\n\t\t\t\ttype: 'redirect',\n\t\t\t\tstatus: err.status,\n\t\t\t\tlocation: err.location\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\ttype: 'error',\n\t\t\terror: check_incorrect_fail_use(err)\n\t\t};\n\t}\n}\n\n/**\n * @param {Actions} actions\n */\nfunction check_named_default_separate(actions) {\n\tif (actions.default && Object.keys(actions).length > 1) {\n\t\tthrow new Error(\n\t\t\t'When using named actions, the default action cannot be used. See the docs for more info: https://svelte.dev/docs/kit/form-actions#named-actions'\n\t\t);\n\t}\n}\n\n/**\n * @param {RequestEvent} event\n * @param {import('types').RequestState} event_state\n * @param {NonNullable<ServerNode['actions']>} actions\n * @throws {Redirect | HttpError | SvelteKitError | Error}\n */\nasync function call_action(event, event_state, actions) {\n\tconst url = new URL(event.request.url);\n\n\tlet name = 'default';\n\tfor (const param of url.searchParams) {\n\t\tif (param[0].startsWith('/')) {\n\t\t\tname = param[0].slice(1);\n\t\t\tif (name === 'default') {\n\t\t\t\tthrow new Error('Cannot use reserved action name \"default\"');\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tconst action = actions[name];\n\tif (!action) {\n\t\tthrow new SvelteKitError(404, 'Not Found', `No action with name '${name}' found`);\n\t}\n\n\tif (!is_form_content_type(event.request)) {\n\t\tthrow new SvelteKitError(\n\t\t\t415,\n\t\t\t'Unsupported Media Type',\n\t\t\t`Form actions expect form-encoded data — received ${event.request.headers.get(\n\t\t\t\t'content-type'\n\t\t\t)}`\n\t\t);\n\t}\n\n\treturn record_span({\n\t\tname: 'sveltekit.form_action',\n\t\tattributes: {\n\t\t\t'sveltekit.form_action.name': name,\n\t\t\t'http.route': event.route.id || 'unknown'\n\t\t},\n\t\tfn: async (current) => {\n\t\t\tconst traced_event = merge_tracing(event, current);\n\t\t\tconst result = await with_request_store({ event: traced_event, state: event_state }, () =>\n\t\t\t\taction(traced_event)\n\t\t\t);\n\t\t\tif (result instanceof ActionFailure) {\n\t\t\t\tcurrent.setAttributes({\n\t\t\t\t\t'sveltekit.form_action.result.type': 'failure',\n\t\t\t\t\t'sveltekit.form_action.result.status': result.status\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn result;\n\t\t}\n\t});\n}\n\n/** @param {any} data */\nfunction validate_action_return(data) {\n\tif (data instanceof Redirect) {\n\t\tthrow new Error('Cannot `return redirect(...)` — use `redirect(...)` instead');\n\t}\n\n\tif (data instanceof HttpError) {\n\t\tthrow new Error('Cannot `return error(...)` — use `error(...)` or `return fail(...)` instead');\n\t}\n}\n\n/**\n * Try to `devalue.uneval` the data object, and if it fails, return a proper Error with context\n * @param {any} data\n * @param {string} route_id\n * @param {ServerHooks['transport']} transport\n */\nexport function uneval_action_response(data, route_id, transport) {\n\tconst replacer = (/** @type {any} */ thing) => {\n\t\tfor (const key in transport) {\n\t\t\tconst encoded = transport[key].encode(thing);\n\t\t\tif (encoded) {\n\t\t\t\treturn `app.decode('${key}', ${devalue.uneval(encoded, replacer)})`;\n\t\t\t}\n\t\t}\n\t};\n\n\treturn try_serialize(data, (value) => devalue.uneval(value, replacer), route_id);\n}\n\n/**\n * Try to `devalue.stringify` the data object, and if it fails, return a proper Error with context\n * @param {any} data\n * @param {string} route_id\n * @param {ServerHooks['transport']} transport\n */\nfunction stringify_action_response(data, route_id, transport) {\n\tconst encoders = Object.fromEntries(\n\t\tObject.entries(transport).map(([key, value]) => [key, value.encode])\n\t);\n\n\treturn try_serialize(data, (value) => devalue.stringify(value, encoders), route_id);\n}\n\n/**\n * @param {any} data\n * @param {(data: any) => string} fn\n * @param {string} route_id\n */\nfunction try_serialize(data, fn, route_id) {\n\ttry {\n\t\treturn fn(data);\n\t} catch (e) {\n\t\t// If we're here, the data could not be serialized with devalue\n\t\tconst error = /** @type {any} */ (e);\n\n\t\t// if someone tries to use `json()` in their action\n\t\tif (data instanceof Response) {\n\t\t\tthrow new Error(\n\t\t\t\t`Data returned from action inside ${route_id} is not serializable. Form actions need to return plain objects or fail(). E.g. return { success: true } or return fail(400, { message: \"invalid\" });`\n\t\t\t);\n\t\t}\n\n\t\t// if devalue could not serialize a property on the object, etc.\n\t\tif ('path' in error) {\n\t\t\tlet message = `Data returned from action inside ${route_id} is not serializable: ${error.message}`;\n\t\t\tif (error.path !== '') message += ` (data.${error.path})`;\n\t\t\tthrow new Error(message);\n\t\t}\n\n\t\tthrow error;\n\t}\n}\n","import { with_resolvers } from './promise.js';\n\n/**\n * Create an async iterator and a function to push values into it\n * @template T\n * @returns {{\n *   iterate: (transform?: (input: T) => T) => AsyncIterable<T>;\n *   add: (promise: Promise<T>) => void;\n * }}\n */\nexport function create_async_iterator() {\n\tlet resolved = -1;\n\tlet returned = -1;\n\n\t/** @type {import('./promise.js').PromiseWithResolvers<T>[]} */\n\tconst deferred = [];\n\n\treturn {\n\t\titerate: (transform = (x) => x) => {\n\t\t\treturn {\n\t\t\t\t[Symbol.asyncIterator]() {\n\t\t\t\t\treturn {\n\t\t\t\t\t\tnext: async () => {\n\t\t\t\t\t\t\tconst next = deferred[++returned];\n\t\t\t\t\t\t\tif (!next) return { value: null, done: true };\n\n\t\t\t\t\t\t\tconst value = await next.promise;\n\t\t\t\t\t\t\treturn { value: transform(value), done: false };\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tadd: (promise) => {\n\t\t\tdeferred.push(with_resolvers());\n\t\t\tvoid promise.then((value) => {\n\t\t\t\tdeferred[++resolved].resolve(value);\n\t\t\t});\n\t\t}\n\t};\n}\n","import * as devalue from 'devalue';\nimport { compact } from '../../../utils/array.js';\nimport { create_async_iterator } from '../../../utils/streaming.js';\nimport {\n\tclarify_devalue_error,\n\tget_global_name,\n\thandle_error_and_jsonify,\n\tserialize_uses\n} from '../utils.js';\n\n/**\n * If the serialized data contains promises, `chunks` will be an\n * async iterable containing their resolutions\n * @param {import('@sveltejs/kit').RequestEvent} event\n * @param {import('types').RequestState} event_state\n * @param {import('types').SSROptions} options\n * @returns {import('./types.js').ServerDataSerializer}\n */\nexport function server_data_serializer(event, event_state, options) {\n\tlet promise_id = 1;\n\tlet max_nodes = -1;\n\n\tconst iterator = create_async_iterator();\n\tconst global = get_global_name(options);\n\n\t/** @param {number} index */\n\tfunction get_replacer(index) {\n\t\t/** @param {any} thing */\n\t\treturn function replacer(thing) {\n\t\t\tif (typeof thing?.then === 'function') {\n\t\t\t\tconst id = promise_id++;\n\n\t\t\t\tconst promise = thing\n\t\t\t\t\t.then(/** @param {any} data */ (data) => ({ data }))\n\t\t\t\t\t.catch(\n\t\t\t\t\t\t/** @param {any} error */ async (error) => ({\n\t\t\t\t\t\t\terror: await handle_error_and_jsonify(event, event_state, options, error)\n\t\t\t\t\t\t})\n\t\t\t\t\t)\n\t\t\t\t\t.then(\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * @param {{data: any; error: any}} result\n\t\t\t\t\t\t */\n\t\t\t\t\t\tasync ({ data, error }) => {\n\t\t\t\t\t\t\tlet str;\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tstr = devalue.uneval(error ? [, error] : [data], replacer);\n\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\terror = await handle_error_and_jsonify(\n\t\t\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\t\t\tevent_state,\n\t\t\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\t\t\tnew Error(`Failed to serialize promise while rendering ${event.route.id}`)\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\tdata = undefined;\n\t\t\t\t\t\t\t\tstr = devalue.uneval([, error], replacer);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tindex,\n\t\t\t\t\t\t\t\tstr: `${global}.resolve(${id}, ${str.includes('app.decode') ? `(app) => ${str}` : `() => ${str}`})`\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\n\t\t\t\titerator.add(promise);\n\n\t\t\t\treturn `${global}.defer(${id})`;\n\t\t\t} else {\n\t\t\t\tfor (const key in options.hooks.transport) {\n\t\t\t\t\tconst encoded = options.hooks.transport[key].encode(thing);\n\t\t\t\t\tif (encoded) {\n\t\t\t\t\t\treturn `app.decode('${key}', ${devalue.uneval(encoded, replacer)})`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t}\n\n\tconst strings = /** @type {string[]} */ ([]);\n\n\treturn {\n\t\tset_max_nodes(i) {\n\t\t\tmax_nodes = i;\n\t\t},\n\n\t\tadd_node(i, node) {\n\t\t\ttry {\n\t\t\t\tif (!node) {\n\t\t\t\t\tstrings[i] = 'null';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t/** @type {any} */\n\t\t\t\tconst payload = { type: 'data', data: node.data, uses: serialize_uses(node) };\n\t\t\t\tif (node.slash) payload.slash = node.slash;\n\n\t\t\t\tstrings[i] = devalue.uneval(payload, get_replacer(i));\n\t\t\t} catch (e) {\n\t\t\t\t// @ts-expect-error\n\t\t\t\te.path = e.path.slice(1);\n\t\t\t\tthrow new Error(clarify_devalue_error(event, /** @type {any} */ (e)));\n\t\t\t}\n\t\t},\n\n\t\tget_data(csp) {\n\t\t\tconst open = `<script${csp.script_needs_nonce ? ` nonce=\"${csp.nonce}\"` : ''}>`;\n\t\t\tconst close = `</script>\\n`;\n\n\t\t\treturn {\n\t\t\t\tdata: `[${compact(max_nodes > -1 ? strings.slice(0, max_nodes) : strings).join(',')}]`,\n\t\t\t\tchunks:\n\t\t\t\t\tpromise_id > 1\n\t\t\t\t\t\t? iterator.iterate(({ index, str }) => {\n\t\t\t\t\t\t\t\tif (max_nodes > -1 && index >= max_nodes) {\n\t\t\t\t\t\t\t\t\treturn '';\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn open + str + close;\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t: null\n\t\t\t};\n\t\t}\n\t};\n}\n\n/**\n * If the serialized data contains promises, `chunks` will be an\n * async iterable containing their resolutions\n * @param {import('@sveltejs/kit').RequestEvent} event\n * @param {import('types').RequestState} event_state\n * @param {import('types').SSROptions} options\n * @returns {import('./types.js').ServerDataSerializerJson}\n */\nexport function server_data_serializer_json(event, event_state, options) {\n\tlet promise_id = 1;\n\n\tconst iterator = create_async_iterator();\n\n\tconst reducers = {\n\t\t...Object.fromEntries(\n\t\t\tObject.entries(options.hooks.transport).map(([key, value]) => [key, value.encode])\n\t\t),\n\t\t/** @param {any} thing */\n\t\tPromise: (thing) => {\n\t\t\tif (typeof thing?.then !== 'function') {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst id = promise_id++;\n\n\t\t\t/** @type {'data' | 'error'} */\n\t\t\tlet key = 'data';\n\n\t\t\tconst promise = thing\n\t\t\t\t.catch(\n\t\t\t\t\t/** @param {any} e */ async (e) => {\n\t\t\t\t\t\tkey = 'error';\n\t\t\t\t\t\treturn handle_error_and_jsonify(event, event_state, options, /** @type {any} */ (e));\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\t.then(\n\t\t\t\t\t/** @param {any} value */\n\t\t\t\t\tasync (value) => {\n\t\t\t\t\t\tlet str;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tstr = devalue.stringify(value, reducers);\n\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\tconst error = await handle_error_and_jsonify(\n\t\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\t\tevent_state,\n\t\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\t\tnew Error(`Failed to serialize promise while rendering ${event.route.id}`)\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tkey = 'error';\n\t\t\t\t\t\t\tstr = devalue.stringify(error, reducers);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn `{\"type\":\"chunk\",\"id\":${id},\"${key}\":${str}}\\n`;\n\t\t\t\t\t}\n\t\t\t\t);\n\n\t\t\titerator.add(promise);\n\n\t\t\treturn id;\n\t\t}\n\t};\n\n\tconst strings = /** @type {string[]} */ ([]);\n\n\treturn {\n\t\tadd_node(i, node) {\n\t\t\ttry {\n\t\t\t\tif (!node) {\n\t\t\t\t\tstrings[i] = 'null';\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (node.type === 'error' || node.type === 'skip') {\n\t\t\t\t\tstrings[i] = JSON.stringify(node);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tstrings[i] =\n\t\t\t\t\t`{\"type\":\"data\",\"data\":${devalue.stringify(node.data, reducers)},\"uses\":${JSON.stringify(\n\t\t\t\t\t\tserialize_uses(node)\n\t\t\t\t\t)}${node.slash ? `,\"slash\":${JSON.stringify(node.slash)}` : ''}}`;\n\t\t\t} catch (e) {\n\t\t\t\t// @ts-expect-error\n\t\t\t\te.path = 'data' + e.path;\n\t\t\t\tthrow new Error(clarify_devalue_error(event, /** @type {any} */ (e)));\n\t\t\t}\n\t\t},\n\n\t\tget_data() {\n\t\t\treturn {\n\t\t\t\tdata: `{\"type\":\"data\",\"nodes\":[${strings.join(',')}]}\\n`,\n\t\t\t\tchunks: promise_id > 1 ? iterator.iterate() : null\n\t\t\t};\n\t\t}\n\t};\n}\n","import { DEV } from 'esm-env';\nimport { disable_search, make_trackable } from '../../../utils/url.js';\nimport { validate_depends, validate_load_response } from '../../shared.js';\nimport { with_request_store, merge_tracing } from '@sveltejs/kit/internal/server';\nimport { record_span } from '../../telemetry/record_span.js';\nimport { base64_encode, text_decoder } from '../../utils.js';\nimport { NULL_BODY_STATUS } from '../constants.js';\nimport { get_node_type } from '../utils.js';\n\n/**\n * Calls the user's server `load` function.\n * @param {{\n *   event: import('@sveltejs/kit').RequestEvent;\n *   event_state: import('types').RequestState;\n *   state: import('types').SSRState;\n *   node: import('types').SSRNode | undefined;\n *   parent: () => Promise<Record<string, any>>;\n * }} opts\n * @returns {Promise<import('types').ServerDataNode | null>}\n */\nexport async function load_server_data({ event, event_state, state, node, parent }) {\n\tif (!node?.server) return null;\n\n\tlet is_tracking = true;\n\n\tconst uses = {\n\t\tdependencies: new Set(),\n\t\tparams: new Set(),\n\t\tparent: false,\n\t\troute: false,\n\t\turl: false,\n\t\tsearch_params: new Set()\n\t};\n\n\tconst load = node.server.load;\n\t// TODO: shouldn't this be calculated using PageNodes? there could be a trailingSlash option on a layout\n\tconst slash = node.server.trailingSlash;\n\n\tif (!load) {\n\t\treturn { type: 'data', data: null, uses, slash };\n\t}\n\n\tconst url = make_trackable(\n\t\tevent.url,\n\t\t() => {\n\t\t\tif (DEV && done && !uses.url) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`${node.server_id}: Accessing URL properties in a promise handler after \\`load(...)\\` has returned will not cause the function to re-run when the URL changes`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (is_tracking) {\n\t\t\t\tuses.url = true;\n\t\t\t}\n\t\t},\n\t\t(param) => {\n\t\t\tif (DEV && done && !uses.search_params.has(param)) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`${node.server_id}: Accessing URL properties in a promise handler after \\`load(...)\\` has returned will not cause the function to re-run when the URL changes`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (is_tracking) {\n\t\t\t\tuses.search_params.add(param);\n\t\t\t}\n\t\t}\n\t);\n\n\tif (state.prerendering) {\n\t\tdisable_search(url);\n\t}\n\n\tlet done = false;\n\n\tconst result = await record_span({\n\t\tname: 'sveltekit.load',\n\t\tattributes: {\n\t\t\t'sveltekit.load.node_id': node.server_id || 'unknown',\n\t\t\t'sveltekit.load.node_type': get_node_type(node.server_id),\n\t\t\t'sveltekit.load.environment': 'server',\n\t\t\t'http.route': event.route.id || 'unknown'\n\t\t},\n\t\tfn: async (current) => {\n\t\t\tconst traced_event = merge_tracing(event, current);\n\t\t\tconst result = await with_request_store({ event: traced_event, state: event_state }, () =>\n\t\t\t\tload.call(null, {\n\t\t\t\t\t...traced_event,\n\t\t\t\t\tfetch: (info, init) => {\n\t\t\t\t\t\tconst url = new URL(info instanceof Request ? info.url : info, event.url);\n\n\t\t\t\t\t\tif (DEV && done && !uses.dependencies.has(url.href)) {\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t`${node.server_id}: Calling \\`event.fetch(...)\\` in a promise handler after \\`load(...)\\` has returned will not cause the function to re-run when the dependency is invalidated`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Note: server fetches are not added to uses.depends due to security concerns\n\t\t\t\t\t\treturn event.fetch(info, init);\n\t\t\t\t\t},\n\t\t\t\t\t/** @param {string[]} deps */\n\t\t\t\t\tdepends: (...deps) => {\n\t\t\t\t\t\tfor (const dep of deps) {\n\t\t\t\t\t\t\tconst { href } = new URL(dep, event.url);\n\n\t\t\t\t\t\t\tif (DEV) {\n\t\t\t\t\t\t\t\tvalidate_depends(node.server_id || 'missing route ID', dep);\n\n\t\t\t\t\t\t\t\tif (done && !uses.dependencies.has(href)) {\n\t\t\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t\t\t`${node.server_id}: Calling \\`depends(...)\\` in a promise handler after \\`load(...)\\` has returned will not cause the function to re-run when the dependency is invalidated`\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tuses.dependencies.add(href);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tparams: new Proxy(event.params, {\n\t\t\t\t\t\tget: (target, key) => {\n\t\t\t\t\t\t\tif (DEV && done && typeof key === 'string' && !uses.params.has(key)) {\n\t\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t\t`${node.server_id}: Accessing \\`params.${String(\n\t\t\t\t\t\t\t\t\t\tkey\n\t\t\t\t\t\t\t\t\t)}\\` in a promise handler after \\`load(...)\\` has returned will not cause the function to re-run when the param changes`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (is_tracking) {\n\t\t\t\t\t\t\t\tuses.params.add(key);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn target[/** @type {string} */ (key)];\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\tparent: async () => {\n\t\t\t\t\t\tif (DEV && done && !uses.parent) {\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t`${node.server_id}: Calling \\`parent(...)\\` in a promise handler after \\`load(...)\\` has returned will not cause the function to re-run when parent data changes`\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (is_tracking) {\n\t\t\t\t\t\t\tuses.parent = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn parent();\n\t\t\t\t\t},\n\t\t\t\t\troute: new Proxy(event.route, {\n\t\t\t\t\t\tget: (target, key) => {\n\t\t\t\t\t\t\tif (DEV && done && typeof key === 'string' && !uses.route) {\n\t\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t\t`${node.server_id}: Accessing \\`route.${String(\n\t\t\t\t\t\t\t\t\t\tkey\n\t\t\t\t\t\t\t\t\t)}\\` in a promise handler after \\`load(...)\\` has returned will not cause the function to re-run when the route changes`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (is_tracking) {\n\t\t\t\t\t\t\t\tuses.route = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn target[/** @type {'id'} */ (key)];\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t\turl,\n\t\t\t\t\tuntrack(fn) {\n\t\t\t\t\t\tis_tracking = false;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\treturn fn();\n\t\t\t\t\t\t} finally {\n\t\t\t\t\t\t\tis_tracking = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\n\t\t\treturn result;\n\t\t}\n\t});\n\n\tif (DEV) {\n\t\tvalidate_load_response(result, `in ${node.server_id}`);\n\t}\n\n\tdone = true;\n\n\treturn {\n\t\ttype: 'data',\n\t\tdata: result ?? null,\n\t\tuses,\n\t\tslash\n\t};\n}\n\n/**\n * Calls the user's `load` function.\n * @param {{\n *   event: import('@sveltejs/kit').RequestEvent;\n *   event_state: import('types').RequestState;\n *   fetched: import('./types.js').Fetched[];\n *   node: import('types').SSRNode | undefined;\n *   parent: () => Promise<Record<string, any>>;\n *   resolve_opts: import('types').RequiredResolveOptions;\n *   server_data_promise: Promise<import('types').ServerDataNode | null>;\n *   state: import('types').SSRState;\n *   csr: boolean;\n * }} opts\n * @returns {Promise<Record<string, any | Promise<any>> | null>}\n */\nexport async function load_data({\n\tevent,\n\tevent_state,\n\tfetched,\n\tnode,\n\tparent,\n\tserver_data_promise,\n\tstate,\n\tresolve_opts,\n\tcsr\n}) {\n\tconst server_data_node = await server_data_promise;\n\n\tconst load = node?.universal?.load;\n\n\tif (!load) {\n\t\treturn server_data_node?.data ?? null;\n\t}\n\n\tconst result = await record_span({\n\t\tname: 'sveltekit.load',\n\t\tattributes: {\n\t\t\t'sveltekit.load.node_id': node.universal_id || 'unknown',\n\t\t\t'sveltekit.load.node_type': get_node_type(node.universal_id),\n\t\t\t'sveltekit.load.environment': 'server',\n\t\t\t'http.route': event.route.id || 'unknown'\n\t\t},\n\t\tfn: async (current) => {\n\t\t\tconst traced_event = merge_tracing(event, current);\n\t\t\treturn await with_request_store({ event: traced_event, state: event_state }, () =>\n\t\t\t\tload.call(null, {\n\t\t\t\t\turl: event.url,\n\t\t\t\t\tparams: event.params,\n\t\t\t\t\tdata: server_data_node?.data ?? null,\n\t\t\t\t\troute: event.route,\n\t\t\t\t\tfetch: create_universal_fetch(event, state, fetched, csr, resolve_opts),\n\t\t\t\t\tsetHeaders: event.setHeaders,\n\t\t\t\t\tdepends: () => {},\n\t\t\t\t\tparent,\n\t\t\t\t\tuntrack: (fn) => fn(),\n\t\t\t\t\ttracing: traced_event.tracing\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\t});\n\n\tif (DEV) {\n\t\tvalidate_load_response(result, `in ${node.universal_id}`);\n\t}\n\n\treturn result ?? null;\n}\n\n/**\n * @param {Pick<import('@sveltejs/kit').RequestEvent, 'fetch' | 'url' | 'request' | 'route'>} event\n * @param {import('types').SSRState} state\n * @param {import('./types.js').Fetched[]} fetched\n * @param {boolean} csr\n * @param {Pick<Required<import('@sveltejs/kit').ResolveOptions>, 'filterSerializedResponseHeaders'>} resolve_opts\n * @returns {typeof fetch}\n */\nexport function create_universal_fetch(event, state, fetched, csr, resolve_opts) {\n\t/**\n\t * @param {URL | RequestInfo} input\n\t * @param {RequestInit} [init]\n\t */\n\tconst universal_fetch = async (input, init) => {\n\t\tconst cloned_body = input instanceof Request && input.body ? input.clone().body : null;\n\n\t\tconst cloned_headers =\n\t\t\tinput instanceof Request && [...input.headers].length\n\t\t\t\t? new Headers(input.headers)\n\t\t\t\t: init?.headers;\n\n\t\tlet response = await event.fetch(input, init);\n\n\t\tconst url = new URL(input instanceof Request ? input.url : input, event.url);\n\t\tconst same_origin = url.origin === event.url.origin;\n\n\t\t/** @type {import('types').PrerenderDependency} */\n\t\tlet dependency;\n\n\t\tif (same_origin) {\n\t\t\tif (state.prerendering) {\n\t\t\t\tdependency = { response, body: null };\n\t\t\t\tstate.prerendering.dependencies.set(url.pathname, dependency);\n\t\t\t}\n\t\t} else if (url.protocol === 'https:' || url.protocol === 'http:') {\n\t\t\t// simulate CORS errors and \"no access to body in no-cors mode\" server-side for consistency with client-side behaviour\n\t\t\tconst mode = input instanceof Request ? input.mode : (init?.mode ?? 'cors');\n\t\t\tif (mode === 'no-cors') {\n\t\t\t\tresponse = new Response('', {\n\t\t\t\t\tstatus: response.status,\n\t\t\t\t\tstatusText: response.statusText,\n\t\t\t\t\theaders: response.headers\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst acao = response.headers.get('access-control-allow-origin');\n\t\t\t\tif (!acao || (acao !== event.url.origin && acao !== '*')) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`CORS error: ${\n\t\t\t\t\t\t\tacao ? 'Incorrect' : 'No'\n\t\t\t\t\t\t} 'Access-Control-Allow-Origin' header is present on the requested resource`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/** @type {ReadableStream<Uint8Array>} */\n\t\tlet teed_body;\n\n\t\tconst proxy = new Proxy(response, {\n\t\t\tget(response, key, receiver) {\n\t\t\t\t/**\n\t\t\t\t * @param {string | undefined} body\n\t\t\t\t * @param {boolean} is_b64\n\t\t\t\t */\n\t\t\t\tasync function push_fetched(body, is_b64) {\n\t\t\t\t\tconst status_number = Number(response.status);\n\t\t\t\t\tif (isNaN(status_number)) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`response.status is not a number. value: \"${\n\t\t\t\t\t\t\t\tresponse.status\n\t\t\t\t\t\t\t}\" type: ${typeof response.status}`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tfetched.push({\n\t\t\t\t\t\turl: same_origin ? url.href.slice(event.url.origin.length) : url.href,\n\t\t\t\t\t\tmethod: event.request.method,\n\t\t\t\t\t\trequest_body: /** @type {string | ArrayBufferView | undefined} */ (\n\t\t\t\t\t\t\tinput instanceof Request && cloned_body\n\t\t\t\t\t\t\t\t? await stream_to_string(cloned_body)\n\t\t\t\t\t\t\t\t: init?.body\n\t\t\t\t\t\t),\n\t\t\t\t\t\trequest_headers: cloned_headers,\n\t\t\t\t\t\tresponse_body: body,\n\t\t\t\t\t\tresponse,\n\t\t\t\t\t\tis_b64\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (key === 'body') {\n\t\t\t\t\tif (response.body === null) {\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (teed_body) {\n\t\t\t\t\t\treturn teed_body;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst [a, b] = response.body.tee();\n\n\t\t\t\t\tvoid (async () => {\n\t\t\t\t\t\tlet result = new Uint8Array();\n\n\t\t\t\t\t\tfor await (const chunk of a) {\n\t\t\t\t\t\t\tconst combined = new Uint8Array(result.length + chunk.length);\n\n\t\t\t\t\t\t\tcombined.set(result, 0);\n\t\t\t\t\t\t\tcombined.set(chunk, result.length);\n\n\t\t\t\t\t\t\tresult = combined;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (dependency) {\n\t\t\t\t\t\t\tdependency.body = new Uint8Array(result);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvoid push_fetched(base64_encode(result), true);\n\t\t\t\t\t})();\n\n\t\t\t\t\treturn (teed_body = b);\n\t\t\t\t}\n\n\t\t\t\tif (key === 'arrayBuffer') {\n\t\t\t\t\treturn async () => {\n\t\t\t\t\t\tconst buffer = await response.arrayBuffer();\n\n\t\t\t\t\t\tconst bytes = new Uint8Array(buffer);\n\n\t\t\t\t\t\tif (dependency) {\n\t\t\t\t\t\t\tdependency.body = bytes;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (buffer instanceof ArrayBuffer) {\n\t\t\t\t\t\t\tawait push_fetched(base64_encode(bytes), true);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn buffer;\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tasync function text() {\n\t\t\t\t\tconst body = await response.text();\n\n\t\t\t\t\tif (body === '' && NULL_BODY_STATUS.includes(response.status)) {\n\t\t\t\t\t\tawait push_fetched(undefined, false);\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!body || typeof body === 'string') {\n\t\t\t\t\t\tawait push_fetched(body, false);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dependency) {\n\t\t\t\t\t\tdependency.body = body;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn body;\n\t\t\t\t}\n\n\t\t\t\tif (key === 'text') {\n\t\t\t\t\treturn text;\n\t\t\t\t}\n\n\t\t\t\tif (key === 'json') {\n\t\t\t\t\treturn async () => {\n\t\t\t\t\t\tconst body = await text();\n\t\t\t\t\t\treturn body ? JSON.parse(body) : undefined;\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\tconst value = Reflect.get(response, key, response);\n\n\t\t\t\tif (value instanceof Function) {\n\t\t\t\t\t// On Node v24+, the Response object has a private element #state – we\n\t\t\t\t\t// need to bind this function to the response in order to allow it to\n\t\t\t\t\t// access this private element. Defining the name and length ensure it\n\t\t\t\t\t// is identical to the original function when introspected.\n\t\t\t\t\treturn Object.defineProperties(\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * @this {any}\n\t\t\t\t\t\t */\n\t\t\t\t\t\tfunction () {\n\t\t\t\t\t\t\treturn Reflect.apply(value, this === receiver ? response : this, arguments);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: { value: value.name },\n\t\t\t\t\t\t\tlength: { value: value.length }\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t}\n\t\t});\n\n\t\tif (csr) {\n\t\t\t// ensure that excluded headers can't be read\n\t\t\tconst get = response.headers.get;\n\t\t\tresponse.headers.get = (key) => {\n\t\t\t\tconst lower = key.toLowerCase();\n\t\t\t\tconst value = get.call(response.headers, lower);\n\t\t\t\tif (value && !lower.startsWith('x-sveltekit-')) {\n\t\t\t\t\tconst included = resolve_opts.filterSerializedResponseHeaders(lower, value);\n\t\t\t\t\tif (!included) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Failed to get response header \"${lower}\" — it must be included by the \\`filterSerializedResponseHeaders\\` option: https://svelte.dev/docs/kit/hooks#Server-hooks-handle (at ${event.route.id})`\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn value;\n\t\t\t};\n\t\t}\n\n\t\treturn proxy;\n\t};\n\n\t// Don't make this function `async`! Otherwise, the user has to `catch` promises they use for streaming responses or else\n\t// it will be an unhandled rejection. Instead, we add a `.catch(() => {})` ourselves below to this from happening.\n\treturn (input, init) => {\n\t\t// See docs in fetch.js for why we need to do this\n\t\tconst response = universal_fetch(input, init);\n\t\tresponse.catch(() => {});\n\t\treturn response;\n\t};\n}\n\n/**\n * @param {ReadableStream<Uint8Array>} stream\n */\nasync function stream_to_string(stream) {\n\tlet result = '';\n\tconst reader = stream.getReader();\n\twhile (true) {\n\t\tconst { done, value } = await reader.read();\n\t\tif (done) {\n\t\t\tbreak;\n\t\t}\n\t\tresult += text_decoder.decode(value);\n\t}\n\treturn result;\n}\n","/**\n * Hash using djb2\n * @param {import('types').StrictBody[]} values\n */\nexport function hash(...values) {\n\tlet hash = 5381;\n\n\tfor (const value of values) {\n\t\tif (typeof value === 'string') {\n\t\t\tlet i = value.length;\n\t\t\twhile (i) hash = (hash * 33) ^ value.charCodeAt(--i);\n\t\t} else if (ArrayBuffer.isView(value)) {\n\t\t\tconst buffer = new Uint8Array(value.buffer, value.byteOffset, value.byteLength);\n\t\t\tlet i = buffer.length;\n\t\t\twhile (i) hash = (hash * 33) ^ buffer[--i];\n\t\t} else {\n\t\t\tthrow new TypeError('value must be a string or TypedArray');\n\t\t}\n\t}\n\n\treturn (hash >>> 0).toString(36);\n}\n","import { escape_html } from '../../../utils/escape.js';\nimport { hash } from '../../../utils/hash.js';\n\n/**\n * Inside a script element, only `</script` and `<!--` hold special meaning to the HTML parser.\n *\n * The first closes the script element, so everything after is treated as raw HTML.\n * The second disables further parsing until `-->`, so the script element might be unexpectedly\n * kept open until until an unrelated HTML comment in the page.\n *\n * U+2028 LINE SEPARATOR and U+2029 PARAGRAPH SEPARATOR are escaped for the sake of pre-2018\n * browsers.\n *\n * @see tests for unsafe parsing examples.\n * @see https://html.spec.whatwg.org/multipage/scripting.html#restrictions-for-contents-of-script-elements\n * @see https://html.spec.whatwg.org/multipage/syntax.html#cdata-rcdata-restrictions\n * @see https://html.spec.whatwg.org/multipage/parsing.html#script-data-state\n * @see https://html.spec.whatwg.org/multipage/parsing.html#script-data-double-escaped-state\n * @see https://github.com/tc39/proposal-json-superset\n * @type {Record<string, string>}\n */\nconst replacements = {\n\t'<': '\\\\u003C',\n\t'\\u2028': '\\\\u2028',\n\t'\\u2029': '\\\\u2029'\n};\n\nconst pattern = new RegExp(`[${Object.keys(replacements).join('')}]`, 'g');\n\n/**\n * Generates a raw HTML string containing a safe script element carrying data and associated attributes.\n *\n * It escapes all the special characters needed to guarantee the element is unbroken, but care must\n * be taken to ensure it is inserted in the document at an acceptable position for a script element,\n * and that the resulting string isn't further modified.\n *\n * @param {import('./types.js').Fetched} fetched\n * @param {(name: string, value: string) => boolean} filter\n * @param {boolean} [prerendering]\n * @returns {string} The raw HTML of a script element carrying the JSON payload.\n * @example const html = serialize_data('/data.json', null, { foo: 'bar' });\n */\nexport function serialize_data(fetched, filter, prerendering = false) {\n\t/** @type {Record<string, string>} */\n\tconst headers = {};\n\n\tlet cache_control = null;\n\tlet age = null;\n\tlet varyAny = false;\n\n\tfor (const [key, value] of fetched.response.headers) {\n\t\tif (filter(key, value)) {\n\t\t\theaders[key] = value;\n\t\t}\n\n\t\tif (key === 'cache-control') cache_control = value;\n\t\telse if (key === 'age') age = value;\n\t\telse if (key === 'vary' && value.trim() === '*') varyAny = true;\n\t}\n\n\tconst payload = {\n\t\tstatus: fetched.response.status,\n\t\tstatusText: fetched.response.statusText,\n\t\theaders,\n\t\tbody: fetched.response_body\n\t};\n\n\tconst safe_payload = JSON.stringify(payload).replace(pattern, (match) => replacements[match]);\n\n\tconst attrs = [\n\t\t'type=\"application/json\"',\n\t\t'data-sveltekit-fetched',\n\t\t`data-url=\"${escape_html(fetched.url, true)}\"`\n\t];\n\n\tif (fetched.is_b64) {\n\t\tattrs.push('data-b64');\n\t}\n\n\tif (fetched.request_headers || fetched.request_body) {\n\t\t/** @type {import('types').StrictBody[]} */\n\t\tconst values = [];\n\n\t\tif (fetched.request_headers) {\n\t\t\tvalues.push([...new Headers(fetched.request_headers)].join(','));\n\t\t}\n\n\t\tif (fetched.request_body) {\n\t\t\tvalues.push(fetched.request_body);\n\t\t}\n\n\t\tattrs.push(`data-hash=\"${hash(...values)}\"`);\n\t}\n\n\t// Compute the time the response should be cached, taking into account max-age and age.\n\t// Do not cache at all if a `Vary: *` header is present, as this indicates that the\n\t// cache is likely to get busted.\n\tif (!prerendering && fetched.method === 'GET' && cache_control && !varyAny) {\n\t\tconst match = /s-maxage=(\\d+)/g.exec(cache_control) ?? /max-age=(\\d+)/g.exec(cache_control);\n\t\tif (match) {\n\t\t\tconst ttl = +match[1] - +(age ?? '0');\n\t\t\tattrs.push(`data-ttl=\"${ttl}\"`);\n\t\t}\n\t}\n\n\treturn `<script ${attrs.join(' ')}>${safe_payload}</script>`;\n}\n","export const s = JSON.stringify;\n","import { text_encoder } from '../../utils.js';\n\n/**\n * SHA-256 hashing function adapted from https://bitwiseshiftleft.github.io/sjcl\n * modified and redistributed under BSD license\n * @param {string} data\n */\nexport function sha256(data) {\n\tif (!key[0]) precompute();\n\n\tconst out = init.slice(0);\n\tconst array = encode(data);\n\n\tfor (let i = 0; i < array.length; i += 16) {\n\t\tconst w = array.subarray(i, i + 16);\n\n\t\tlet tmp;\n\t\tlet a;\n\t\tlet b;\n\n\t\tlet out0 = out[0];\n\t\tlet out1 = out[1];\n\t\tlet out2 = out[2];\n\t\tlet out3 = out[3];\n\t\tlet out4 = out[4];\n\t\tlet out5 = out[5];\n\t\tlet out6 = out[6];\n\t\tlet out7 = out[7];\n\n\t\t/* Rationale for placement of |0 :\n\t\t * If a value can overflow is original 32 bits by a factor of more than a few\n\t\t * million (2^23 ish), there is a possibility that it might overflow the\n\t\t * 53-bit mantissa and lose precision.\n\t\t *\n\t\t * To avoid this, we clamp back to 32 bits by |'ing with 0 on any value that\n\t\t * propagates around the loop, and on the hash state out[]. I don't believe\n\t\t * that the clamps on out4 and on out0 are strictly necessary, but it's close\n\t\t * (for out4 anyway), and better safe than sorry.\n\t\t *\n\t\t * The clamps on out[] are necessary for the output to be correct even in the\n\t\t * common case and for short inputs.\n\t\t */\n\n\t\tfor (let i = 0; i < 64; i++) {\n\t\t\t// load up the input word for this round\n\n\t\t\tif (i < 16) {\n\t\t\t\ttmp = w[i];\n\t\t\t} else {\n\t\t\t\ta = w[(i + 1) & 15];\n\n\t\t\t\tb = w[(i + 14) & 15];\n\n\t\t\t\ttmp = w[i & 15] =\n\t\t\t\t\t(((a >>> 7) ^ (a >>> 18) ^ (a >>> 3) ^ (a << 25) ^ (a << 14)) +\n\t\t\t\t\t\t((b >>> 17) ^ (b >>> 19) ^ (b >>> 10) ^ (b << 15) ^ (b << 13)) +\n\t\t\t\t\t\tw[i & 15] +\n\t\t\t\t\t\tw[(i + 9) & 15]) |\n\t\t\t\t\t0;\n\t\t\t}\n\n\t\t\ttmp =\n\t\t\t\ttmp +\n\t\t\t\tout7 +\n\t\t\t\t((out4 >>> 6) ^ (out4 >>> 11) ^ (out4 >>> 25) ^ (out4 << 26) ^ (out4 << 21) ^ (out4 << 7)) +\n\t\t\t\t(out6 ^ (out4 & (out5 ^ out6))) +\n\t\t\t\tkey[i]; // | 0;\n\n\t\t\t// shift register\n\t\t\tout7 = out6;\n\t\t\tout6 = out5;\n\t\t\tout5 = out4;\n\n\t\t\tout4 = (out3 + tmp) | 0;\n\n\t\t\tout3 = out2;\n\t\t\tout2 = out1;\n\t\t\tout1 = out0;\n\n\t\t\tout0 =\n\t\t\t\t(tmp +\n\t\t\t\t\t((out1 & out2) ^ (out3 & (out1 ^ out2))) +\n\t\t\t\t\t((out1 >>> 2) ^\n\t\t\t\t\t\t(out1 >>> 13) ^\n\t\t\t\t\t\t(out1 >>> 22) ^\n\t\t\t\t\t\t(out1 << 30) ^\n\t\t\t\t\t\t(out1 << 19) ^\n\t\t\t\t\t\t(out1 << 10))) |\n\t\t\t\t0;\n\t\t}\n\n\t\tout[0] = (out[0] + out0) | 0;\n\t\tout[1] = (out[1] + out1) | 0;\n\t\tout[2] = (out[2] + out2) | 0;\n\t\tout[3] = (out[3] + out3) | 0;\n\t\tout[4] = (out[4] + out4) | 0;\n\t\tout[5] = (out[5] + out5) | 0;\n\t\tout[6] = (out[6] + out6) | 0;\n\t\tout[7] = (out[7] + out7) | 0;\n\t}\n\n\tconst bytes = new Uint8Array(out.buffer);\n\treverse_endianness(bytes);\n\n\treturn btoa(String.fromCharCode(...bytes));\n}\n\n/** The SHA-256 initialization vector */\nconst init = new Uint32Array(8);\n\n/** The SHA-256 hash key */\nconst key = new Uint32Array(64);\n\n/** Function to precompute init and key. */\nfunction precompute() {\n\t/** @param {number} x */\n\tfunction frac(x) {\n\t\treturn (x - Math.floor(x)) * 0x100000000;\n\t}\n\n\tlet prime = 2;\n\n\tfor (let i = 0; i < 64; prime++) {\n\t\tlet is_prime = true;\n\n\t\tfor (let factor = 2; factor * factor <= prime; factor++) {\n\t\t\tif (prime % factor === 0) {\n\t\t\t\tis_prime = false;\n\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (is_prime) {\n\t\t\tif (i < 8) {\n\t\t\t\tinit[i] = frac(prime ** (1 / 2));\n\t\t\t}\n\n\t\t\tkey[i] = frac(prime ** (1 / 3));\n\n\t\t\ti++;\n\t\t}\n\t}\n}\n\n/** @param {Uint8Array} bytes */\nfunction reverse_endianness(bytes) {\n\tfor (let i = 0; i < bytes.length; i += 4) {\n\t\tconst a = bytes[i + 0];\n\t\tconst b = bytes[i + 1];\n\t\tconst c = bytes[i + 2];\n\t\tconst d = bytes[i + 3];\n\n\t\tbytes[i + 0] = d;\n\t\tbytes[i + 1] = c;\n\t\tbytes[i + 2] = b;\n\t\tbytes[i + 3] = a;\n\t}\n}\n\n/** @param {string} str */\nfunction encode(str) {\n\tconst encoded = text_encoder.encode(str);\n\tconst length = encoded.length * 8;\n\n\t// result should be a multiple of 512 bits in length,\n\t// with room for a 1 (after the data) and two 32-bit\n\t// words containing the original input bit length\n\tconst size = 512 * Math.ceil((length + 65) / 512);\n\tconst bytes = new Uint8Array(size / 8);\n\tbytes.set(encoded);\n\n\t// append a 1\n\tbytes[encoded.length] = 0b10000000;\n\n\treverse_endianness(bytes);\n\n\t// add the input bit length\n\tconst words = new Uint32Array(bytes.buffer);\n\twords[words.length - 2] = Math.floor(length / 0x100000000); // this will always be zero for us\n\twords[words.length - 1] = length;\n\n\treturn words;\n}\n","import { DEV } from 'esm-env';\nimport { escape_html } from '../../../utils/escape.js';\nimport { sha256 } from './crypto.js';\n\nconst array = new Uint8Array(16);\n\nfunction generate_nonce() {\n\tcrypto.getRandomValues(array);\n\treturn btoa(String.fromCharCode(...array));\n}\n\nconst quoted = new Set([\n\t'self',\n\t'unsafe-eval',\n\t'unsafe-hashes',\n\t'unsafe-inline',\n\t'none',\n\t'strict-dynamic',\n\t'report-sample',\n\t'wasm-unsafe-eval',\n\t'script'\n]);\n\nconst crypto_pattern = /^(nonce|sha\\d\\d\\d)-/;\n\n// CSP and CSP Report Only are extremely similar with a few caveats\n// the easiest/DRYest way to express this is with some private encapsulation\nclass BaseProvider {\n\t/** @type {boolean} */\n\t#use_hashes;\n\n\t/** @type {boolean} */\n\t#script_needs_csp;\n\n\t/** @type {boolean} */\n\t#script_src_needs_csp;\n\n\t/** @type {boolean} */\n\t#script_src_elem_needs_csp;\n\n\t/** @type {boolean} */\n\t#style_needs_csp;\n\n\t/** @type {boolean} */\n\t#style_src_needs_csp;\n\n\t/** @type {boolean} */\n\t#style_src_attr_needs_csp;\n\n\t/** @type {boolean} */\n\t#style_src_elem_needs_csp;\n\n\t/** @type {import('types').CspDirectives} */\n\t#directives;\n\n\t/** @type {import('types').Csp.Source[]} */\n\t#script_src;\n\n\t/** @type {import('types').Csp.Source[]} */\n\t#script_src_elem;\n\n\t/** @type {import('types').Csp.Source[]} */\n\t#style_src;\n\n\t/** @type {import('types').Csp.Source[]} */\n\t#style_src_attr;\n\n\t/** @type {import('types').Csp.Source[]} */\n\t#style_src_elem;\n\n\t/** @type {string} */\n\t#nonce;\n\n\t/**\n\t * @param {boolean} use_hashes\n\t * @param {import('types').CspDirectives} directives\n\t * @param {string} nonce\n\t */\n\tconstructor(use_hashes, directives, nonce) {\n\t\tthis.#use_hashes = use_hashes;\n\t\tthis.#directives = DEV ? { ...directives } : directives; // clone in dev so we can safely mutate\n\n\t\tconst d = this.#directives;\n\n\t\tthis.#script_src = [];\n\t\tthis.#script_src_elem = [];\n\t\tthis.#style_src = [];\n\t\tthis.#style_src_attr = [];\n\t\tthis.#style_src_elem = [];\n\n\t\tconst effective_script_src = d['script-src'] || d['default-src'];\n\t\tconst script_src_elem = d['script-src-elem'];\n\t\tconst effective_style_src = d['style-src'] || d['default-src'];\n\t\tconst style_src_attr = d['style-src-attr'];\n\t\tconst style_src_elem = d['style-src-elem'];\n\n\t\tif (DEV) {\n\t\t\t// remove strict-dynamic in dev...\n\t\t\t// TODO reinstate this if we can figure out how to make strict-dynamic work\n\t\t\t// if (d['default-src']) {\n\t\t\t// \td['default-src'] = d['default-src'].filter((name) => name !== 'strict-dynamic');\n\t\t\t// \tif (d['default-src'].length === 0) delete d['default-src'];\n\t\t\t// }\n\n\t\t\t// if (d['script-src']) {\n\t\t\t// \td['script-src'] = d['script-src'].filter((name) => name !== 'strict-dynamic');\n\t\t\t// \tif (d['script-src'].length === 0) delete d['script-src'];\n\t\t\t// }\n\n\t\t\t// ...and add unsafe-inline so we can inject <style> elements\n\t\t\t// Note that 'unsafe-inline' is ignored if either a hash or nonce value is present in the source list, so we remove those during dev when injecting unsafe-inline\n\t\t\tif (effective_style_src && !effective_style_src.includes('unsafe-inline')) {\n\t\t\t\td['style-src'] = [\n\t\t\t\t\t...effective_style_src.filter(\n\t\t\t\t\t\t(value) => !(value.startsWith('sha256-') || value.startsWith('nonce-'))\n\t\t\t\t\t),\n\t\t\t\t\t'unsafe-inline'\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tif (style_src_attr && !style_src_attr.includes('unsafe-inline')) {\n\t\t\t\td['style-src-attr'] = [\n\t\t\t\t\t...style_src_attr.filter(\n\t\t\t\t\t\t(value) => !(value.startsWith('sha256-') || value.startsWith('nonce-'))\n\t\t\t\t\t),\n\t\t\t\t\t'unsafe-inline'\n\t\t\t\t];\n\t\t\t}\n\n\t\t\tif (style_src_elem && !style_src_elem.includes('unsafe-inline')) {\n\t\t\t\td['style-src-elem'] = [\n\t\t\t\t\t...style_src_elem.filter(\n\t\t\t\t\t\t(value) => !(value.startsWith('sha256-') || value.startsWith('nonce-'))\n\t\t\t\t\t),\n\t\t\t\t\t'unsafe-inline'\n\t\t\t\t];\n\t\t\t}\n\t\t}\n\n\t\t/** @param {(import('types').Csp.Source | import('types').Csp.ActionSource)[] | undefined} directive */\n\t\tconst needs_csp = (directive) =>\n\t\t\t!!directive && !directive.some((value) => value === 'unsafe-inline');\n\n\t\tthis.#script_src_needs_csp = needs_csp(effective_script_src);\n\t\tthis.#script_src_elem_needs_csp = needs_csp(script_src_elem);\n\t\tthis.#style_src_needs_csp = needs_csp(effective_style_src);\n\t\tthis.#style_src_attr_needs_csp = needs_csp(style_src_attr);\n\t\tthis.#style_src_elem_needs_csp = needs_csp(style_src_elem);\n\n\t\tthis.#script_needs_csp = this.#script_src_needs_csp || this.#script_src_elem_needs_csp;\n\t\tthis.#style_needs_csp =\n\t\t\t!DEV &&\n\t\t\t(this.#style_src_needs_csp ||\n\t\t\t\tthis.#style_src_attr_needs_csp ||\n\t\t\t\tthis.#style_src_elem_needs_csp);\n\n\t\tthis.script_needs_nonce = this.#script_needs_csp && !this.#use_hashes;\n\t\tthis.style_needs_nonce = this.#style_needs_csp && !this.#use_hashes;\n\n\t\tthis.#nonce = nonce;\n\t}\n\n\t/** @param {string} content */\n\tadd_script(content) {\n\t\tif (!this.#script_needs_csp) return;\n\n\t\t/** @type {`nonce-${string}` | `sha256-${string}`} */\n\t\tconst source = this.#use_hashes ? `sha256-${sha256(content)}` : `nonce-${this.#nonce}`;\n\n\t\tif (this.#script_src_needs_csp) {\n\t\t\tthis.#script_src.push(source);\n\t\t}\n\n\t\tif (this.#script_src_elem_needs_csp) {\n\t\t\tthis.#script_src_elem.push(source);\n\t\t}\n\t}\n\n\t/** @param {string} content */\n\tadd_style(content) {\n\t\tif (!this.#style_needs_csp) return;\n\n\t\t/** @type {`nonce-${string}` | `sha256-${string}`} */\n\t\tconst source = this.#use_hashes ? `sha256-${sha256(content)}` : `nonce-${this.#nonce}`;\n\n\t\tif (this.#style_src_needs_csp) {\n\t\t\tthis.#style_src.push(source);\n\t\t}\n\n\t\tif (this.#style_src_attr_needs_csp) {\n\t\t\tthis.#style_src_attr.push(source);\n\t\t}\n\n\t\tif (this.#style_src_elem_needs_csp) {\n\t\t\t// this is the sha256 hash for the string \"/* empty */\"\n\t\t\t// adding it so that svelte does not break csp\n\t\t\t// see https://github.com/sveltejs/svelte/pull/7800\n\t\t\tconst sha256_empty_comment_hash = 'sha256-9OlNO0DNEeaVzHL4RZwCLsBHA8WBQ8toBp/4F5XV2nc=';\n\t\t\tconst d = this.#directives;\n\n\t\t\tif (\n\t\t\t\td['style-src-elem'] &&\n\t\t\t\t!d['style-src-elem'].includes(sha256_empty_comment_hash) &&\n\t\t\t\t!this.#style_src_elem.includes(sha256_empty_comment_hash)\n\t\t\t) {\n\t\t\t\tthis.#style_src_elem.push(sha256_empty_comment_hash);\n\t\t\t}\n\n\t\t\tif (source !== sha256_empty_comment_hash) {\n\t\t\t\tthis.#style_src_elem.push(source);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @param {boolean} [is_meta]\n\t */\n\tget_header(is_meta = false) {\n\t\tconst header = [];\n\n\t\t// due to browser inconsistencies, we can't append sources to default-src\n\t\t// (specifically, Firefox appears to not ignore nonce-{nonce} directives\n\t\t// on default-src), so we ensure that script-src and style-src exist\n\n\t\tconst directives = { ...this.#directives };\n\n\t\tif (this.#style_src.length > 0) {\n\t\t\tdirectives['style-src'] = [\n\t\t\t\t...(directives['style-src'] || directives['default-src'] || []),\n\t\t\t\t...this.#style_src\n\t\t\t];\n\t\t}\n\n\t\tif (this.#style_src_attr.length > 0) {\n\t\t\tdirectives['style-src-attr'] = [\n\t\t\t\t...(directives['style-src-attr'] || []),\n\t\t\t\t...this.#style_src_attr\n\t\t\t];\n\t\t}\n\n\t\tif (this.#style_src_elem.length > 0) {\n\t\t\tdirectives['style-src-elem'] = [\n\t\t\t\t...(directives['style-src-elem'] || []),\n\t\t\t\t...this.#style_src_elem\n\t\t\t];\n\t\t}\n\n\t\tif (this.#script_src.length > 0) {\n\t\t\tdirectives['script-src'] = [\n\t\t\t\t...(directives['script-src'] || directives['default-src'] || []),\n\t\t\t\t...this.#script_src\n\t\t\t];\n\t\t}\n\n\t\tif (this.#script_src_elem.length > 0) {\n\t\t\tdirectives['script-src-elem'] = [\n\t\t\t\t...(directives['script-src-elem'] || []),\n\t\t\t\t...this.#script_src_elem\n\t\t\t];\n\t\t}\n\n\t\tfor (const key in directives) {\n\t\t\tif (is_meta && (key === 'frame-ancestors' || key === 'report-uri' || key === 'sandbox')) {\n\t\t\t\t// these values cannot be used with a <meta> tag\n\t\t\t\t// TODO warn?\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// @ts-expect-error gimme a break typescript, `key` is obviously a member of internal_directives\n\t\t\tconst value = /** @type {string[] | true} */ (directives[key]);\n\n\t\t\tif (!value) continue;\n\n\t\t\tconst directive = [key];\n\t\t\tif (Array.isArray(value)) {\n\t\t\t\tvalue.forEach((value) => {\n\t\t\t\t\tif (quoted.has(value) || crypto_pattern.test(value)) {\n\t\t\t\t\t\tdirective.push(`'${value}'`);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdirective.push(value);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t\theader.push(directive.join(' '));\n\t\t}\n\n\t\treturn header.join('; ');\n\t}\n}\n\nclass CspProvider extends BaseProvider {\n\tget_meta() {\n\t\tconst content = this.get_header(true);\n\n\t\tif (!content) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn `<meta http-equiv=\"content-security-policy\" content=\"${escape_html(content, true)}\">`;\n\t}\n}\n\nclass CspReportOnlyProvider extends BaseProvider {\n\t/**\n\t * @param {boolean} use_hashes\n\t * @param {import('types').CspDirectives} directives\n\t * @param {string} nonce\n\t */\n\tconstructor(use_hashes, directives, nonce) {\n\t\tsuper(use_hashes, directives, nonce);\n\n\t\tif (Object.values(directives).filter((v) => !!v).length > 0) {\n\t\t\t// If we're generating content-security-policy-report-only,\n\t\t\t// if there are any directives, we need a report-uri or report-to (or both)\n\t\t\t// else it's just an expensive noop.\n\t\t\tconst has_report_to = directives['report-to']?.length ?? 0 > 0;\n\t\t\tconst has_report_uri = directives['report-uri']?.length ?? 0 > 0;\n\t\t\tif (!has_report_to && !has_report_uri) {\n\t\t\t\tthrow Error(\n\t\t\t\t\t'`content-security-policy-report-only` must be specified with either the `report-to` or `report-uri` directives, or both'\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class Csp {\n\t/** @readonly */\n\tnonce = generate_nonce();\n\n\t/** @type {CspProvider} */\n\tcsp_provider;\n\n\t/** @type {CspReportOnlyProvider} */\n\treport_only_provider;\n\n\t/**\n\t * @param {import('./types.js').CspConfig} config\n\t * @param {import('./types.js').CspOpts} opts\n\t */\n\tconstructor({ mode, directives, reportOnly }, { prerender }) {\n\t\tconst use_hashes = mode === 'hash' || (mode === 'auto' && prerender);\n\t\tthis.csp_provider = new CspProvider(use_hashes, directives, this.nonce);\n\t\tthis.report_only_provider = new CspReportOnlyProvider(use_hashes, reportOnly, this.nonce);\n\t}\n\n\tget script_needs_nonce() {\n\t\treturn this.csp_provider.script_needs_nonce || this.report_only_provider.script_needs_nonce;\n\t}\n\n\tget style_needs_nonce() {\n\t\treturn this.csp_provider.style_needs_nonce || this.report_only_provider.style_needs_nonce;\n\t}\n\n\t/** @param {string} content */\n\tadd_script(content) {\n\t\tthis.csp_provider.add_script(content);\n\t\tthis.report_only_provider.add_script(content);\n\t}\n\n\t/** @param {string} content */\n\tadd_style(content) {\n\t\tthis.csp_provider.add_style(content);\n\t\tthis.report_only_provider.add_style(content);\n\t}\n}\n","import { BROWSER } from 'esm-env';\n\nconst param_pattern = /^(\\[)?(\\.\\.\\.)?(\\w+)(?:=(\\w+))?(\\])?$/;\n\n/**\n * Creates the regex pattern, extracts parameter names, and generates types for a route\n * @param {string} id\n */\nexport function parse_route_id(id) {\n\t/** @type {import('types').RouteParam[]} */\n\tconst params = [];\n\n\tconst pattern =\n\t\tid === '/'\n\t\t\t? /^\\/$/\n\t\t\t: new RegExp(\n\t\t\t\t\t`^${get_route_segments(id)\n\t\t\t\t\t\t.map((segment) => {\n\t\t\t\t\t\t\t// special case — /[...rest]/ could contain zero segments\n\t\t\t\t\t\t\tconst rest_match = /^\\[\\.\\.\\.(\\w+)(?:=(\\w+))?\\]$/.exec(segment);\n\t\t\t\t\t\t\tif (rest_match) {\n\t\t\t\t\t\t\t\tparams.push({\n\t\t\t\t\t\t\t\t\tname: rest_match[1],\n\t\t\t\t\t\t\t\t\tmatcher: rest_match[2],\n\t\t\t\t\t\t\t\t\toptional: false,\n\t\t\t\t\t\t\t\t\trest: true,\n\t\t\t\t\t\t\t\t\tchained: true\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn '(?:/([^]*))?';\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t// special case — /[[optional]]/ could contain zero segments\n\t\t\t\t\t\t\tconst optional_match = /^\\[\\[(\\w+)(?:=(\\w+))?\\]\\]$/.exec(segment);\n\t\t\t\t\t\t\tif (optional_match) {\n\t\t\t\t\t\t\t\tparams.push({\n\t\t\t\t\t\t\t\t\tname: optional_match[1],\n\t\t\t\t\t\t\t\t\tmatcher: optional_match[2],\n\t\t\t\t\t\t\t\t\toptional: true,\n\t\t\t\t\t\t\t\t\trest: false,\n\t\t\t\t\t\t\t\t\tchained: true\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn '(?:/([^/]+))?';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (!segment) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tconst parts = segment.split(/\\[(.+?)\\](?!\\])/);\n\t\t\t\t\t\t\tconst result = parts\n\t\t\t\t\t\t\t\t.map((content, i) => {\n\t\t\t\t\t\t\t\t\tif (i % 2) {\n\t\t\t\t\t\t\t\t\t\tif (content.startsWith('x+')) {\n\t\t\t\t\t\t\t\t\t\t\treturn escape(String.fromCharCode(parseInt(content.slice(2), 16)));\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (content.startsWith('u+')) {\n\t\t\t\t\t\t\t\t\t\t\treturn escape(\n\t\t\t\t\t\t\t\t\t\t\t\tString.fromCharCode(\n\t\t\t\t\t\t\t\t\t\t\t\t\t...content\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.slice(2)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.split('-')\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t.map((code) => parseInt(code, 16))\n\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t// We know the match cannot be null in the browser because manifest generation\n\t\t\t\t\t\t\t\t\t\t// would have invoked this during build and failed if we hit an invalid\n\t\t\t\t\t\t\t\t\t\t// param/matcher name with non-alphanumeric character.\n\t\t\t\t\t\t\t\t\t\tconst match = /** @type {RegExpExecArray} */ (param_pattern.exec(content));\n\t\t\t\t\t\t\t\t\t\tif (!BROWSER && !match) {\n\t\t\t\t\t\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t\t\t\t\t\t`Invalid param: ${content}. Params and matcher names can only have underscores and alphanumeric characters.`\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tconst [, is_optional, is_rest, name, matcher] = match;\n\t\t\t\t\t\t\t\t\t\t// It's assumed that the following invalid route id cases are already checked\n\t\t\t\t\t\t\t\t\t\t// - unbalanced brackets\n\t\t\t\t\t\t\t\t\t\t// - optional param following rest param\n\n\t\t\t\t\t\t\t\t\t\tparams.push({\n\t\t\t\t\t\t\t\t\t\t\tname,\n\t\t\t\t\t\t\t\t\t\t\tmatcher,\n\t\t\t\t\t\t\t\t\t\t\toptional: !!is_optional,\n\t\t\t\t\t\t\t\t\t\t\trest: !!is_rest,\n\t\t\t\t\t\t\t\t\t\t\tchained: is_rest ? i === 1 && parts[0] === '' : false\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn is_rest ? '([^]*?)' : is_optional ? '([^/]*)?' : '([^/]+?)';\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\treturn escape(content);\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.join('');\n\n\t\t\t\t\t\t\treturn '/' + result;\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.join('')}/?$`\n\t\t\t\t);\n\n\treturn { pattern, params };\n}\n\nconst optional_param_regex = /\\/\\[\\[\\w+?(?:=\\w+)?\\]\\]/;\n\n/**\n * Removes optional params from a route ID.\n * @param {string} id\n * @returns The route id with optional params removed\n */\nexport function remove_optional_params(id) {\n\treturn id.replace(optional_param_regex, '');\n}\n\n/**\n * Returns `false` for `(group)` segments\n * @param {string} segment\n */\nfunction affects_path(segment) {\n\treturn segment !== '' && !/^\\([^)]+\\)$/.test(segment);\n}\n\n/**\n * Splits a route id into its segments, removing segments that\n * don't affect the path (i.e. groups). The root route is represented by `/`\n * and will be returned as `['']`.\n * @param {string} route\n * @returns string[]\n */\nexport function get_route_segments(route) {\n\treturn route.slice(1).split('/').filter(affects_path);\n}\n\n/**\n * @param {RegExpMatchArray} match\n * @param {import('types').RouteParam[]} params\n * @param {Record<string, import('@sveltejs/kit').ParamMatcher>} matchers\n */\nexport function exec(match, params, matchers) {\n\t/** @type {Record<string, string>} */\n\tconst result = {};\n\n\tconst values = match.slice(1);\n\tconst values_needing_match = values.filter((value) => value !== undefined);\n\n\tlet buffered = 0;\n\n\tfor (let i = 0; i < params.length; i += 1) {\n\t\tconst param = params[i];\n\t\tlet value = values[i - buffered];\n\n\t\t// in the `[[a=b]]/.../[...rest]` case, if one or more optional parameters\n\t\t// weren't matched, roll the skipped values into the rest\n\t\tif (param.chained && param.rest && buffered) {\n\t\t\tvalue = values\n\t\t\t\t.slice(i - buffered, i + 1)\n\t\t\t\t.filter((s) => s)\n\t\t\t\t.join('/');\n\n\t\t\tbuffered = 0;\n\t\t}\n\n\t\t// if `value` is undefined, it means this is an optional or rest parameter\n\t\tif (value === undefined) {\n\t\t\tif (param.rest) result[param.name] = '';\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (!param.matcher || matchers[param.matcher](value)) {\n\t\t\tresult[param.name] = value;\n\n\t\t\t// Now that the params match, reset the buffer if the next param isn't the [...rest]\n\t\t\t// and the next value is defined, otherwise the buffer will cause us to skip values\n\t\t\tconst next_param = params[i + 1];\n\t\t\tconst next_value = values[i + 1];\n\t\t\tif (next_param && !next_param.rest && next_param.optional && next_value && param.chained) {\n\t\t\t\tbuffered = 0;\n\t\t\t}\n\n\t\t\t// There are no more params and no more values, but all non-empty values have been matched\n\t\t\tif (\n\t\t\t\t!next_param &&\n\t\t\t\t!next_value &&\n\t\t\t\tObject.keys(result).length === values_needing_match.length\n\t\t\t) {\n\t\t\t\tbuffered = 0;\n\t\t\t}\n\t\t\tcontinue;\n\t\t}\n\n\t\t// in the `/[[a=b]]/...` case, if the value didn't satisfy the matcher,\n\t\t// keep track of the number of skipped optional parameters and continue\n\t\tif (param.optional && param.chained) {\n\t\t\tbuffered++;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// otherwise, if the matcher returns `false`, the route did not match\n\t\treturn;\n\t}\n\n\tif (buffered) return;\n\treturn result;\n}\n\n/** @param {string} str */\nfunction escape(str) {\n\treturn (\n\t\tstr\n\t\t\t.normalize()\n\t\t\t// escape [ and ] before escaping other characters, since they are used in the replacements\n\t\t\t.replace(/[[\\]]/g, '\\\\$&')\n\t\t\t// replace %, /, ? and # with their encoded versions because decode_pathname leaves them untouched\n\t\t\t.replace(/%/g, '%25')\n\t\t\t.replace(/\\//g, '%2[Ff]')\n\t\t\t.replace(/\\?/g, '%3[Ff]')\n\t\t\t.replace(/#/g, '%23')\n\t\t\t// escape characters that have special meaning in regex\n\t\t\t.replace(/[.*+?^${}()|\\\\]/g, '\\\\$&')\n\t);\n}\n\nconst basic_param_pattern = /\\[(\\[)?(\\.\\.\\.)?(\\w+?)(?:=(\\w+))?\\]\\]?/g;\n\n/**\n * Populate a route ID with params to resolve a pathname.\n * @example\n * ```js\n * resolveRoute(\n *   `/blog/[slug]/[...somethingElse]`,\n *   {\n *     slug: 'hello-world',\n *     somethingElse: 'something/else'\n *   }\n * ); // `/blog/hello-world/something/else`\n * ```\n * @param {string} id\n * @param {Record<string, string | undefined>} params\n * @returns {string}\n */\nexport function resolve_route(id, params) {\n\tconst segments = get_route_segments(id);\n\tconst has_id_trailing_slash = id != '/' && id.endsWith('/');\n\n\treturn (\n\t\t'/' +\n\t\tsegments\n\t\t\t.map((segment) =>\n\t\t\t\tsegment.replace(basic_param_pattern, (_, optional, rest, name) => {\n\t\t\t\t\tconst param_value = params[name];\n\n\t\t\t\t\t// This is nested so TS correctly narrows the type\n\t\t\t\t\tif (!param_value) {\n\t\t\t\t\t\tif (optional) return '';\n\t\t\t\t\t\tif (rest && param_value !== undefined) return '';\n\t\t\t\t\t\tthrow new Error(`Missing parameter '${name}' in route ${id}`);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (param_value.startsWith('/') || param_value.endsWith('/'))\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Parameter '${name}' in route ${id} cannot start or end with a slash -- this would cause an invalid route like foo//bar`\n\t\t\t\t\t\t);\n\t\t\t\t\treturn param_value;\n\t\t\t\t})\n\t\t\t)\n\t\t\t.filter(Boolean)\n\t\t\t.join('/') +\n\t\t(has_id_trailing_slash ? '/' : '')\n\t);\n}\n\n/**\n * @param {import('types').SSRNode} node\n * @returns {boolean}\n */\nexport function has_server_load(node) {\n\treturn node.server?.load !== undefined || node.server?.trailingSlash !== undefined;\n}\n","import { base, assets, relative } from '$app/paths/internal/server';\nimport { text } from '@sveltejs/kit';\nimport { s } from '../../../utils/misc.js';\nimport { exec } from '../../../utils/routing.js';\nimport { decode_params } from '../../../utils/url.js';\nimport { get_relative_path } from '../../utils.js';\n\n/**\n * @param {import('types').SSRClientRoute} route\n * @param {URL} url\n * @param {import('@sveltejs/kit').SSRManifest} manifest\n * @returns {string}\n */\nexport function generate_route_object(route, url, manifest) {\n\tconst { errors, layouts, leaf } = route;\n\n\tconst nodes = [...errors, ...layouts.map((l) => l?.[1]), leaf[1]]\n\t\t.filter((n) => typeof n === 'number')\n\t\t.map((n) => `'${n}': () => ${create_client_import(manifest._.client.nodes?.[n], url)}`)\n\t\t.join(',\\n\\t\\t');\n\n\t// stringified version of\n\t/** @type {import('types').CSRRouteServer} */\n\treturn [\n\t\t`{\\n\\tid: ${s(route.id)}`,\n\t\t`errors: ${s(route.errors)}`,\n\t\t`layouts: ${s(route.layouts)}`,\n\t\t`leaf: ${s(route.leaf)}`,\n\t\t`nodes: {\\n\\t\\t${nodes}\\n\\t}\\n}`\n\t].join(',\\n\\t');\n}\n\n/**\n * @param {string | undefined} import_path\n * @param {URL} url\n */\nfunction create_client_import(import_path, url) {\n\tif (!import_path) return 'Promise.resolve({})';\n\n\t// During DEV, Vite will make the paths absolute (e.g. /@fs/...)\n\tif (import_path[0] === '/') {\n\t\treturn `import('${import_path}')`;\n\t}\n\n\t// During PROD, they're root-relative\n\tif (assets !== '') {\n\t\treturn `import('${assets}/${import_path}')`;\n\t}\n\n\tif (!relative) {\n\t\treturn `import('${base}/${import_path}')`;\n\t}\n\n\t// Else we make them relative to the server-side route resolution request\n\t// to support IPFS, the internet archive, etc.\n\tlet path = get_relative_path(url.pathname, `${base}/${import_path}`);\n\tif (path[0] !== '.') path = `./${path}`;\n\treturn `import('${path}')`;\n}\n\n/**\n * @param {string} resolved_path\n * @param {URL} url\n * @param {import('@sveltejs/kit').SSRManifest} manifest\n * @returns {Promise<Response>}\n */\nexport async function resolve_route(resolved_path, url, manifest) {\n\tif (!manifest._.client.routes) {\n\t\treturn text('Server-side route resolution disabled', { status: 400 });\n\t}\n\n\t/** @type {import('types').SSRClientRoute | null} */\n\tlet route = null;\n\t/** @type {Record<string, string>} */\n\tlet params = {};\n\n\tconst matchers = await manifest._.matchers();\n\n\tfor (const candidate of manifest._.client.routes) {\n\t\tconst match = candidate.pattern.exec(resolved_path);\n\t\tif (!match) continue;\n\n\t\tconst matched = exec(match, candidate.params, matchers);\n\t\tif (matched) {\n\t\t\troute = candidate;\n\t\t\tparams = decode_params(matched);\n\t\t\tbreak;\n\t\t}\n\t}\n\n\treturn create_server_routing_response(route, params, url, manifest).response;\n}\n\n/**\n * @param {import('types').SSRClientRoute | null} route\n * @param {Partial<Record<string, string>>} params\n * @param {URL} url\n * @param {import('@sveltejs/kit').SSRManifest} manifest\n * @returns {{response: Response, body: string}}\n */\nexport function create_server_routing_response(route, params, url, manifest) {\n\tconst headers = new Headers({\n\t\t'content-type': 'application/javascript; charset=utf-8'\n\t});\n\n\tif (route) {\n\t\tconst csr_route = generate_route_object(route, url, manifest);\n\t\tconst body = `${create_css_import(route, url, manifest)}\\nexport const route = ${csr_route}; export const params = ${JSON.stringify(params)};`;\n\n\t\treturn { response: text(body, { headers }), body };\n\t} else {\n\t\treturn { response: text('', { headers }), body: '' };\n\t}\n}\n\n/**\n * This function generates the client-side import for the CSS files that are\n * associated with the current route. Vite takes care of that when using\n * client-side route resolution, but for server-side resolution it does\n * not know about the CSS files automatically.\n *\n * @param {import('types').SSRClientRoute} route\n * @param {URL} url\n * @param {import('@sveltejs/kit').SSRManifest} manifest\n * @returns {string}\n */\nfunction create_css_import(route, url, manifest) {\n\tconst { errors, layouts, leaf } = route;\n\n\tlet css = '';\n\n\tfor (const node of [...errors, ...layouts.map((l) => l?.[1]), leaf[1]]) {\n\t\tif (typeof node !== 'number') continue;\n\t\tconst node_css = manifest._.client.css?.[node];\n\t\tfor (const css_path of node_css ?? []) {\n\t\t\tcss += `'${assets || base}/${css_path}',`;\n\t\t}\n\t}\n\n\tif (!css) return '';\n\n\treturn `${create_client_import(/** @type {string} */ (manifest._.client.start), url)}.then(x => x.load_css([${css}]));`;\n}\n","import * as devalue from 'devalue';\nimport { readable, writable } from 'svelte/store';\nimport { DEV } from 'esm-env';\nimport { text } from '@sveltejs/kit';\nimport * as paths from '$app/paths/internal/server';\nimport { hash } from '../../../utils/hash.js';\nimport { serialize_data } from './serialize_data.js';\nimport { s } from '../../../utils/misc.js';\nimport { Csp } from './csp.js';\nimport { uneval_action_response } from './actions.js';\nimport { public_env } from '../../shared-server.js';\nimport { SVELTE_KIT_ASSETS } from '../../../constants.js';\nimport { SCHEME } from '../../../utils/url.js';\nimport { create_server_routing_response, generate_route_object } from './server_routing.js';\nimport { add_resolution_suffix } from '../../pathname.js';\nimport { try_get_request_store, with_request_store } from '@sveltejs/kit/internal/server';\nimport { text_encoder } from '../../utils.js';\nimport { get_global_name } from '../utils.js';\nimport { create_remote_key } from '../../shared.js';\n\n// TODO rename this function/module\n\nconst updated = {\n\t...readable(false),\n\tcheck: () => false\n};\n\n/**\n * Creates the HTML response.\n * @param {{\n *   branch: Array<import('./types.js').Loaded>;\n *   fetched: Array<import('./types.js').Fetched>;\n *   options: import('types').SSROptions;\n *   manifest: import('@sveltejs/kit').SSRManifest;\n *   state: import('types').SSRState;\n *   page_config: { ssr: boolean; csr: boolean };\n *   status: number;\n *   error: App.Error | null;\n *   event: import('@sveltejs/kit').RequestEvent;\n *   event_state: import('types').RequestState;\n *   resolve_opts: import('types').RequiredResolveOptions;\n *   action_result?: import('@sveltejs/kit').ActionResult;\n *   data_serializer: import('./types.js').ServerDataSerializer\n * }} opts\n */\nexport async function render_response({\n\tbranch,\n\tfetched,\n\toptions,\n\tmanifest,\n\tstate,\n\tpage_config,\n\tstatus,\n\terror = null,\n\tevent,\n\tevent_state,\n\tresolve_opts,\n\taction_result,\n\tdata_serializer\n}) {\n\tif (state.prerendering) {\n\t\tif (options.csp.mode === 'nonce') {\n\t\t\tthrow new Error('Cannot use prerendering if config.kit.csp.mode === \"nonce\"');\n\t\t}\n\n\t\tif (options.app_template_contains_nonce) {\n\t\t\tthrow new Error('Cannot use prerendering if page template contains %sveltekit.nonce%');\n\t\t}\n\t}\n\n\tconst { client } = manifest._;\n\n\tconst modulepreloads = new Set(client.imports);\n\tconst stylesheets = new Set(client.stylesheets);\n\tconst fonts = new Set(client.fonts);\n\n\t/**\n\t * The value of the Link header that is added to the response when not prerendering\n\t * @type {Set<string>}\n\t */\n\tconst link_headers = new Set();\n\n\t/**\n\t * `<link>` tags that are added to prerendered responses\n\t * (note that stylesheets are always added, prerendered or not)\n\t * @type {Set<string>}\n\t */\n\tconst link_tags = new Set();\n\n\t/** @type {Map<string, string>} */\n\t// TODO if we add a client entry point one day, we will need to include inline_styles with the entry, otherwise stylesheets will be linked even if they are below inlineStyleThreshold\n\tconst inline_styles = new Map();\n\n\tlet rendered;\n\n\tconst form_value =\n\t\taction_result?.type === 'success' || action_result?.type === 'failure'\n\t\t\t? (action_result.data ?? null)\n\t\t\t: null;\n\n\t/** @type {string} */\n\tlet base = paths.base;\n\n\t/** @type {string} */\n\tlet assets = paths.assets;\n\n\t/**\n\t * An expression that will evaluate in the client to determine the resolved base path.\n\t * We use a relative path when possible to support IPFS, the internet archive, etc.\n\t */\n\tlet base_expression = s(paths.base);\n\n\t// if appropriate, use relative paths for greater portability\n\tif (paths.relative) {\n\t\tif (!state.prerendering?.fallback) {\n\t\t\tconst segments = event.url.pathname.slice(paths.base.length).split('/').slice(2);\n\n\t\t\tbase = segments.map(() => '..').join('/') || '.';\n\n\t\t\t// resolve e.g. '../..' against current location, then remove trailing slash\n\t\t\tbase_expression = `new URL(${s(base)}, location).pathname.slice(0, -1)`;\n\n\t\t\tif (!paths.assets || (paths.assets[0] === '/' && paths.assets !== SVELTE_KIT_ASSETS)) {\n\t\t\t\tassets = base;\n\t\t\t}\n\t\t} else if (options.hash_routing) {\n\t\t\t// we have to assume that we're in the right place\n\t\t\tbase_expression = \"new URL('.', location).pathname.slice(0, -1)\";\n\t\t}\n\t}\n\n\tif (page_config.ssr) {\n\t\t/** @type {Record<string, any>} */\n\t\tconst props = {\n\t\t\tstores: {\n\t\t\t\tpage: writable(null),\n\t\t\t\tnavigating: writable(null),\n\t\t\t\tupdated\n\t\t\t},\n\t\t\tconstructors: await Promise.all(\n\t\t\t\tbranch.map(({ node }) => {\n\t\t\t\t\tif (!node.component) {\n\t\t\t\t\t\t// Can only be the leaf, layouts have a fallback component generated\n\t\t\t\t\t\tthrow new Error(`Missing +page.svelte component for route ${event.route.id}`);\n\t\t\t\t\t}\n\t\t\t\t\treturn node.component();\n\t\t\t\t})\n\t\t\t),\n\t\t\tform: form_value\n\t\t};\n\n\t\tlet data = {};\n\n\t\t// props_n (instead of props[n]) makes it easy to avoid\n\t\t// unnecessary updates for layout components\n\t\tfor (let i = 0; i < branch.length; i += 1) {\n\t\t\tdata = { ...data, ...branch[i].data };\n\t\t\tprops[`data_${i}`] = data;\n\t\t}\n\n\t\tprops.page = {\n\t\t\terror,\n\t\t\tparams: /** @type {Record<string, any>} */ (event.params),\n\t\t\troute: event.route,\n\t\t\tstatus,\n\t\t\turl: event.url,\n\t\t\tdata,\n\t\t\tform: form_value,\n\t\t\tstate: {}\n\t\t};\n\n\t\tconst render_opts = {\n\t\t\tcontext: new Map([\n\t\t\t\t[\n\t\t\t\t\t'__request__',\n\t\t\t\t\t{\n\t\t\t\t\t\tpage: props.page\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t])\n\t\t};\n\n\t\tconst fetch = globalThis.fetch;\n\n\t\ttry {\n\t\t\tif (DEV) {\n\t\t\t\tlet warned = false;\n\t\t\t\tglobalThis.fetch = (info, init) => {\n\t\t\t\t\tif (typeof info === 'string' && !SCHEME.test(info)) {\n\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t`Cannot call \\`fetch\\` eagerly during server-side rendering with relative URL (${info}) — put your \\`fetch\\` calls inside \\`onMount\\` or a \\`load\\` function instead`\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if (!warned && !try_get_request_store()?.state.is_in_remote_function) {\n\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t'Avoid calling `fetch` eagerly during server-side rendering — put your `fetch` calls inside `onMount` or a `load` function instead'\n\t\t\t\t\t\t);\n\t\t\t\t\t\twarned = true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn fetch(info, init);\n\t\t\t\t};\n\t\t\t}\n\n\t\t\trendered = await with_request_store({ event, state: event_state }, async () => {\n\t\t\t\t// use relative paths during rendering, so that the resulting HTML is as\n\t\t\t\t// portable as possible, but reset afterwards\n\t\t\t\tif (paths.relative) paths.override({ base, assets });\n\n\t\t\t\tconst maybe_promise = options.root.render(props, render_opts);\n\t\t\t\t// We have to invoke .then eagerly here in order to kick off rendering: it's only starting on access,\n\t\t\t\t// and `await maybe_promise` would eagerly access the .then property but call its function only after a tick, which is too late\n\t\t\t\t// for the paths.reset() below and for any eager getRequestEvent() calls during rendering without AsyncLocalStorage available.\n\t\t\t\tconst rendered =\n\t\t\t\t\toptions.async && 'then' in maybe_promise\n\t\t\t\t\t\t? /** @type {ReturnType<typeof options.root.render> & Promise<any>} */ (\n\t\t\t\t\t\t\t\tmaybe_promise\n\t\t\t\t\t\t\t).then((r) => r)\n\t\t\t\t\t\t: maybe_promise;\n\n\t\t\t\t// TODO 3.0 remove options.async\n\t\t\t\tif (options.async) {\n\t\t\t\t\t// we reset this synchronously, rather than after async rendering is complete,\n\t\t\t\t\t// to avoid cross-talk between requests. This is a breaking change for\n\t\t\t\t\t// anyone who opts into async SSR, since `base` and `assets` will no\n\t\t\t\t\t// longer be relative to the current pathname.\n\t\t\t\t\t// TODO 3.0 remove `base` and `assets` in favour of `resolve(...)` and `asset(...)`\n\t\t\t\t\tpaths.reset();\n\t\t\t\t}\n\n\t\t\t\tconst { head, html, css } = options.async ? await rendered : rendered;\n\n\t\t\t\treturn { head, html, css };\n\t\t\t});\n\t\t} finally {\n\t\t\tif (DEV) {\n\t\t\t\tglobalThis.fetch = fetch;\n\t\t\t}\n\n\t\t\tpaths.reset(); // just in case `options.root.render(...)` failed\n\t\t}\n\n\t\tfor (const { node } of branch) {\n\t\t\tfor (const url of node.imports) modulepreloads.add(url);\n\t\t\tfor (const url of node.stylesheets) stylesheets.add(url);\n\t\t\tfor (const url of node.fonts) fonts.add(url);\n\n\t\t\tif (node.inline_styles && !client.inline) {\n\t\t\t\tObject.entries(await node.inline_styles()).forEach(([k, v]) => inline_styles.set(k, v));\n\t\t\t}\n\t\t}\n\t} else {\n\t\trendered = { head: '', html: '', css: { code: '', map: null } };\n\t}\n\n\tlet head = '';\n\tlet body = rendered.html;\n\n\tconst csp = new Csp(options.csp, {\n\t\tprerender: !!state.prerendering\n\t});\n\n\t/** @param {string} path */\n\tconst prefixed = (path) => {\n\t\tif (path.startsWith('/')) {\n\t\t\t// Vite makes the start script available through the base path and without it.\n\t\t\t// We load it via the base path in order to support remote IDE environments which proxy\n\t\t\t// all URLs under the base path during development.\n\t\t\treturn paths.base + path;\n\t\t}\n\t\treturn `${assets}/${path}`;\n\t};\n\n\t// inline styles can come from `bundleStrategy: 'inline'` or `inlineStyleThreshold`\n\tconst style = client.inline\n\t\t? client.inline?.style\n\t\t: Array.from(inline_styles.values()).join('\\n');\n\n\tif (style) {\n\t\tconst attributes = DEV ? [' data-sveltekit'] : [];\n\t\tif (csp.style_needs_nonce) attributes.push(` nonce=\"${csp.nonce}\"`);\n\n\t\tcsp.add_style(style);\n\n\t\thead += `\\n\\t<style${attributes.join('')}>${style}</style>`;\n\t}\n\n\tfor (const dep of stylesheets) {\n\t\tconst path = prefixed(dep);\n\n\t\tconst attributes = ['rel=\"stylesheet\"'];\n\n\t\tif (inline_styles.has(dep)) {\n\t\t\t// don't load stylesheets that are already inlined\n\t\t\t// include them in disabled state so that Vite can detect them and doesn't try to add them\n\t\t\tattributes.push('disabled', 'media=\"(max-width: 0)\"');\n\t\t} else {\n\t\t\tif (resolve_opts.preload({ type: 'css', path })) {\n\t\t\t\tlink_headers.add(`<${encodeURI(path)}>; rel=\"preload\"; as=\"style\"; nopush`);\n\t\t\t}\n\t\t}\n\n\t\thead += `\\n\\t\\t<link href=\"${path}\" ${attributes.join(' ')}>`;\n\t}\n\n\tfor (const dep of fonts) {\n\t\tconst path = prefixed(dep);\n\n\t\tif (resolve_opts.preload({ type: 'font', path })) {\n\t\t\tconst ext = dep.slice(dep.lastIndexOf('.') + 1);\n\n\t\t\tlink_tags.add(`<link rel=\"preload\" as=\"font\" type=\"font/${ext}\" href=\"${path}\" crossorigin>`);\n\n\t\t\tlink_headers.add(\n\t\t\t\t`<${encodeURI(path)}>; rel=\"preload\"; as=\"font\"; type=\"font/${ext}\"; crossorigin; nopush`\n\t\t\t);\n\t\t}\n\t}\n\n\tconst global = get_global_name(options);\n\tconst { data, chunks } = data_serializer.get_data(csp);\n\n\tif (page_config.ssr && page_config.csr) {\n\t\tbody += `\\n\\t\\t\\t${fetched\n\t\t\t.map((item) =>\n\t\t\t\tserialize_data(item, resolve_opts.filterSerializedResponseHeaders, !!state.prerendering)\n\t\t\t)\n\t\t\t.join('\\n\\t\\t\\t')}`;\n\t}\n\n\tif (page_config.csr) {\n\t\tconst route = manifest._.client.routes?.find((r) => r.id === event.route.id) ?? null;\n\n\t\tif (client.uses_env_dynamic_public && state.prerendering) {\n\t\t\tmodulepreloads.add(`${paths.app_dir}/env.js`);\n\t\t}\n\n\t\tif (!client.inline) {\n\t\t\tconst included_modulepreloads = Array.from(modulepreloads, (dep) => prefixed(dep)).filter(\n\t\t\t\t(path) => resolve_opts.preload({ type: 'js', path })\n\t\t\t);\n\n\t\t\tfor (const path of included_modulepreloads) {\n\t\t\t\t// see the kit.output.preloadStrategy option for details on why we have multiple options here\n\t\t\t\tlink_headers.add(`<${encodeURI(path)}>; rel=\"modulepreload\"; nopush`);\n\n\t\t\t\tif (options.preload_strategy !== 'modulepreload') {\n\t\t\t\t\thead += `\\n\\t\\t<link rel=\"preload\" as=\"script\" crossorigin=\"anonymous\" href=\"${path}\">`;\n\t\t\t\t} else {\n\t\t\t\t\tlink_tags.add(`<link rel=\"modulepreload\" href=\"${path}\">`);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (state.prerendering && link_tags.size > 0) {\n\t\t\thead += Array.from(link_tags)\n\t\t\t\t.map((tag) => `\\n\\t\\t${tag}`)\n\t\t\t\t.join('');\n\t\t}\n\n\t\t// prerender a `/path/to/page/__route.js` module\n\t\tif (manifest._.client.routes && state.prerendering && !state.prerendering.fallback) {\n\t\t\tconst pathname = add_resolution_suffix(event.url.pathname);\n\n\t\t\tstate.prerendering.dependencies.set(\n\t\t\t\tpathname,\n\t\t\t\tcreate_server_routing_response(route, event.params, new URL(pathname, event.url), manifest)\n\t\t\t);\n\t\t}\n\n\t\tconst blocks = [];\n\n\t\t// when serving a prerendered page in an app that uses $env/dynamic/public, we must\n\t\t// import the env.js module so that it evaluates before any user code can evaluate.\n\t\t// TODO revert to using top-level await once https://bugs.webkit.org/show_bug.cgi?id=242740 is fixed\n\t\t// https://github.com/sveltejs/kit/pull/11601\n\t\tconst load_env_eagerly = client.uses_env_dynamic_public && state.prerendering;\n\n\t\tconst properties = [`base: ${base_expression}`];\n\n\t\tif (paths.assets) {\n\t\t\tproperties.push(`assets: ${s(paths.assets)}`);\n\t\t}\n\n\t\tif (client.uses_env_dynamic_public) {\n\t\t\tproperties.push(`env: ${load_env_eagerly ? 'null' : s(public_env)}`);\n\t\t}\n\n\t\tif (chunks) {\n\t\t\tblocks.push('const deferred = new Map();');\n\n\t\t\tproperties.push(`defer: (id) => new Promise((fulfil, reject) => {\n\t\t\t\t\t\t\tdeferred.set(id, { fulfil, reject });\n\t\t\t\t\t\t})`);\n\n\t\t\tlet app_declaration = '';\n\n\t\t\tif (Object.keys(options.hooks.transport).length > 0) {\n\t\t\t\tif (client.inline) {\n\t\t\t\t\tapp_declaration = `const app = __sveltekit_${options.version_hash}.app.app;`;\n\t\t\t\t} else if (client.app) {\n\t\t\t\t\tapp_declaration = `const app = await import(${s(prefixed(client.app))});`;\n\t\t\t\t} else {\n\t\t\t\t\tapp_declaration = `const { app } = await import(${s(prefixed(client.start))});`;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst prelude = app_declaration\n\t\t\t\t? `${app_declaration}\n\t\t\t\t\t\t\tconst [data, error] = fn(app);`\n\t\t\t\t: `const [data, error] = fn();`;\n\n\t\t\t// When resolving, the id might not yet be available due to the data\n\t\t\t// be evaluated upon init of kit, so we use a timeout to retry\n\t\t\tproperties.push(`resolve: async (id, fn) => {\n\t\t\t\t\t\t\t${prelude}\n\n\t\t\t\t\t\t\tconst try_to_resolve = () => {\n\t\t\t\t\t\t\t\tif (!deferred.has(id)) {\n\t\t\t\t\t\t\t\t\tsetTimeout(try_to_resolve, 0);\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconst { fulfil, reject } = deferred.get(id);\n\t\t\t\t\t\t\t\tdeferred.delete(id);\n\t\t\t\t\t\t\t\tif (error) reject(error);\n\t\t\t\t\t\t\t\telse fulfil(data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\ttry_to_resolve();\n\t\t\t\t\t\t}`);\n\t\t}\n\n\t\t// create this before declaring `data`, which may contain references to `${global}`\n\t\tblocks.push(`${global} = {\n\t\t\t\t\t\t${properties.join(',\\n\\t\\t\\t\\t\\t\\t')}\n\t\t\t\t\t};`);\n\n\t\tconst args = ['element'];\n\n\t\tblocks.push('const element = document.currentScript.parentElement;');\n\n\t\tif (page_config.ssr) {\n\t\t\tconst serialized = { form: 'null', error: 'null' };\n\n\t\t\tif (form_value) {\n\t\t\t\tserialized.form = uneval_action_response(\n\t\t\t\t\tform_value,\n\t\t\t\t\t/** @type {string} */ (event.route.id),\n\t\t\t\t\toptions.hooks.transport\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (error) {\n\t\t\t\tserialized.error = devalue.uneval(error);\n\t\t\t}\n\n\t\t\tconst hydrate = [\n\t\t\t\t`node_ids: [${branch.map(({ node }) => node.index).join(', ')}]`,\n\t\t\t\t`data: ${data}`,\n\t\t\t\t`form: ${serialized.form}`,\n\t\t\t\t`error: ${serialized.error}`\n\t\t\t];\n\n\t\t\tif (status !== 200) {\n\t\t\t\thydrate.push(`status: ${status}`);\n\t\t\t}\n\n\t\t\tif (manifest._.client.routes) {\n\t\t\t\tif (route) {\n\t\t\t\t\tconst stringified = generate_route_object(route, event.url, manifest).replaceAll(\n\t\t\t\t\t\t'\\n',\n\t\t\t\t\t\t'\\n\\t\\t\\t\\t\\t\\t\\t'\n\t\t\t\t\t); // make output after it's put together with the rest more readable\n\t\t\t\t\thydrate.push(`params: ${devalue.uneval(event.params)}`, `server_route: ${stringified}`);\n\t\t\t\t}\n\t\t\t} else if (options.embedded) {\n\t\t\t\thydrate.push(`params: ${devalue.uneval(event.params)}`, `route: ${s(event.route)}`);\n\t\t\t}\n\n\t\t\tconst indent = '\\t'.repeat(load_env_eagerly ? 7 : 6);\n\t\t\targs.push(`{\\n${indent}\\t${hydrate.join(`,\\n${indent}\\t`)}\\n${indent}}`);\n\t\t}\n\n\t\tconst { remote_data: remote_cache } = event_state;\n\n\t\tlet serialized_remote_data = '';\n\n\t\tif (remote_cache) {\n\t\t\t/** @type {Record<string, any>} */\n\t\t\tconst remote = {};\n\n\t\t\tfor (const [info, cache] of remote_cache) {\n\t\t\t\t// remote functions without an `id` aren't exported, and thus\n\t\t\t\t// cannot be called from the client\n\t\t\t\tif (!info.id) continue;\n\n\t\t\t\tfor (const key in cache) {\n\t\t\t\t\tremote[create_remote_key(info.id, key)] = await cache[key];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// TODO this is repeated in a few places — dedupe it\n\t\t\tconst replacer = (/** @type {any} */ thing) => {\n\t\t\t\tfor (const key in options.hooks.transport) {\n\t\t\t\t\tconst encoded = options.hooks.transport[key].encode(thing);\n\t\t\t\t\tif (encoded) {\n\t\t\t\t\t\treturn `app.decode('${key}', ${devalue.uneval(encoded, replacer)})`;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tserialized_remote_data = `${global}.data = ${devalue.uneval(remote, replacer)};\\n\\n\\t\\t\\t\\t\\t\\t`;\n\t\t}\n\n\t\t// `client.app` is a proxy for `bundleStrategy === 'split'`\n\t\tconst boot = client.inline\n\t\t\t? `${client.inline.script}\n\n\t\t\t\t\t${serialized_remote_data}${global}.app.start(${args.join(', ')});`\n\t\t\t: client.app\n\t\t\t\t? `Promise.all([\n\t\t\t\t\t\timport(${s(prefixed(client.start))}),\n\t\t\t\t\t\timport(${s(prefixed(client.app))})\n\t\t\t\t\t]).then(([kit, app]) => {\n\t\t\t\t\t\t${serialized_remote_data}kit.start(app, ${args.join(', ')});\n\t\t\t\t\t});`\n\t\t\t\t: `import(${s(prefixed(client.start))}).then((app) => {\n\t\t\t\t\t\t${serialized_remote_data}app.start(${args.join(', ')})\n\t\t\t\t\t});`;\n\n\t\tif (load_env_eagerly) {\n\t\t\tblocks.push(`import(${s(`${base}/${paths.app_dir}/env.js`)}).then(({ env }) => {\n\t\t\t\t\t\t${global}.env = env;\n\n\t\t\t\t\t\t${boot.replace(/\\n/g, '\\n\\t')}\n\t\t\t\t\t});`);\n\t\t} else {\n\t\t\tblocks.push(boot);\n\t\t}\n\n\t\tif (options.service_worker) {\n\t\t\tlet opts = DEV ? \", { type: 'module' }\" : '';\n\t\t\tif (options.service_worker_options != null) {\n\t\t\t\tconst service_worker_options = { ...options.service_worker_options };\n\t\t\t\tif (DEV) {\n\t\t\t\t\tservice_worker_options.type = 'module';\n\t\t\t\t}\n\t\t\t\topts = `, ${s(service_worker_options)}`;\n\t\t\t}\n\n\t\t\t// we use an anonymous function instead of an arrow function to support\n\t\t\t// older browsers (https://github.com/sveltejs/kit/pull/5417)\n\t\t\tblocks.push(`if ('serviceWorker' in navigator) {\n\t\t\t\t\t\taddEventListener('load', function () {\n\t\t\t\t\t\t\tnavigator.serviceWorker.register('${prefixed('service-worker.js')}'${opts});\n\t\t\t\t\t\t});\n\t\t\t\t\t}`);\n\t\t}\n\n\t\tconst init_app = `\n\t\t\t\t{\n\t\t\t\t\t${blocks.join('\\n\\n\\t\\t\\t\\t\\t')}\n\t\t\t\t}\n\t\t\t`;\n\t\tcsp.add_script(init_app);\n\n\t\tbody += `\\n\\t\\t\\t<script${\n\t\t\tcsp.script_needs_nonce ? ` nonce=\"${csp.nonce}\"` : ''\n\t\t}>${init_app}</script>\\n\\t\\t`;\n\t}\n\n\tconst headers = new Headers({\n\t\t'x-sveltekit-page': 'true',\n\t\t'content-type': 'text/html'\n\t});\n\n\tif (state.prerendering) {\n\t\t// TODO read headers set with setHeaders and convert into http-equiv where possible\n\t\tconst http_equiv = [];\n\n\t\tconst csp_headers = csp.csp_provider.get_meta();\n\t\tif (csp_headers) {\n\t\t\thttp_equiv.push(csp_headers);\n\t\t}\n\n\t\tif (state.prerendering.cache) {\n\t\t\thttp_equiv.push(`<meta http-equiv=\"cache-control\" content=\"${state.prerendering.cache}\">`);\n\t\t}\n\n\t\tif (http_equiv.length > 0) {\n\t\t\thead = http_equiv.join('\\n') + head;\n\t\t}\n\t} else {\n\t\tconst csp_header = csp.csp_provider.get_header();\n\t\tif (csp_header) {\n\t\t\theaders.set('content-security-policy', csp_header);\n\t\t}\n\t\tconst report_only_header = csp.report_only_provider.get_header();\n\t\tif (report_only_header) {\n\t\t\theaders.set('content-security-policy-report-only', report_only_header);\n\t\t}\n\n\t\tif (link_headers.size) {\n\t\t\theaders.set('link', Array.from(link_headers).join(', '));\n\t\t}\n\t}\n\n\t// add the content after the script/css links so the link elements are parsed first\n\thead += rendered.head;\n\n\tconst html = options.templates.app({\n\t\thead,\n\t\tbody,\n\t\tassets,\n\t\tnonce: /** @type {string} */ (csp.nonce),\n\t\tenv: public_env\n\t});\n\n\t// TODO flush chunks as early as we can\n\tconst transformed =\n\t\t(await resolve_opts.transformPageChunk({\n\t\t\thtml,\n\t\t\tdone: true\n\t\t})) || '';\n\n\tif (!chunks) {\n\t\theaders.set('etag', `\"${hash(transformed)}\"`);\n\t}\n\n\tif (DEV) {\n\t\tif (page_config.csr) {\n\t\t\tif (transformed.split('<!--').length < html.split('<!--').length) {\n\t\t\t\t// the \\u001B stuff is ANSI codes, so that we don't need to add a library to the runtime\n\t\t\t\t// https://svelte.dev/playground/1b3f49696f0c44c881c34587f2537aa2?version=4.2.19\n\t\t\t\tconsole.warn(\n\t\t\t\t\t\"\\u001B[1m\\u001B[31mRemoving comments in transformPageChunk can break Svelte's hydration\\u001B[39m\\u001B[22m\"\n\t\t\t\t);\n\t\t\t}\n\t\t} else {\n\t\t\tif (chunks) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t'\\u001B[1m\\u001B[31mReturning promises from server `load` functions will only work if `csr === true`\\u001B[39m\\u001B[22m'\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\treturn !chunks\n\t\t? text(transformed, {\n\t\t\t\tstatus,\n\t\t\t\theaders\n\t\t\t})\n\t\t: new Response(\n\t\t\t\tnew ReadableStream({\n\t\t\t\t\tasync start(controller) {\n\t\t\t\t\t\tcontroller.enqueue(text_encoder.encode(transformed + '\\n'));\n\t\t\t\t\t\tfor await (const chunk of chunks) {\n\t\t\t\t\t\t\tif (chunk.length) controller.enqueue(text_encoder.encode(chunk));\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcontroller.close();\n\t\t\t\t\t},\n\n\t\t\t\t\ttype: 'bytes'\n\t\t\t\t}),\n\t\t\t\t{\n\t\t\t\t\theaders\n\t\t\t\t}\n\t\t\t);\n}\n","import {\n\tvalidate_layout_exports,\n\tvalidate_layout_server_exports,\n\tvalidate_page_exports,\n\tvalidate_page_server_exports\n} from './exports.js';\n\nexport class PageNodes {\n\tdata;\n\n\t/**\n\t * @param {Array<import('types').SSRNode | undefined>} nodes\n\t */\n\tconstructor(nodes) {\n\t\tthis.data = nodes;\n\t}\n\n\tlayouts() {\n\t\treturn this.data.slice(0, -1);\n\t}\n\n\tpage() {\n\t\treturn this.data.at(-1);\n\t}\n\n\tvalidate() {\n\t\tfor (const layout of this.layouts()) {\n\t\t\tif (layout) {\n\t\t\t\tvalidate_layout_server_exports(layout.server, /** @type {string} */ (layout.server_id));\n\t\t\t\tvalidate_layout_exports(layout.universal, /** @type {string} */ (layout.universal_id));\n\t\t\t}\n\t\t}\n\n\t\tconst page = this.page();\n\t\tif (page) {\n\t\t\tvalidate_page_server_exports(page.server, /** @type {string} */ (page.server_id));\n\t\t\tvalidate_page_exports(page.universal, /** @type {string} */ (page.universal_id));\n\t\t}\n\t}\n\n\t/**\n\t * @template {'prerender' | 'ssr' | 'csr' | 'trailingSlash'} Option\n\t * @param {Option} option\n\t * @returns {Value | undefined}\n\t */\n\t#get_option(option) {\n\t\t/** @typedef {(import('types').UniversalNode | import('types').ServerNode)[Option]} Value */\n\n\t\treturn this.data.reduce((value, node) => {\n\t\t\treturn node?.universal?.[option] ?? node?.server?.[option] ?? value;\n\t\t}, /** @type {Value | undefined} */ (undefined));\n\t}\n\n\tcsr() {\n\t\treturn this.#get_option('csr') ?? true;\n\t}\n\n\tssr() {\n\t\treturn this.#get_option('ssr') ?? true;\n\t}\n\n\tprerender() {\n\t\treturn this.#get_option('prerender') ?? false;\n\t}\n\n\ttrailing_slash() {\n\t\treturn this.#get_option('trailingSlash') ?? 'never';\n\t}\n\n\tget_config() {\n\t\t/** @type {any} */\n\t\tlet current = {};\n\n\t\tfor (const node of this.data) {\n\t\t\tif (!node?.universal?.config && !node?.server?.config) continue;\n\n\t\t\tcurrent = {\n\t\t\t\t...current,\n\t\t\t\t// TODO: should we override the server config value with the universal value similar to other page options?\n\t\t\t\t...node?.universal?.config,\n\t\t\t\t...node?.server?.config\n\t\t\t};\n\t\t}\n\n\t\t// TODO 3.0 always return `current`? then we can get rid of `?? {}` in other places\n\t\treturn Object.keys(current).length ? current : undefined;\n\t}\n\n\tshould_prerender_data() {\n\t\treturn this.data.some(\n\t\t\t// prerender in case of trailingSlash because the client retrieves that value from the server\n\t\t\t(node) => node?.server?.load || node?.server?.trailingSlash !== undefined\n\t\t);\n\t}\n}\n","import { Redirect } from '@sveltejs/kit/internal';\nimport { render_response } from './render.js';\nimport { load_data, load_server_data } from './load_data.js';\nimport { handle_error_and_jsonify, static_error_page, redirect_response } from '../utils.js';\nimport { get_status } from '../../../utils/error.js';\nimport { PageNodes } from '../../../utils/page_nodes.js';\nimport { server_data_serializer } from './data_serializer.js';\n\n/**\n * @typedef {import('./types.js').Loaded} Loaded\n */\n\n/**\n * @param {{\n *   event: import('@sveltejs/kit').RequestEvent;\n *   event_state: import('types').RequestState;\n *   options: import('types').SSROptions;\n *   manifest: import('@sveltejs/kit').SSRManifest;\n *   state: import('types').SSRState;\n *   status: number;\n *   error: unknown;\n *   resolve_opts: import('types').RequiredResolveOptions;\n * }} opts\n */\nexport async function respond_with_error({\n\tevent,\n\tevent_state,\n\toptions,\n\tmanifest,\n\tstate,\n\tstatus,\n\terror,\n\tresolve_opts\n}) {\n\t// reroute to the fallback page to prevent an infinite chain of requests.\n\tif (event.request.headers.get('x-sveltekit-error')) {\n\t\treturn static_error_page(options, status, /** @type {Error} */ (error).message);\n\t}\n\n\t/** @type {import('./types.js').Fetched[]} */\n\tconst fetched = [];\n\n\ttry {\n\t\tconst branch = [];\n\t\tconst default_layout = await manifest._.nodes[0](); // 0 is always the root layout\n\t\tconst nodes = new PageNodes([default_layout]);\n\t\tconst ssr = nodes.ssr();\n\t\tconst csr = nodes.csr();\n\t\tconst data_serializer = server_data_serializer(event, event_state, options);\n\n\t\tif (ssr) {\n\t\t\tstate.error = true;\n\n\t\t\tconst server_data_promise = load_server_data({\n\t\t\t\tevent,\n\t\t\t\tevent_state,\n\t\t\t\tstate,\n\t\t\t\tnode: default_layout,\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/require-await\n\t\t\t\tparent: async () => ({})\n\t\t\t});\n\n\t\t\tconst server_data = await server_data_promise;\n\t\t\tdata_serializer.add_node(0, server_data);\n\n\t\t\tconst data = await load_data({\n\t\t\t\tevent,\n\t\t\t\tevent_state,\n\t\t\t\tfetched,\n\t\t\t\tnode: default_layout,\n\t\t\t\t// eslint-disable-next-line @typescript-eslint/require-await\n\t\t\t\tparent: async () => ({}),\n\t\t\t\tresolve_opts,\n\t\t\t\tserver_data_promise,\n\t\t\t\tstate,\n\t\t\t\tcsr\n\t\t\t});\n\n\t\t\tbranch.push(\n\t\t\t\t{\n\t\t\t\t\tnode: default_layout,\n\t\t\t\t\tserver_data,\n\t\t\t\t\tdata\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tnode: await manifest._.nodes[1](), // 1 is always the root error\n\t\t\t\t\tdata: null,\n\t\t\t\t\tserver_data: null\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn await render_response({\n\t\t\toptions,\n\t\t\tmanifest,\n\t\t\tstate,\n\t\t\tpage_config: {\n\t\t\t\tssr,\n\t\t\t\tcsr\n\t\t\t},\n\t\t\tstatus,\n\t\t\terror: await handle_error_and_jsonify(event, event_state, options, error),\n\t\t\tbranch,\n\t\t\tfetched,\n\t\t\tevent,\n\t\t\tevent_state,\n\t\t\tresolve_opts,\n\t\t\tdata_serializer\n\t\t});\n\t} catch (e) {\n\t\t// Edge case: If route is a 404 and the user redirects to somewhere from the root layout,\n\t\t// we end up here.\n\t\tif (e instanceof Redirect) {\n\t\t\treturn redirect_response(e.status, e.location);\n\t\t}\n\n\t\treturn static_error_page(\n\t\t\toptions,\n\t\t\tget_status(e),\n\t\t\t(await handle_error_and_jsonify(event, event_state, options, e)).message\n\t\t);\n\t}\n}\n","/** @import { ActionResult, RemoteForm, RequestEvent, SSRManifest } from '@sveltejs/kit' */\n/** @import { RemoteFunctionResponse, RemoteInfo, RequestState, SSROptions } from 'types' */\n\nimport { json, error } from '@sveltejs/kit';\nimport { HttpError, Redirect, SvelteKitError } from '@sveltejs/kit/internal';\nimport { with_request_store, merge_tracing } from '@sveltejs/kit/internal/server';\nimport { app_dir, base } from '$app/paths/internal/server';\nimport { is_form_content_type } from '../../utils/http.js';\nimport { parse_remote_arg, stringify } from '../shared.js';\nimport { handle_error_and_jsonify } from './utils.js';\nimport { normalize_error } from '../../utils/error.js';\nimport { check_incorrect_fail_use } from './page/actions.js';\nimport { DEV } from 'esm-env';\nimport { record_span } from '../telemetry/record_span.js';\nimport { deserialize_binary_form } from '../form-utils.js';\n\n/** @type {typeof handle_remote_call_internal} */\nexport async function handle_remote_call(event, state, options, manifest, id) {\n\treturn record_span({\n\t\tname: 'sveltekit.remote.call',\n\t\tattributes: {\n\t\t\t'sveltekit.remote.call.id': id\n\t\t},\n\t\tfn: (current) => {\n\t\t\tconst traced_event = merge_tracing(event, current);\n\t\t\treturn with_request_store({ event: traced_event, state }, () =>\n\t\t\t\thandle_remote_call_internal(traced_event, state, options, manifest, id)\n\t\t\t);\n\t\t}\n\t});\n}\n\n/**\n * @param {RequestEvent} event\n * @param {RequestState} state\n * @param {SSROptions} options\n * @param {SSRManifest} manifest\n * @param {string} id\n */\nasync function handle_remote_call_internal(event, state, options, manifest, id) {\n\tconst [hash, name, additional_args] = id.split('/');\n\tconst remotes = manifest._.remotes;\n\n\tif (!remotes[hash]) error(404);\n\n\tconst module = await remotes[hash]();\n\tconst fn = module.default[name];\n\n\tif (!fn) error(404);\n\n\t/** @type {RemoteInfo} */\n\tconst info = fn.__;\n\tconst transport = options.hooks.transport;\n\n\tevent.tracing.current.setAttributes({\n\t\t'sveltekit.remote.call.type': info.type,\n\t\t'sveltekit.remote.call.name': info.name\n\t});\n\n\t/** @type {string[] | undefined} */\n\tlet form_client_refreshes;\n\n\ttry {\n\t\tif (info.type === 'query_batch') {\n\t\t\tif (event.request.method !== 'POST') {\n\t\t\t\tthrow new SvelteKitError(\n\t\t\t\t\t405,\n\t\t\t\t\t'Method Not Allowed',\n\t\t\t\t\t`\\`query.batch\\` functions must be invoked via POST request, not ${event.request.method}`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t/** @type {{ payloads: string[] }} */\n\t\t\tconst { payloads } = await event.request.json();\n\n\t\t\tconst args = payloads.map((payload) => parse_remote_arg(payload, transport));\n\t\t\tconst get_result = await with_request_store({ event, state }, () => info.run(args));\n\t\t\tconst results = await Promise.all(\n\t\t\t\targs.map(async (arg, i) => {\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn { type: 'result', data: get_result(arg, i) };\n\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t\terror: await handle_error_and_jsonify(event, state, options, error),\n\t\t\t\t\t\t\tstatus:\n\t\t\t\t\t\t\t\terror instanceof HttpError || error instanceof SvelteKitError ? error.status : 500\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t);\n\n\t\t\treturn json(\n\t\t\t\t/** @type {RemoteFunctionResponse} */ ({\n\t\t\t\t\ttype: 'result',\n\t\t\t\t\tresult: stringify(results, transport)\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tif (info.type === 'form') {\n\t\t\tif (event.request.method !== 'POST') {\n\t\t\t\tthrow new SvelteKitError(\n\t\t\t\t\t405,\n\t\t\t\t\t'Method Not Allowed',\n\t\t\t\t\t`\\`form\\` functions must be invoked via POST request, not ${event.request.method}`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (!is_form_content_type(event.request)) {\n\t\t\t\tthrow new SvelteKitError(\n\t\t\t\t\t415,\n\t\t\t\t\t'Unsupported Media Type',\n\t\t\t\t\t`\\`form\\` functions expect form-encoded data — received ${event.request.headers.get(\n\t\t\t\t\t\t'content-type'\n\t\t\t\t\t)}`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst { data, meta, form_data } = await deserialize_binary_form(event.request);\n\n\t\t\t// If this is a keyed form instance (created via form.for(key)), add the key to the form data (unless already set)\n\t\t\t// Note that additional_args will only be set if the form is not enhanced, as enhanced forms transfer the key inside `data`.\n\t\t\tif (additional_args && !('id' in data)) {\n\t\t\t\tdata.id = JSON.parse(decodeURIComponent(additional_args));\n\t\t\t}\n\n\t\t\tconst fn = info.fn;\n\t\t\tconst result = await with_request_store({ event, state }, () => fn(data, meta, form_data));\n\n\t\t\treturn json(\n\t\t\t\t/** @type {RemoteFunctionResponse} */ ({\n\t\t\t\t\ttype: 'result',\n\t\t\t\t\tresult: stringify(result, transport),\n\t\t\t\t\trefreshes: result.issues ? undefined : await serialize_refreshes(meta.remote_refreshes)\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tif (info.type === 'command') {\n\t\t\t/** @type {{ payload: string, refreshes: string[] }} */\n\t\t\tconst { payload, refreshes } = await event.request.json();\n\t\t\tconst arg = parse_remote_arg(payload, transport);\n\t\t\tconst data = await with_request_store({ event, state }, () => fn(arg));\n\n\t\t\treturn json(\n\t\t\t\t/** @type {RemoteFunctionResponse} */ ({\n\t\t\t\t\ttype: 'result',\n\t\t\t\t\tresult: stringify(data, transport),\n\t\t\t\t\trefreshes: await serialize_refreshes(refreshes)\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tconst payload =\n\t\t\tinfo.type === 'prerender'\n\t\t\t\t? additional_args\n\t\t\t\t: /** @type {string} */ (\n\t\t\t\t\t\t// new URL(...) necessary because we're hiding the URL from the user in the event object\n\t\t\t\t\t\tnew URL(event.request.url).searchParams.get('payload')\n\t\t\t\t\t);\n\n\t\tconst data = await with_request_store({ event, state }, () =>\n\t\t\tfn(parse_remote_arg(payload, transport))\n\t\t);\n\n\t\treturn json(\n\t\t\t/** @type {RemoteFunctionResponse} */ ({\n\t\t\t\ttype: 'result',\n\t\t\t\tresult: stringify(data, transport)\n\t\t\t})\n\t\t);\n\t} catch (error) {\n\t\tif (error instanceof Redirect) {\n\t\t\treturn json(\n\t\t\t\t/** @type {RemoteFunctionResponse} */ ({\n\t\t\t\t\ttype: 'redirect',\n\t\t\t\t\tlocation: error.location,\n\t\t\t\t\trefreshes: await serialize_refreshes(form_client_refreshes)\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tconst status =\n\t\t\terror instanceof HttpError || error instanceof SvelteKitError ? error.status : 500;\n\n\t\treturn json(\n\t\t\t/** @type {RemoteFunctionResponse} */ ({\n\t\t\t\ttype: 'error',\n\t\t\t\terror: await handle_error_and_jsonify(event, state, options, error),\n\t\t\t\tstatus\n\t\t\t}),\n\t\t\t{\n\t\t\t\t// By setting a non-200 during prerendering we fail the prerender process (unless handleHttpError handles it).\n\t\t\t\t// Errors at runtime will be passed to the client and are handled there\n\t\t\t\tstatus: state.prerendering ? status : undefined,\n\t\t\t\theaders: {\n\t\t\t\t\t'cache-control': 'private, no-store'\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n\n\t/**\n\t * @param {string[]=} client_refreshes\n\t */\n\tasync function serialize_refreshes(client_refreshes) {\n\t\tconst refreshes = state.refreshes ?? {};\n\n\t\tif (client_refreshes) {\n\t\t\tfor (const key of client_refreshes) {\n\t\t\t\tif (refreshes[key] !== undefined) continue;\n\n\t\t\t\tconst [hash, name, payload] = key.split('/');\n\n\t\t\t\tconst loader = manifest._.remotes[hash];\n\t\t\t\tconst fn = (await loader?.())?.default?.[name];\n\n\t\t\t\tif (!fn) error(400, 'Bad Request');\n\n\t\t\t\trefreshes[key] = with_request_store({ event, state }, () =>\n\t\t\t\t\tfn(parse_remote_arg(payload, transport))\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (Object.keys(refreshes).length === 0) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\treturn stringify(\n\t\t\tObject.fromEntries(\n\t\t\t\tawait Promise.all(\n\t\t\t\t\tObject.entries(refreshes).map(async ([key, promise]) => [key, await promise])\n\t\t\t\t)\n\t\t\t),\n\t\t\ttransport\n\t\t);\n\t}\n}\n\n/** @type {typeof handle_remote_form_post_internal} */\nexport async function handle_remote_form_post(event, state, manifest, id) {\n\treturn record_span({\n\t\tname: 'sveltekit.remote.form.post',\n\t\tattributes: {\n\t\t\t'sveltekit.remote.form.post.id': id\n\t\t},\n\t\tfn: (current) => {\n\t\t\tconst traced_event = merge_tracing(event, current);\n\t\t\treturn with_request_store({ event: traced_event, state }, () =>\n\t\t\t\thandle_remote_form_post_internal(traced_event, state, manifest, id)\n\t\t\t);\n\t\t}\n\t});\n}\n\n/**\n * @param {RequestEvent} event\n * @param {RequestState} state\n * @param {SSRManifest} manifest\n * @param {string} id\n * @returns {Promise<ActionResult>}\n */\nasync function handle_remote_form_post_internal(event, state, manifest, id) {\n\tconst [hash, name, action_id] = id.split('/');\n\tconst remotes = manifest._.remotes;\n\tconst module = await remotes[hash]?.();\n\n\tlet form = /** @type {RemoteForm<any, any>} */ (module?.default[name]);\n\n\tif (!form) {\n\t\tevent.setHeaders({\n\t\t\t// https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/405\n\t\t\t// \"The server must generate an Allow header field in a 405 status code response\"\n\t\t\tallow: 'GET'\n\t\t});\n\t\treturn {\n\t\t\ttype: 'error',\n\t\t\terror: new SvelteKitError(\n\t\t\t\t405,\n\t\t\t\t'Method Not Allowed',\n\t\t\t\t`POST method not allowed. No form actions exist for ${DEV ? `the page at ${event.route.id}` : 'this page'}`\n\t\t\t)\n\t\t};\n\t}\n\n\tif (action_id) {\n\t\t// @ts-expect-error\n\t\tform = with_request_store({ event, state }, () => form.for(JSON.parse(action_id)));\n\t}\n\n\ttry {\n\t\tconst fn = /** @type {RemoteInfo & { type: 'form' }} */ (/** @type {any} */ (form).__).fn;\n\n\t\tconst { data, meta, form_data } = await deserialize_binary_form(event.request);\n\t\tif (action_id && !('id' in data)) {\n\t\t\tdata.id = JSON.parse(decodeURIComponent(action_id));\n\t\t}\n\n\t\tawait with_request_store({ event, state }, () => fn(data, meta, form_data));\n\n\t\t// We don't want the data to appear on `let { form } = $props()`, which is why we're not returning it.\n\t\t// It is instead available on `myForm.result`, setting of which happens within the remote `form` function.\n\t\treturn {\n\t\t\ttype: 'success',\n\t\t\tstatus: 200\n\t\t};\n\t} catch (e) {\n\t\tconst err = normalize_error(e);\n\n\t\tif (err instanceof Redirect) {\n\t\t\treturn {\n\t\t\t\ttype: 'redirect',\n\t\t\t\tstatus: err.status,\n\t\t\t\tlocation: err.location\n\t\t\t};\n\t\t}\n\n\t\treturn {\n\t\t\ttype: 'error',\n\t\t\terror: check_incorrect_fail_use(err)\n\t\t};\n\t}\n}\n\n/**\n * @param {URL} url\n */\nexport function get_remote_id(url) {\n\treturn (\n\t\turl.pathname.startsWith(`${base}/${app_dir}/remote/`) &&\n\t\turl.pathname.replace(`${base}/${app_dir}/remote/`, '')\n\t);\n}\n\n/**\n * @param {URL} url\n */\nexport function get_remote_action(url) {\n\treturn url.searchParams.get('/remote');\n}\n","import { text } from '@sveltejs/kit';\nimport { Redirect } from '@sveltejs/kit/internal';\nimport { compact } from '../../../utils/array.js';\nimport { get_status, normalize_error } from '../../../utils/error.js';\nimport { add_data_suffix } from '../../pathname.js';\nimport { redirect_response, static_error_page, handle_error_and_jsonify } from '../utils.js';\nimport {\n\thandle_action_json_request,\n\thandle_action_request,\n\tis_action_json_request,\n\tis_action_request\n} from './actions.js';\nimport { server_data_serializer, server_data_serializer_json } from './data_serializer.js';\nimport { load_data, load_server_data } from './load_data.js';\nimport { render_response } from './render.js';\nimport { respond_with_error } from './respond_with_error.js';\nimport { DEV } from 'esm-env';\nimport { get_remote_action, handle_remote_form_post } from '../remote.js';\nimport { PageNodes } from '../../../utils/page_nodes.js';\n\n/**\n * The maximum request depth permitted before assuming we're stuck in an infinite loop\n */\nconst MAX_DEPTH = 10;\n\n/**\n * @param {import('@sveltejs/kit').RequestEvent} event\n * @param {import('types').RequestState} event_state\n * @param {import('types').PageNodeIndexes} page\n * @param {import('types').SSROptions} options\n * @param {import('@sveltejs/kit').SSRManifest} manifest\n * @param {import('types').SSRState} state\n * @param {import('../../../utils/page_nodes.js').PageNodes} nodes\n * @param {import('types').RequiredResolveOptions} resolve_opts\n * @returns {Promise<Response>}\n */\nexport async function render_page(\n\tevent,\n\tevent_state,\n\tpage,\n\toptions,\n\tmanifest,\n\tstate,\n\tnodes,\n\tresolve_opts\n) {\n\tif (state.depth > MAX_DEPTH) {\n\t\t// infinite request cycle detected\n\t\treturn text(`Not found: ${event.url.pathname}`, {\n\t\t\tstatus: 404 // TODO in some cases this should be 500. not sure how to differentiate\n\t\t});\n\t}\n\n\tif (is_action_json_request(event)) {\n\t\tconst node = await manifest._.nodes[page.leaf]();\n\t\treturn handle_action_json_request(event, event_state, options, node?.server);\n\t}\n\n\ttry {\n\t\tconst leaf_node = /** @type {import('types').SSRNode} */ (nodes.page());\n\n\t\tlet status = 200;\n\n\t\t/** @type {import('@sveltejs/kit').ActionResult | undefined} */\n\t\tlet action_result = undefined;\n\n\t\tif (is_action_request(event)) {\n\t\t\tconst remote_id = get_remote_action(event.url);\n\t\t\tif (remote_id) {\n\t\t\t\taction_result = await handle_remote_form_post(event, event_state, manifest, remote_id);\n\t\t\t} else {\n\t\t\t\t// for action requests, first call handler in +page.server.js\n\t\t\t\t// (this also determines status code)\n\t\t\t\taction_result = await handle_action_request(event, event_state, leaf_node.server);\n\t\t\t}\n\n\t\t\tif (action_result?.type === 'redirect') {\n\t\t\t\treturn redirect_response(action_result.status, action_result.location);\n\t\t\t}\n\t\t\tif (action_result?.type === 'error') {\n\t\t\t\tstatus = get_status(action_result.error);\n\t\t\t}\n\t\t\tif (action_result?.type === 'failure') {\n\t\t\t\tstatus = action_result.status;\n\t\t\t}\n\t\t}\n\n\t\t// it's crucial that we do this before returning the non-SSR response, otherwise\n\t\t// SvelteKit will erroneously believe that the path has been prerendered,\n\t\t// causing functions to be omitted from the manifest generated later\n\t\tconst should_prerender = nodes.prerender();\n\t\tif (should_prerender) {\n\t\t\tconst mod = leaf_node.server;\n\t\t\tif (mod?.actions) {\n\t\t\t\tthrow new Error('Cannot prerender pages with actions');\n\t\t\t}\n\t\t} else if (state.prerendering) {\n\t\t\t// if the page isn't marked as prerenderable, then bail out at this point\n\t\t\treturn new Response(undefined, {\n\t\t\t\tstatus: 204\n\t\t\t});\n\t\t}\n\n\t\t// if we fetch any endpoints while loading data for this page, they should\n\t\t// inherit the prerender option of the page\n\t\tstate.prerender_default = should_prerender;\n\n\t\tconst should_prerender_data = nodes.should_prerender_data();\n\t\tconst data_pathname = add_data_suffix(event.url.pathname);\n\n\t\t/** @type {import('./types.js').Fetched[]} */\n\t\tconst fetched = [];\n\n\t\tconst ssr = nodes.ssr();\n\t\tconst csr = nodes.csr();\n\n\t\t// renders an empty 'shell' page if SSR is turned off and if there is\n\t\t// no server data to prerender. As a result, the load functions and rendering\n\t\t// only occur client-side.\n\t\tif (ssr === false && !(state.prerendering && should_prerender_data)) {\n\t\t\t// if the user makes a request through a non-enhanced form, the returned value is lost\n\t\t\t// because there is no SSR or client-side handling of the response\n\t\t\tif (DEV && action_result && !event.request.headers.has('x-sveltekit-action')) {\n\t\t\t\tif (action_result.type === 'error') {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\"The form action returned an error, but +error.svelte wasn't rendered because SSR is off. To get the error page with CSR, enhance your form with `use:enhance`. See https://svelte.dev/docs/kit/form-actions#progressive-enhancement-use-enhance\"\n\t\t\t\t\t);\n\t\t\t\t} else if (action_result.data) {\n\t\t\t\t\t/// case: lost data\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\"The form action returned a value, but it isn't available in `page.form`, because SSR is off. To handle the returned value in CSR, enhance your form with `use:enhance`. See https://svelte.dev/docs/kit/form-actions#progressive-enhancement-use-enhance\"\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn await render_response({\n\t\t\t\tbranch: [],\n\t\t\t\tfetched,\n\t\t\t\tpage_config: {\n\t\t\t\t\tssr: false,\n\t\t\t\t\tcsr\n\t\t\t\t},\n\t\t\t\tstatus,\n\t\t\t\terror: null,\n\t\t\t\tevent,\n\t\t\t\tevent_state,\n\t\t\t\toptions,\n\t\t\t\tmanifest,\n\t\t\t\tstate,\n\t\t\t\tresolve_opts,\n\t\t\t\tdata_serializer: server_data_serializer(event, event_state, options)\n\t\t\t});\n\t\t}\n\n\t\t/** @type {Array<import('./types.js').Loaded | null>} */\n\t\tconst branch = [];\n\n\t\t/** @type {Error | null} */\n\t\tlet load_error = null;\n\n\t\tconst data_serializer = server_data_serializer(event, event_state, options);\n\t\tconst data_serializer_json =\n\t\t\tstate.prerendering && should_prerender_data\n\t\t\t\t? server_data_serializer_json(event, event_state, options)\n\t\t\t\t: null;\n\n\t\t/** @type {Array<Promise<import('types').ServerDataNode | null>>} */\n\t\tconst server_promises = nodes.data.map((node, i) => {\n\t\t\tif (load_error) {\n\t\t\t\t// if an error happens immediately, don't bother with the rest of the nodes\n\t\t\t\tthrow load_error;\n\t\t\t}\n\n\t\t\treturn Promise.resolve().then(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tif (node === leaf_node && action_result?.type === 'error') {\n\t\t\t\t\t\t// we wait until here to throw the error so that we can use\n\t\t\t\t\t\t// any nested +error.svelte components that were defined\n\t\t\t\t\t\tthrow action_result.error;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst server_data = await load_server_data({\n\t\t\t\t\t\tevent,\n\t\t\t\t\t\tevent_state,\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tnode,\n\t\t\t\t\t\tparent: async () => {\n\t\t\t\t\t\t\t/** @type {Record<string, any>} */\n\t\t\t\t\t\t\tconst data = {};\n\t\t\t\t\t\t\tfor (let j = 0; j < i; j += 1) {\n\t\t\t\t\t\t\t\tconst parent = await server_promises[j];\n\t\t\t\t\t\t\t\tif (parent) Object.assign(data, parent.data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn data;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\tdata_serializer.add_node(i, server_data);\n\t\t\t\t\t}\n\n\t\t\t\t\tdata_serializer_json?.add_node(i, server_data);\n\n\t\t\t\t\treturn server_data;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tload_error = /** @type {Error} */ (e);\n\t\t\t\t\tthrow load_error;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t/** @type {Array<Promise<Record<string, any> | null>>} */\n\t\tconst load_promises = nodes.data.map((node, i) => {\n\t\t\tif (load_error) throw load_error;\n\t\t\treturn Promise.resolve().then(async () => {\n\t\t\t\ttry {\n\t\t\t\t\treturn await load_data({\n\t\t\t\t\t\tevent,\n\t\t\t\t\t\tevent_state,\n\t\t\t\t\t\tfetched,\n\t\t\t\t\t\tnode,\n\t\t\t\t\t\tparent: async () => {\n\t\t\t\t\t\t\tconst data = {};\n\t\t\t\t\t\t\tfor (let j = 0; j < i; j += 1) {\n\t\t\t\t\t\t\t\tObject.assign(data, await load_promises[j]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn data;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tresolve_opts,\n\t\t\t\t\t\tserver_data_promise: server_promises[i],\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tcsr\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tload_error = /** @type {Error} */ (e);\n\t\t\t\t\tthrow load_error;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// if we don't do this, rejections will be unhandled\n\t\tfor (const p of server_promises) p.catch(() => {});\n\t\tfor (const p of load_promises) p.catch(() => {});\n\n\t\tfor (let i = 0; i < nodes.data.length; i += 1) {\n\t\t\tconst node = nodes.data[i];\n\n\t\t\tif (node) {\n\t\t\t\ttry {\n\t\t\t\t\tconst server_data = await server_promises[i];\n\t\t\t\t\tconst data = await load_promises[i];\n\n\t\t\t\t\tbranch.push({ node, server_data, data });\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconst err = normalize_error(e);\n\n\t\t\t\t\tif (err instanceof Redirect) {\n\t\t\t\t\t\tif (state.prerendering && should_prerender_data) {\n\t\t\t\t\t\t\tconst body = JSON.stringify({\n\t\t\t\t\t\t\t\ttype: 'redirect',\n\t\t\t\t\t\t\t\tlocation: err.location\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tstate.prerendering.dependencies.set(data_pathname, {\n\t\t\t\t\t\t\t\tresponse: text(body),\n\t\t\t\t\t\t\t\tbody\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn redirect_response(err.status, err.location);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst status = get_status(err);\n\t\t\t\t\tconst error = await handle_error_and_jsonify(event, event_state, options, err);\n\n\t\t\t\t\twhile (i--) {\n\t\t\t\t\t\tif (page.errors[i]) {\n\t\t\t\t\t\t\tconst index = /** @type {number} */ (page.errors[i]);\n\t\t\t\t\t\t\tconst node = await manifest._.nodes[index]();\n\n\t\t\t\t\t\t\tlet j = i;\n\t\t\t\t\t\t\twhile (!branch[j]) j -= 1;\n\n\t\t\t\t\t\t\tdata_serializer.set_max_nodes(j + 1);\n\n\t\t\t\t\t\t\tconst layouts = compact(branch.slice(0, j + 1));\n\t\t\t\t\t\t\tconst nodes = new PageNodes(layouts.map((layout) => layout.node));\n\n\t\t\t\t\t\t\treturn await render_response({\n\t\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\t\tevent_state,\n\t\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\t\tmanifest,\n\t\t\t\t\t\t\t\tstate,\n\t\t\t\t\t\t\t\tresolve_opts,\n\t\t\t\t\t\t\t\tpage_config: {\n\t\t\t\t\t\t\t\t\tssr: nodes.ssr(),\n\t\t\t\t\t\t\t\t\tcsr: nodes.csr()\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tstatus,\n\t\t\t\t\t\t\t\terror,\n\t\t\t\t\t\t\t\tbranch: layouts.concat({\n\t\t\t\t\t\t\t\t\tnode,\n\t\t\t\t\t\t\t\t\tdata: null,\n\t\t\t\t\t\t\t\t\tserver_data: null\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\tfetched,\n\t\t\t\t\t\t\t\tdata_serializer\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// if we're still here, it means the error happened in the root layout,\n\t\t\t\t\t// which means we have to fall back to error.html\n\t\t\t\t\treturn static_error_page(options, status, error.message);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// push an empty slot so we can rewind past gaps to the\n\t\t\t\t// layout that corresponds with an +error.svelte page\n\t\t\t\tbranch.push(null);\n\t\t\t}\n\t\t}\n\n\t\tif (state.prerendering && data_serializer_json) {\n\t\t\t// ndjson format\n\t\t\tlet { data, chunks } = data_serializer_json.get_data();\n\n\t\t\tif (chunks) {\n\t\t\t\tfor await (const chunk of chunks) {\n\t\t\t\t\tdata += chunk;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tstate.prerendering.dependencies.set(data_pathname, {\n\t\t\t\tresponse: text(data),\n\t\t\t\tbody: data\n\t\t\t});\n\t\t}\n\n\t\treturn await render_response({\n\t\t\tevent,\n\t\t\tevent_state,\n\t\t\toptions,\n\t\t\tmanifest,\n\t\t\tstate,\n\t\t\tresolve_opts,\n\t\t\tpage_config: {\n\t\t\t\tcsr,\n\t\t\t\tssr\n\t\t\t},\n\t\t\tstatus,\n\t\t\terror: null,\n\t\t\tbranch: ssr === false ? [] : compact(branch),\n\t\t\taction_result,\n\t\t\tfetched,\n\t\t\tdata_serializer:\n\t\t\t\tssr === false ? server_data_serializer(event, event_state, options) : data_serializer\n\t\t});\n\t} catch (e) {\n\t\t// if we end up here, it means the data loaded successfully\n\t\t// but the page failed to render, or that a prerendering error occurred\n\t\treturn await respond_with_error({\n\t\t\tevent,\n\t\t\tevent_state,\n\t\t\toptions,\n\t\t\tmanifest,\n\t\t\tstate,\n\t\t\tstatus: 500,\n\t\t\terror: e,\n\t\t\tresolve_opts\n\t\t});\n\t}\n}\n","/**\n * @template T\n * @param {() => T} fn\n */\nexport function once(fn) {\n\tlet done = false;\n\n\t/** @type T */\n\tlet result;\n\n\treturn () => {\n\t\tif (done) return result;\n\t\tdone = true;\n\t\treturn (result = fn());\n\t};\n}\n","import { text } from '@sveltejs/kit';\nimport { HttpError, SvelteKitError, Redirect } from '@sveltejs/kit/internal';\nimport { normalize_error } from '../../../utils/error.js';\nimport { once } from '../../../utils/functions.js';\nimport { server_data_serializer_json } from '../page/data_serializer.js';\nimport { load_server_data } from '../page/load_data.js';\nimport { handle_error_and_jsonify } from '../utils.js';\nimport { normalize_path } from '../../../utils/url.js';\nimport { text_encoder } from '../../utils.js';\n\n/**\n * @param {import('@sveltejs/kit').RequestEvent} event\n * @param {import('types').RequestState} event_state\n * @param {import('types').SSRRoute} route\n * @param {import('types').SSROptions} options\n * @param {import('@sveltejs/kit').SSRManifest} manifest\n * @param {import('types').SSRState} state\n * @param {boolean[] | undefined} invalidated_data_nodes\n * @param {import('types').TrailingSlash} trailing_slash\n * @returns {Promise<Response>}\n */\nexport async function render_data(\n\tevent,\n\tevent_state,\n\troute,\n\toptions,\n\tmanifest,\n\tstate,\n\tinvalidated_data_nodes,\n\ttrailing_slash\n) {\n\tif (!route.page) {\n\t\t// requesting /__data.json should fail for a +server.js\n\t\treturn new Response(undefined, {\n\t\t\tstatus: 404\n\t\t});\n\t}\n\n\ttry {\n\t\tconst node_ids = [...route.page.layouts, route.page.leaf];\n\t\tconst invalidated = invalidated_data_nodes ?? node_ids.map(() => true);\n\n\t\tlet aborted = false;\n\n\t\tconst url = new URL(event.url);\n\t\turl.pathname = normalize_path(url.pathname, trailing_slash);\n\n\t\tconst new_event = { ...event, url };\n\n\t\tconst functions = node_ids.map((n, i) => {\n\t\t\treturn once(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tif (aborted) {\n\t\t\t\t\t\treturn /** @type {import('types').ServerDataSkippedNode} */ ({\n\t\t\t\t\t\t\ttype: 'skip'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// == because it could be undefined (in dev) or null (in build, because of JSON.stringify)\n\t\t\t\t\tconst node = n == undefined ? n : await manifest._.nodes[n]();\n\t\t\t\t\t// load this. for the child, return as is. for the final result, stream things\n\t\t\t\t\treturn load_server_data({\n\t\t\t\t\t\tevent: new_event,\n\t\t\t\t\t\tevent_state,\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tnode,\n\t\t\t\t\t\tparent: async () => {\n\t\t\t\t\t\t\t/** @type {Record<string, any>} */\n\t\t\t\t\t\t\tconst data = {};\n\t\t\t\t\t\t\tfor (let j = 0; j < i; j += 1) {\n\t\t\t\t\t\t\t\tconst parent = /** @type {import('types').ServerDataNode | null} */ (\n\t\t\t\t\t\t\t\t\tawait functions[j]()\n\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\tif (parent) {\n\t\t\t\t\t\t\t\t\tObject.assign(data, parent.data);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn data;\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\taborted = true;\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tconst promises = functions.map(async (fn, i) => {\n\t\t\tif (!invalidated[i]) {\n\t\t\t\treturn /** @type {import('types').ServerDataSkippedNode} */ ({\n\t\t\t\t\ttype: 'skip'\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn fn();\n\t\t});\n\n\t\tlet length = promises.length;\n\t\tconst nodes = await Promise.all(\n\t\t\tpromises.map((p, i) =>\n\t\t\t\tp.catch(async (error) => {\n\t\t\t\t\tif (error instanceof Redirect) {\n\t\t\t\t\t\tthrow error;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Math.min because array isn't guaranteed to resolve in order\n\t\t\t\t\tlength = Math.min(length, i + 1);\n\n\t\t\t\t\treturn /** @type {import('types').ServerErrorNode} */ ({\n\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\terror: await handle_error_and_jsonify(event, event_state, options, error),\n\t\t\t\t\t\tstatus:\n\t\t\t\t\t\t\terror instanceof HttpError || error instanceof SvelteKitError\n\t\t\t\t\t\t\t\t? error.status\n\t\t\t\t\t\t\t\t: undefined\n\t\t\t\t\t});\n\t\t\t\t})\n\t\t\t)\n\t\t);\n\n\t\tconst data_serializer = server_data_serializer_json(event, event_state, options);\n\t\tfor (let i = 0; i < nodes.length; i++) data_serializer.add_node(i, nodes[i]);\n\t\tconst { data, chunks } = data_serializer.get_data();\n\n\t\tif (!chunks) {\n\t\t\t// use a normal JSON response where possible, so we get `content-length`\n\t\t\t// and can use browser JSON devtools for easier inspecting\n\t\t\treturn json_response(data);\n\t\t}\n\n\t\treturn new Response(\n\t\t\tnew ReadableStream({\n\t\t\t\tasync start(controller) {\n\t\t\t\t\tcontroller.enqueue(text_encoder.encode(data));\n\t\t\t\t\tfor await (const chunk of chunks) {\n\t\t\t\t\t\tcontroller.enqueue(text_encoder.encode(chunk));\n\t\t\t\t\t}\n\t\t\t\t\tcontroller.close();\n\t\t\t\t},\n\n\t\t\t\ttype: 'bytes'\n\t\t\t}),\n\t\t\t{\n\t\t\t\theaders: {\n\t\t\t\t\t// we use a proprietary content type to prevent buffering.\n\t\t\t\t\t// the `text` prefix makes it inspectable\n\t\t\t\t\t'content-type': 'text/sveltekit-data',\n\t\t\t\t\t'cache-control': 'private, no-store'\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t} catch (e) {\n\t\tconst error = normalize_error(e);\n\n\t\tif (error instanceof Redirect) {\n\t\t\treturn redirect_json_response(error);\n\t\t} else {\n\t\t\treturn json_response(await handle_error_and_jsonify(event, event_state, options, error), 500);\n\t\t}\n\t}\n}\n\n/**\n * @param {Record<string, any> | string} json\n * @param {number} [status]\n */\nfunction json_response(json, status = 200) {\n\treturn text(typeof json === 'string' ? json : JSON.stringify(json), {\n\t\tstatus,\n\t\theaders: {\n\t\t\t'content-type': 'application/json',\n\t\t\t'cache-control': 'private, no-store'\n\t\t}\n\t});\n}\n\n/**\n * @param {Redirect} redirect\n */\nexport function redirect_json_response(redirect) {\n\treturn json_response(\n\t\t/** @type {import('types').ServerRedirectNode} */ ({\n\t\t\ttype: 'redirect',\n\t\t\tlocation: redirect.location\n\t\t})\n\t);\n}\n","import { parse, serialize } from 'cookie';\nimport { DEV } from 'esm-env';\nimport { normalize_path, resolve } from '../../utils/url.js';\nimport { add_data_suffix } from '../pathname.js';\nimport { text_encoder } from '../utils.js';\n\n// eslint-disable-next-line no-control-regex -- control characters are invalid in cookie names\nconst INVALID_COOKIE_CHARACTER_REGEX = /[\\x00-\\x1F\\x7F()<>@,;:\"/[\\]?={} \\t]/;\n\n/**\n * Tracks all cookies set during dev mode so we can emit warnings\n * when we detect that there's likely cookie misusage due to wrong paths\n *\n * @type {Record<string, Set<string>>} */\nconst cookie_paths = {};\n\n/**\n * Cookies that are larger than this size (including the name and other\n * attributes) are discarded by browsers\n */\nconst MAX_COOKIE_SIZE = 4129;\n\n// TODO 3.0 remove this check\n/** @param {import('./page/types.js').Cookie['options']} options */\nfunction validate_options(options) {\n\tif (options?.path === undefined) {\n\t\tthrow new Error('You must specify a `path` when setting, deleting or serializing cookies');\n\t}\n}\n\n/**\n * Generates a unique key for a cookie based on its domain, path, and name in\n * the format: `<domain>/<path>?<name>`.\n * If domain is undefined, it will be omitted.\n * For example: `/?name`, `example.com/foo?name`.\n *\n * @param {string | undefined} domain\n * @param {string} path\n * @param {string} name\n * @returns {string}\n */\nfunction generate_cookie_key(domain, path, name) {\n\treturn `${domain || ''}${path}?${encodeURIComponent(name)}`;\n}\n\n/**\n * @param {Request} request\n * @param {URL} url\n */\nexport function get_cookies(request, url) {\n\tconst header = request.headers.get('cookie') ?? '';\n\tconst initial_cookies = parse(header, { decode: (value) => value });\n\n\t/** @type {string | undefined} */\n\tlet normalized_url;\n\n\t/** @type {Map<string, import('./page/types.js').Cookie>} */\n\tconst new_cookies = new Map();\n\n\t/** @type {import('cookie').CookieSerializeOptions} */\n\tconst defaults = {\n\t\thttpOnly: true,\n\t\tsameSite: 'lax',\n\t\tsecure: url.hostname === 'localhost' && url.protocol === 'http:' ? false : true\n\t};\n\n\t/** @type {import('@sveltejs/kit').Cookies} */\n\tconst cookies = {\n\t\t// The JSDoc param annotations appearing below for get, set and delete\n\t\t// are necessary to expose the `cookie` library types to\n\t\t// typescript users. `@type {import('@sveltejs/kit').Cookies}` above is not\n\t\t// sufficient to do so.\n\n\t\t/**\n\t\t * @param {string} name\n\t\t * @param {import('cookie').CookieParseOptions} [opts]\n\t\t */\n\t\tget(name, opts) {\n\t\t\t// Look for the most specific matching cookie from new_cookies\n\t\t\tconst best_match = Array.from(new_cookies.values())\n\t\t\t\t.filter((c) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\tc.name === name &&\n\t\t\t\t\t\tdomain_matches(url.hostname, c.options.domain) &&\n\t\t\t\t\t\tpath_matches(url.pathname, c.options.path)\n\t\t\t\t\t);\n\t\t\t\t})\n\t\t\t\t.sort((a, b) => b.options.path.length - a.options.path.length)[0];\n\n\t\t\tif (best_match) {\n\t\t\t\treturn best_match.options.maxAge === 0 ? undefined : best_match.value;\n\t\t\t}\n\n\t\t\tconst req_cookies = parse(header, { decode: opts?.decode });\n\t\t\tconst cookie = req_cookies[name]; // the decoded string or undefined\n\n\t\t\t// in development, if the cookie was set during this session with `cookies.set`,\n\t\t\t// but at a different path, warn the user. (ignore cookies from request headers,\n\t\t\t// since we don't know which path they were set at)\n\t\t\tif (DEV && !cookie) {\n\t\t\t\tconst paths = Array.from(cookie_paths[name] ?? []).filter((path) => {\n\t\t\t\t\t// we only care about paths that are _more_ specific than the current path\n\t\t\t\t\treturn path_matches(path, url.pathname) && path !== url.pathname;\n\t\t\t\t});\n\n\t\t\t\tif (paths.length > 0) {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t// prettier-ignore\n\t\t\t\t\t\t`'${name}' cookie does not exist for ${url.pathname}, but was previously set at ${conjoin([...paths])}. Did you mean to set its 'path' to '/' instead?`\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn cookie;\n\t\t},\n\n\t\t/**\n\t\t * @param {import('cookie').CookieParseOptions} [opts]\n\t\t */\n\t\tgetAll(opts) {\n\t\t\tconst cookies = parse(header, { decode: opts?.decode });\n\n\t\t\t// Group cookies by name and find the most specific one for each name\n\t\t\tconst lookup = new Map();\n\n\t\t\tfor (const c of new_cookies.values()) {\n\t\t\t\tif (\n\t\t\t\t\tdomain_matches(url.hostname, c.options.domain) &&\n\t\t\t\t\tpath_matches(url.pathname, c.options.path)\n\t\t\t\t) {\n\t\t\t\t\tconst existing = lookup.get(c.name);\n\n\t\t\t\t\t// If no existing cookie or this one has a more specific (longer) path, use this one\n\t\t\t\t\tif (!existing || c.options.path.length > existing.options.path.length) {\n\t\t\t\t\t\tlookup.set(c.name, c);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Add the most specific cookies to the result\n\t\t\tfor (const c of lookup.values()) {\n\t\t\t\tcookies[c.name] = c.value;\n\t\t\t}\n\n\t\t\treturn Object.entries(cookies).map(([name, value]) => ({ name, value }));\n\t\t},\n\n\t\t/**\n\t\t * @param {string} name\n\t\t * @param {string} value\n\t\t * @param {import('./page/types.js').Cookie['options']} options\n\t\t */\n\t\tset(name, value, options) {\n\t\t\t// TODO: remove this check in 3.0\n\t\t\tconst illegal_characters = name.match(INVALID_COOKIE_CHARACTER_REGEX);\n\t\t\tif (illegal_characters) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`The cookie name \"${name}\" will be invalid in SvelteKit 3.0 as it contains ${illegal_characters.join(\n\t\t\t\t\t\t' and '\n\t\t\t\t\t)}. See RFC 2616 for more details https://datatracker.ietf.org/doc/html/rfc2616#section-2.2`\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tvalidate_options(options);\n\t\t\tset_internal(name, value, { ...defaults, ...options });\n\t\t},\n\n\t\t/**\n\t\t * @param {string} name\n\t\t *  @param {import('./page/types.js').Cookie['options']} options\n\t\t */\n\t\tdelete(name, options) {\n\t\t\tvalidate_options(options);\n\t\t\tcookies.set(name, '', { ...options, maxAge: 0 });\n\t\t},\n\n\t\t/**\n\t\t * @param {string} name\n\t\t * @param {string} value\n\t\t *  @param {import('./page/types.js').Cookie['options']} options\n\t\t */\n\t\tserialize(name, value, options) {\n\t\t\tvalidate_options(options);\n\n\t\t\tlet path = options.path;\n\n\t\t\tif (!options.domain || options.domain === url.hostname) {\n\t\t\t\tif (!normalized_url) {\n\t\t\t\t\tthrow new Error('Cannot serialize cookies until after the route is determined');\n\t\t\t\t}\n\t\t\t\tpath = resolve(normalized_url, path);\n\t\t\t}\n\n\t\t\treturn serialize(name, value, { ...defaults, ...options, path });\n\t\t}\n\t};\n\n\t/**\n\t * @param {URL} destination\n\t * @param {string | null} header\n\t */\n\tfunction get_cookie_header(destination, header) {\n\t\t/** @type {Record<string, string>} */\n\t\tconst combined_cookies = {\n\t\t\t// cookies sent by the user agent have lowest precedence\n\t\t\t...initial_cookies\n\t\t};\n\n\t\t// cookies previous set during this event with cookies.set have higher precedence\n\t\tfor (const cookie of new_cookies.values()) {\n\t\t\tif (!domain_matches(destination.hostname, cookie.options.domain)) continue;\n\t\t\tif (!path_matches(destination.pathname, cookie.options.path)) continue;\n\n\t\t\tconst encoder = cookie.options.encode || encodeURIComponent;\n\t\t\tcombined_cookies[cookie.name] = encoder(cookie.value);\n\t\t}\n\n\t\t// explicit header has highest precedence\n\t\tif (header) {\n\t\t\tconst parsed = parse(header, { decode: (value) => value });\n\t\t\tfor (const name in parsed) {\n\t\t\t\tcombined_cookies[name] = parsed[name];\n\t\t\t}\n\t\t}\n\n\t\treturn Object.entries(combined_cookies)\n\t\t\t.map(([name, value]) => `${name}=${value}`)\n\t\t\t.join('; ');\n\t}\n\n\t/** @type {Array<() => void>} */\n\tconst internal_queue = [];\n\n\t/**\n\t * @param {string} name\n\t * @param {string} value\n\t * @param {import('./page/types.js').Cookie['options']} options\n\t */\n\tfunction set_internal(name, value, options) {\n\t\tif (!normalized_url) {\n\t\t\tinternal_queue.push(() => set_internal(name, value, options));\n\t\t\treturn;\n\t\t}\n\n\t\tlet path = options.path;\n\n\t\tif (!options.domain || options.domain === url.hostname) {\n\t\t\tpath = resolve(normalized_url, path);\n\t\t}\n\n\t\t// Generate unique key for cookie storage\n\t\tconst cookie_key = generate_cookie_key(options.domain, path, name);\n\t\tconst cookie = { name, value, options: { ...options, path } };\n\t\tnew_cookies.set(cookie_key, cookie);\n\n\t\tif (DEV) {\n\t\t\tconst serialized = serialize(name, value, cookie.options);\n\t\t\tif (text_encoder.encode(serialized).byteLength > MAX_COOKIE_SIZE) {\n\t\t\t\tthrow new Error(`Cookie \"${name}\" is too large, and will be discarded by the browser`);\n\t\t\t}\n\n\t\t\tcookie_paths[name] ??= new Set();\n\n\t\t\tif (!value) {\n\t\t\t\tcookie_paths[name].delete(path);\n\t\t\t} else {\n\t\t\t\tcookie_paths[name].add(path);\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * @param {import('types').TrailingSlash} trailing_slash\n\t */\n\tfunction set_trailing_slash(trailing_slash) {\n\t\tnormalized_url = normalize_path(url.pathname, trailing_slash);\n\t\tinternal_queue.forEach((fn) => fn());\n\t}\n\n\treturn { cookies, new_cookies, get_cookie_header, set_internal, set_trailing_slash };\n}\n\n/**\n * @param {string} hostname\n * @param {string} [constraint]\n */\nexport function domain_matches(hostname, constraint) {\n\tif (!constraint) return true;\n\n\tconst normalized = constraint[0] === '.' ? constraint.slice(1) : constraint;\n\n\tif (hostname === normalized) return true;\n\treturn hostname.endsWith('.' + normalized);\n}\n\n/**\n * @param {string} path\n * @param {string} [constraint]\n */\nexport function path_matches(path, constraint) {\n\tif (!constraint) return true;\n\n\tconst normalized = constraint.endsWith('/') ? constraint.slice(0, -1) : constraint;\n\n\tif (path === normalized) return true;\n\treturn path.startsWith(normalized + '/');\n}\n\n/**\n * @param {Headers} headers\n * @param {MapIterator<import('./page/types.js').Cookie>} cookies\n */\nexport function add_cookies_to_headers(headers, cookies) {\n\tfor (const new_cookie of cookies) {\n\t\tconst { name, value, options } = new_cookie;\n\t\theaders.append('set-cookie', serialize(name, value, options));\n\n\t\t// special case — for routes ending with .html, the route data lives in a sibling\n\t\t// `.html__data.json` file rather than a child `/__data.json` file, which means\n\t\t// we need to duplicate the cookie\n\t\tif (options.path.endsWith('.html')) {\n\t\t\tconst path = add_data_suffix(options.path);\n\t\t\theaders.append('set-cookie', serialize(name, value, { ...options, path }));\n\t\t}\n\t}\n}\n\n/**\n * @param {string[]} array\n */\nfunction conjoin(array) {\n\tif (array.length <= 2) return array.join(' and ');\n\treturn `${array.slice(0, -1).join(', ')} and ${array.at(-1)}`;\n}\n","import * as set_cookie_parser from 'set-cookie-parser';\nimport { respond } from './respond.js';\nimport * as paths from '$app/paths/internal/server';\nimport { read_implementation } from '__sveltekit/server';\nimport { has_prerendered_path } from './utils.js';\n\n/**\n * @param {{\n *   event: import('@sveltejs/kit').RequestEvent;\n *   options: import('types').SSROptions;\n *   manifest: import('@sveltejs/kit').SSRManifest;\n *   state: import('types').SSRState;\n *   get_cookie_header: (url: URL, header: string | null) => string;\n *   set_internal: (name: string, value: string, opts: import('./page/types.js').Cookie['options']) => void;\n * }} opts\n * @returns {typeof fetch}\n */\nexport function create_fetch({ event, options, manifest, state, get_cookie_header, set_internal }) {\n\t/**\n\t * @type {typeof fetch}\n\t */\n\tconst server_fetch = async (info, init) => {\n\t\tconst original_request = normalize_fetch_input(info, init, event.url);\n\n\t\t// some runtimes (e.g. Cloudflare) error if you access `request.mode`,\n\t\t// annoyingly, so we need to read the value from the `init` object instead\n\t\tlet mode = (info instanceof Request ? info.mode : init?.mode) ?? 'cors';\n\t\tlet credentials =\n\t\t\t(info instanceof Request ? info.credentials : init?.credentials) ?? 'same-origin';\n\n\t\treturn options.hooks.handleFetch({\n\t\t\tevent,\n\t\t\trequest: original_request,\n\t\t\tfetch: async (info, init) => {\n\t\t\t\tconst request = normalize_fetch_input(info, init, event.url);\n\n\t\t\t\tconst url = new URL(request.url);\n\n\t\t\t\tif (!request.headers.has('origin')) {\n\t\t\t\t\trequest.headers.set('origin', event.url.origin);\n\t\t\t\t}\n\n\t\t\t\tif (info !== original_request) {\n\t\t\t\t\tmode = (info instanceof Request ? info.mode : init?.mode) ?? 'cors';\n\t\t\t\t\tcredentials =\n\t\t\t\t\t\t(info instanceof Request ? info.credentials : init?.credentials) ?? 'same-origin';\n\t\t\t\t}\n\n\t\t\t\t// Remove Origin, according to https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Origin#description\n\t\t\t\tif (\n\t\t\t\t\t(request.method === 'GET' || request.method === 'HEAD') &&\n\t\t\t\t\t((mode === 'no-cors' && url.origin !== event.url.origin) ||\n\t\t\t\t\t\turl.origin === event.url.origin)\n\t\t\t\t) {\n\t\t\t\t\trequest.headers.delete('origin');\n\t\t\t\t}\n\n\t\t\t\tif (url.origin !== event.url.origin) {\n\t\t\t\t\t// Allow cookie passthrough for \"credentials: same-origin\" and \"credentials: include\"\n\t\t\t\t\t// if SvelteKit is serving my.domain.com:\n\t\t\t\t\t// -        domain.com WILL NOT receive cookies\n\t\t\t\t\t// -     my.domain.com WILL receive cookies\n\t\t\t\t\t// -    api.domain.dom WILL NOT receive cookies\n\t\t\t\t\t// - sub.my.domain.com WILL receive cookies\n\t\t\t\t\t// ports do not affect the resolution\n\t\t\t\t\t// leading dot prevents mydomain.com matching domain.com\n\t\t\t\t\t// Do not forward other cookies for \"credentials: include\" because we don't know\n\t\t\t\t\t// which cookie belongs to which domain (browser does not pass this info)\n\t\t\t\t\tif (`.${url.hostname}`.endsWith(`.${event.url.hostname}`) && credentials !== 'omit') {\n\t\t\t\t\t\tconst cookie = get_cookie_header(url, request.headers.get('cookie'));\n\t\t\t\t\t\tif (cookie) request.headers.set('cookie', cookie);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn fetch(request);\n\t\t\t\t}\n\n\t\t\t\t// handle fetch requests for static assets. e.g. prebaked data, etc.\n\t\t\t\t// we need to support everything the browser's fetch supports\n\t\t\t\tconst prefix = paths.assets || paths.base;\n\t\t\t\tconst decoded = decodeURIComponent(url.pathname);\n\t\t\t\tconst filename = (\n\t\t\t\t\tdecoded.startsWith(prefix) ? decoded.slice(prefix.length) : decoded\n\t\t\t\t).slice(1);\n\t\t\t\tconst filename_html = `${filename}/index.html`; // path may also match path/index.html\n\n\t\t\t\tconst is_asset = manifest.assets.has(filename) || filename in manifest._.server_assets;\n\t\t\t\tconst is_asset_html =\n\t\t\t\t\tmanifest.assets.has(filename_html) || filename_html in manifest._.server_assets;\n\n\t\t\t\tif (is_asset || is_asset_html) {\n\t\t\t\t\tconst file = is_asset ? filename : filename_html;\n\n\t\t\t\t\tif (state.read) {\n\t\t\t\t\t\tconst type = is_asset\n\t\t\t\t\t\t\t? manifest.mimeTypes[filename.slice(filename.lastIndexOf('.'))]\n\t\t\t\t\t\t\t: 'text/html';\n\n\t\t\t\t\t\treturn new Response(state.read(file), {\n\t\t\t\t\t\t\theaders: type ? { 'content-type': type } : {}\n\t\t\t\t\t\t});\n\t\t\t\t\t} else if (read_implementation && file in manifest._.server_assets) {\n\t\t\t\t\t\tconst length = manifest._.server_assets[file];\n\t\t\t\t\t\tconst type = manifest.mimeTypes[file.slice(file.lastIndexOf('.'))];\n\n\t\t\t\t\t\treturn new Response(read_implementation(file), {\n\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t'Content-Length': '' + length,\n\t\t\t\t\t\t\t\t'Content-Type': type\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn await fetch(request);\n\t\t\t\t}\n\n\t\t\t\tif (has_prerendered_path(manifest, paths.base + decoded)) {\n\t\t\t\t\t// The path of something prerendered could match a different route\n\t\t\t\t\t// that is still in the manifest, leading to the wrong route being loaded.\n\t\t\t\t\t// We therefore bail early here. The prerendered logic is different for\n\t\t\t\t\t// each adapter, (except maybe for prerendered redirects)\n\t\t\t\t\t// so we need to make an actual HTTP request.\n\t\t\t\t\treturn await fetch(request);\n\t\t\t\t}\n\n\t\t\t\tif (credentials !== 'omit') {\n\t\t\t\t\tconst cookie = get_cookie_header(url, request.headers.get('cookie'));\n\t\t\t\t\tif (cookie) {\n\t\t\t\t\t\trequest.headers.set('cookie', cookie);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst authorization = event.request.headers.get('authorization');\n\t\t\t\t\tif (authorization && !request.headers.has('authorization')) {\n\t\t\t\t\t\trequest.headers.set('authorization', authorization);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (!request.headers.has('accept')) {\n\t\t\t\t\trequest.headers.set('accept', '*/*');\n\t\t\t\t}\n\n\t\t\t\tif (!request.headers.has('accept-language')) {\n\t\t\t\t\trequest.headers.set(\n\t\t\t\t\t\t'accept-language',\n\t\t\t\t\t\t/** @type {string} */ (event.request.headers.get('accept-language'))\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tconst response = await internal_fetch(request, options, manifest, state);\n\n\t\t\t\tconst set_cookie = response.headers.get('set-cookie');\n\t\t\t\tif (set_cookie) {\n\t\t\t\t\tfor (const str of set_cookie_parser.splitCookiesString(set_cookie)) {\n\t\t\t\t\t\tconst { name, value, ...options } = set_cookie_parser.parseString(str, {\n\t\t\t\t\t\t\tdecodeValues: false\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tconst path = options.path ?? (url.pathname.split('/').slice(0, -1).join('/') || '/');\n\n\t\t\t\t\t\t// options.sameSite is string, something more specific is required - type cast is safe\n\t\t\t\t\t\tset_internal(name, value, {\n\t\t\t\t\t\t\tpath,\n\t\t\t\t\t\t\tencode: (value) => value,\n\t\t\t\t\t\t\t.../** @type {import('cookie').CookieSerializeOptions} */ (options)\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn response;\n\t\t\t}\n\t\t});\n\t};\n\n\t// Don't make this function `async`! Otherwise, the user has to `catch` promises they use for streaming responses or else\n\t// it will be an unhandled rejection. Instead, we add a `.catch(() => {})` ourselves below to prevent this from happening.\n\treturn (input, init) => {\n\t\t// See docs in fetch.js for why we need to do this\n\t\tconst response = server_fetch(input, init);\n\t\tresponse.catch(() => {});\n\t\treturn response;\n\t};\n}\n\n/**\n * @param {RequestInfo | URL} info\n * @param {RequestInit | undefined} init\n * @param {URL} url\n */\nfunction normalize_fetch_input(info, init, url) {\n\tif (info instanceof Request) {\n\t\treturn info;\n\t}\n\n\treturn new Request(typeof info === 'string' ? new URL(info, url) : info, init);\n}\n\n/**\n * @param {Request} request\n * @param {import('types').SSROptions} options\n * @param {import('@sveltejs/kit').SSRManifest} manifest\n * @param {import('types').SSRState} state\n * @returns {Promise<Response>}\n */\nasync function internal_fetch(request, options, manifest, state) {\n\tif (request.signal) {\n\t\tif (request.signal.aborted) {\n\t\t\tthrow new DOMException('The operation was aborted.', 'AbortError');\n\t\t}\n\n\t\tlet remove_abort_listener = () => {};\n\t\t/** @type {Promise<never>} */\n\t\tconst abort_promise = new Promise((_, reject) => {\n\t\t\tconst on_abort = () => {\n\t\t\t\treject(new DOMException('The operation was aborted.', 'AbortError'));\n\t\t\t};\n\t\t\trequest.signal.addEventListener('abort', on_abort, { once: true });\n\t\t\tremove_abort_listener = () => request.signal.removeEventListener('abort', on_abort);\n\t\t});\n\n\t\tconst result = await Promise.race([\n\t\t\trespond(request, options, manifest, {\n\t\t\t\t...state,\n\t\t\t\tdepth: state.depth + 1\n\t\t\t}),\n\t\t\tabort_promise\n\t\t]);\n\t\tremove_abort_listener();\n\t\treturn result;\n\t} else {\n\t\treturn await respond(request, options, manifest, {\n\t\t\t...state,\n\t\t\tdepth: state.depth + 1\n\t\t});\n\t}\n}\n","import { public_env } from '../shared-server.js';\n\n/** @type {string} */\nlet body;\n\n/** @type {string} */\nlet etag;\n\n/** @type {Headers} */\nlet headers;\n\n/**\n * @param {Request} request\n * @returns {Response}\n */\nexport function get_public_env(request) {\n\tbody ??= `export const env=${JSON.stringify(public_env)}`;\n\tetag ??= `W/${Date.now()}`;\n\theaders ??= new Headers({\n\t\t'content-type': 'application/javascript; charset=utf-8',\n\t\tetag\n\t});\n\n\tif (request.headers.get('if-none-match') === etag) {\n\t\treturn new Response(undefined, { status: 304, headers });\n\t}\n\n\treturn new Response(body, { headers });\n}\n","/** @import { RequestState } from 'types' */\nimport { DEV } from 'esm-env';\nimport { json, text } from '@sveltejs/kit';\nimport { Redirect, SvelteKitError } from '@sveltejs/kit/internal';\nimport { merge_tracing, with_request_store } from '@sveltejs/kit/internal/server';\nimport { base, app_dir } from '$app/paths/internal/server';\nimport { is_endpoint_request, render_endpoint } from './endpoint.js';\nimport { render_page } from './page/index.js';\nimport { render_response } from './page/render.js';\nimport { respond_with_error } from './page/respond_with_error.js';\nimport { is_form_content_type } from '../../utils/http.js';\nimport {\n\thandle_fatal_error,\n\thas_prerendered_path,\n\tmethod_not_allowed,\n\tredirect_response\n} from './utils.js';\nimport { decode_pathname, decode_params, disable_search, normalize_path } from '../../utils/url.js';\nimport { exec } from '../../utils/routing.js';\nimport { redirect_json_response, render_data } from './data/index.js';\nimport { add_cookies_to_headers, get_cookies } from './cookie.js';\nimport { create_fetch } from './fetch.js';\nimport { PageNodes } from '../../utils/page_nodes.js';\nimport { validate_server_exports } from '../../utils/exports.js';\nimport { action_json_redirect, is_action_json_request } from './page/actions.js';\nimport { INVALIDATED_PARAM, TRAILING_SLASH_PARAM } from '../shared.js';\nimport { get_public_env } from './env_module.js';\nimport { resolve_route } from './page/server_routing.js';\nimport { validateHeaders } from './validate-headers.js';\nimport {\n\tadd_data_suffix,\n\tadd_resolution_suffix,\n\thas_data_suffix,\n\thas_resolution_suffix,\n\tstrip_data_suffix,\n\tstrip_resolution_suffix\n} from '../pathname.js';\nimport { server_data_serializer } from './page/data_serializer.js';\nimport { get_remote_id, handle_remote_call } from './remote.js';\nimport { record_span } from '../telemetry/record_span.js';\nimport { otel } from '../telemetry/otel.js';\n\n/* global __SVELTEKIT_ADAPTER_NAME__ */\n\n/** @type {import('types').RequiredResolveOptions['transformPageChunk']} */\nconst default_transform = ({ html }) => html;\n\n/** @type {import('types').RequiredResolveOptions['filterSerializedResponseHeaders']} */\nconst default_filter = () => false;\n\n/** @type {import('types').RequiredResolveOptions['preload']} */\nconst default_preload = ({ type }) => type === 'js' || type === 'css';\n\nconst page_methods = new Set(['GET', 'HEAD', 'POST']);\n\nconst allowed_page_methods = new Set(['GET', 'HEAD', 'OPTIONS']);\n\nlet warned_on_devtools_json_request = false;\n\nexport const respond = propagate_context(internal_respond);\n\n/**\n * @param {Request} request\n * @param {import('types').SSROptions} options\n * @param {import('@sveltejs/kit').SSRManifest} manifest\n * @param {import('types').SSRState} state\n * @returns {Promise<Response>}\n */\nexport async function internal_respond(request, options, manifest, state) {\n\t/** URL but stripped from the potential `/__data.json` suffix and its search param  */\n\tconst url = new URL(request.url);\n\n\tconst is_route_resolution_request = has_resolution_suffix(url.pathname);\n\tconst is_data_request = has_data_suffix(url.pathname);\n\tconst remote_id = get_remote_id(url);\n\n\tif (!DEV) {\n\t\tconst request_origin = request.headers.get('origin');\n\n\t\tif (remote_id) {\n\t\t\tif (request.method !== 'GET' && request_origin !== url.origin) {\n\t\t\t\tconst message = 'Cross-site remote requests are forbidden';\n\t\t\t\treturn json({ message }, { status: 403 });\n\t\t\t}\n\t\t} else if (options.csrf_check_origin) {\n\t\t\tconst forbidden =\n\t\t\t\tis_form_content_type(request) &&\n\t\t\t\t(request.method === 'POST' ||\n\t\t\t\t\trequest.method === 'PUT' ||\n\t\t\t\t\trequest.method === 'PATCH' ||\n\t\t\t\t\trequest.method === 'DELETE') &&\n\t\t\t\trequest_origin !== url.origin &&\n\t\t\t\t(!request_origin || !options.csrf_trusted_origins.includes(request_origin));\n\n\t\t\tif (forbidden) {\n\t\t\t\tconst message = `Cross-site ${request.method} form submissions are forbidden`;\n\t\t\t\tconst opts = { status: 403 };\n\n\t\t\t\tif (request.headers.get('accept') === 'application/json') {\n\t\t\t\t\treturn json({ message }, opts);\n\t\t\t\t}\n\n\t\t\t\treturn text(message, opts);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (options.hash_routing && url.pathname !== base + '/' && url.pathname !== '/[fallback]') {\n\t\treturn text('Not found', { status: 404 });\n\t}\n\n\t/** @type {boolean[] | undefined} */\n\tlet invalidated_data_nodes;\n\n\tif (is_route_resolution_request) {\n\t\t/**\n\t\t * If the request is for a route resolution, first modify the URL, then continue as normal\n\t\t * for path resolution, then return the route object as a JS file.\n\t\t */\n\t\turl.pathname = strip_resolution_suffix(url.pathname);\n\t} else if (is_data_request) {\n\t\turl.pathname =\n\t\t\tstrip_data_suffix(url.pathname) +\n\t\t\t\t(url.searchParams.get(TRAILING_SLASH_PARAM) === '1' ? '/' : '') || '/';\n\t\turl.searchParams.delete(TRAILING_SLASH_PARAM);\n\t\tinvalidated_data_nodes = url.searchParams\n\t\t\t.get(INVALIDATED_PARAM)\n\t\t\t?.split('')\n\t\t\t.map((node) => node === '1');\n\t\turl.searchParams.delete(INVALIDATED_PARAM);\n\t} else if (remote_id) {\n\t\turl.pathname = request.headers.get('x-sveltekit-pathname') ?? base;\n\t\turl.search = request.headers.get('x-sveltekit-search') ?? '';\n\t}\n\n\t/** @type {Record<string, string>} */\n\tconst headers = {};\n\n\tconst { cookies, new_cookies, get_cookie_header, set_internal, set_trailing_slash } = get_cookies(\n\t\trequest,\n\t\turl\n\t);\n\n\t/** @type {RequestState} */\n\tconst event_state = {\n\t\tprerendering: state.prerendering,\n\t\ttransport: options.hooks.transport,\n\t\thandleValidationError: options.hooks.handleValidationError,\n\t\ttracing: {\n\t\t\trecord_span\n\t\t},\n\t\tis_in_remote_function: false\n\t};\n\n\t/** @type {import('@sveltejs/kit').RequestEvent} */\n\tconst event = {\n\t\tcookies,\n\t\t// @ts-expect-error `fetch` needs to be created after the `event` itself\n\t\tfetch: null,\n\t\tgetClientAddress:\n\t\t\tstate.getClientAddress ||\n\t\t\t(() => {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t`${__SVELTEKIT_ADAPTER_NAME__} does not specify getClientAddress. Please raise an issue`\n\t\t\t\t);\n\t\t\t}),\n\t\tlocals: {},\n\t\tparams: {},\n\t\tplatform: state.platform,\n\t\trequest,\n\t\troute: { id: null },\n\t\tsetHeaders: (new_headers) => {\n\t\t\tif (DEV) {\n\t\t\t\tvalidateHeaders(new_headers);\n\t\t\t}\n\n\t\t\tfor (const key in new_headers) {\n\t\t\t\tconst lower = key.toLowerCase();\n\t\t\t\tconst value = new_headers[key];\n\n\t\t\t\tif (lower === 'set-cookie') {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t'Use `event.cookies.set(name, value, options)` instead of `event.setHeaders` to set cookies'\n\t\t\t\t\t);\n\t\t\t\t} else if (lower in headers) {\n\t\t\t\t\t// appendHeaders-style for Server-Timing https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Server-Timing\n\t\t\t\t\tif (lower === 'server-timing') {\n\t\t\t\t\t\theaders[lower] += ', ' + value;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(`\"${key}\" header is already set`);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\theaders[lower] = value;\n\n\t\t\t\t\tif (state.prerendering && lower === 'cache-control') {\n\t\t\t\t\t\tstate.prerendering.cache = /** @type {string} */ (value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\turl,\n\t\tisDataRequest: is_data_request,\n\t\tisSubRequest: state.depth > 0,\n\t\tisRemoteRequest: !!remote_id\n\t};\n\n\tevent.fetch = create_fetch({\n\t\tevent,\n\t\toptions,\n\t\tmanifest,\n\t\tstate,\n\t\tget_cookie_header,\n\t\tset_internal\n\t});\n\n\tif (state.emulator?.platform) {\n\t\tevent.platform = await state.emulator.platform({\n\t\t\tconfig: {},\n\t\t\tprerender: !!state.prerendering?.fallback\n\t\t});\n\t}\n\n\tlet resolved_path = url.pathname;\n\n\tif (!remote_id) {\n\t\tconst prerendering_reroute_state = state.prerendering?.inside_reroute;\n\t\ttry {\n\t\t\t// For the duration or a reroute, disable the prerendering state as reroute could call API endpoints\n\t\t\t// which would end up in the wrong logic path if not disabled.\n\t\t\tif (state.prerendering) state.prerendering.inside_reroute = true;\n\n\t\t\t// reroute could alter the given URL, so we pass a copy\n\t\t\tresolved_path =\n\t\t\t\t(await options.hooks.reroute({ url: new URL(url), fetch: event.fetch })) ?? url.pathname;\n\t\t} catch {\n\t\t\treturn text('Internal Server Error', {\n\t\t\t\tstatus: 500\n\t\t\t});\n\t\t} finally {\n\t\t\tif (state.prerendering) state.prerendering.inside_reroute = prerendering_reroute_state;\n\t\t}\n\t}\n\n\ttry {\n\t\tresolved_path = decode_pathname(resolved_path);\n\t} catch {\n\t\treturn text('Malformed URI', { status: 400 });\n\t}\n\n\tif (\n\t\tresolved_path !== url.pathname &&\n\t\t!state.prerendering?.fallback &&\n\t\thas_prerendered_path(manifest, resolved_path)\n\t) {\n\t\tconst url = new URL(request.url);\n\t\turl.pathname = is_data_request\n\t\t\t? add_data_suffix(resolved_path)\n\t\t\t: is_route_resolution_request\n\t\t\t\t? add_resolution_suffix(resolved_path)\n\t\t\t\t: resolved_path;\n\n\t\t// `fetch` automatically decodes the body, so we need to delete the related headers to not break the response\n\t\t// Also see https://github.com/sveltejs/kit/issues/12197 for more info (we should fix this more generally at some point)\n\t\tconst response = await fetch(url, request);\n\t\tconst headers = new Headers(response.headers);\n\t\tif (headers.has('content-encoding')) {\n\t\t\theaders.delete('content-encoding');\n\t\t\theaders.delete('content-length');\n\t\t}\n\n\t\treturn new Response(response.body, {\n\t\t\theaders,\n\t\t\tstatus: response.status,\n\t\t\tstatusText: response.statusText\n\t\t});\n\t}\n\n\t/** @type {import('types').SSRRoute | null} */\n\tlet route = null;\n\n\tif (base && !state.prerendering?.fallback) {\n\t\tif (!resolved_path.startsWith(base)) {\n\t\t\treturn text('Not found', { status: 404 });\n\t\t}\n\t\tresolved_path = resolved_path.slice(base.length) || '/';\n\t}\n\n\tif (is_route_resolution_request) {\n\t\treturn resolve_route(resolved_path, new URL(request.url), manifest);\n\t}\n\n\tif (resolved_path === `/${app_dir}/env.js`) {\n\t\treturn get_public_env(request);\n\t}\n\n\tif (!remote_id && resolved_path.startsWith(`/${app_dir}`)) {\n\t\t// Ensure that 404'd static assets are not cached - some adapters might apply caching by default\n\t\tconst headers = new Headers();\n\t\theaders.set('cache-control', 'public, max-age=0, must-revalidate');\n\t\treturn text('Not found', { status: 404, headers });\n\t}\n\n\tif (!state.prerendering?.fallback) {\n\t\t// TODO this could theoretically break — should probably be inside a try-catch\n\t\tconst matchers = await manifest._.matchers();\n\n\t\tfor (const candidate of manifest._.routes) {\n\t\t\tconst match = candidate.pattern.exec(resolved_path);\n\t\t\tif (!match) continue;\n\n\t\t\tconst matched = exec(match, candidate.params, matchers);\n\t\t\tif (matched) {\n\t\t\t\troute = candidate;\n\t\t\t\tevent.route = { id: route.id };\n\t\t\t\tevent.params = decode_params(matched);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\t/** @type {import('types').RequiredResolveOptions} */\n\tlet resolve_opts = {\n\t\ttransformPageChunk: default_transform,\n\t\tfilterSerializedResponseHeaders: default_filter,\n\t\tpreload: default_preload\n\t};\n\n\t/** @type {import('types').TrailingSlash} */\n\tlet trailing_slash = 'never';\n\n\ttry {\n\t\t/** @type {PageNodes | undefined} */\n\t\tconst page_nodes = route?.page\n\t\t\t? new PageNodes(await load_page_nodes(route.page, manifest))\n\t\t\t: undefined;\n\n\t\t// determine whether we need to redirect to add/remove a trailing slash\n\t\tif (route && !remote_id) {\n\t\t\t// if `paths.base === '/a/b/c`, then the root route is `/a/b/c/`,\n\t\t\t// regardless of the `trailingSlash` route option\n\t\t\tif (url.pathname === base || url.pathname === base + '/') {\n\t\t\t\ttrailing_slash = 'always';\n\t\t\t} else if (page_nodes) {\n\t\t\t\tif (DEV) {\n\t\t\t\t\tpage_nodes.validate();\n\t\t\t\t}\n\t\t\t\ttrailing_slash = page_nodes.trailing_slash();\n\t\t\t} else if (route.endpoint) {\n\t\t\t\tconst node = await route.endpoint();\n\t\t\t\ttrailing_slash = node.trailingSlash ?? 'never';\n\t\t\t\tif (DEV) {\n\t\t\t\t\tvalidate_server_exports(node, /** @type {string} */ (route.endpoint_id));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!is_data_request) {\n\t\t\t\tconst normalized = normalize_path(url.pathname, trailing_slash);\n\n\t\t\t\tif (normalized !== url.pathname && !state.prerendering?.fallback) {\n\t\t\t\t\treturn new Response(undefined, {\n\t\t\t\t\t\tstatus: 308,\n\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t'x-sveltekit-normalize': '1',\n\t\t\t\t\t\t\tlocation:\n\t\t\t\t\t\t\t\t// ensure paths starting with '//' are not treated as protocol-relative\n\t\t\t\t\t\t\t\t(normalized.startsWith('//') ? url.origin + normalized : normalized) +\n\t\t\t\t\t\t\t\t(url.search === '?' ? '' : url.search)\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (state.before_handle || state.emulator?.platform) {\n\t\t\t\tlet config = {};\n\n\t\t\t\t/** @type {import('types').PrerenderOption} */\n\t\t\t\tlet prerender = false;\n\n\t\t\t\tif (route.endpoint) {\n\t\t\t\t\tconst node = await route.endpoint();\n\t\t\t\t\tconfig = node.config ?? config;\n\t\t\t\t\tprerender = node.prerender ?? prerender;\n\t\t\t\t} else if (page_nodes) {\n\t\t\t\t\tconfig = page_nodes.get_config() ?? config;\n\t\t\t\t\tprerender = page_nodes.prerender();\n\t\t\t\t}\n\n\t\t\t\tif (state.before_handle) {\n\t\t\t\t\tstate.before_handle(event, config, prerender);\n\t\t\t\t}\n\n\t\t\t\tif (state.emulator?.platform) {\n\t\t\t\t\tevent.platform = await state.emulator.platform({ config, prerender });\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tset_trailing_slash(trailing_slash);\n\n\t\tif (state.prerendering && !state.prerendering.fallback && !state.prerendering.inside_reroute) {\n\t\t\tdisable_search(url);\n\t\t}\n\n\t\tconst response = await record_span({\n\t\t\tname: 'sveltekit.handle.root',\n\t\t\tattributes: {\n\t\t\t\t'http.route': event.route.id || 'unknown',\n\t\t\t\t'http.method': event.request.method,\n\t\t\t\t'http.url': event.url.href,\n\t\t\t\t'sveltekit.is_data_request': is_data_request,\n\t\t\t\t'sveltekit.is_sub_request': event.isSubRequest\n\t\t\t},\n\t\t\tfn: async (root_span) => {\n\t\t\t\tconst traced_event = {\n\t\t\t\t\t...event,\n\t\t\t\t\ttracing: {\n\t\t\t\t\t\tenabled: __SVELTEKIT_SERVER_TRACING_ENABLED__,\n\t\t\t\t\t\troot: root_span,\n\t\t\t\t\t\tcurrent: root_span\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\treturn await with_request_store({ event: traced_event, state: event_state }, () =>\n\t\t\t\t\toptions.hooks.handle({\n\t\t\t\t\t\tevent: traced_event,\n\t\t\t\t\t\tresolve: (event, opts) => {\n\t\t\t\t\t\t\treturn record_span({\n\t\t\t\t\t\t\t\tname: 'sveltekit.resolve',\n\t\t\t\t\t\t\t\tattributes: {\n\t\t\t\t\t\t\t\t\t'http.route': event.route.id || 'unknown'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tfn: (resolve_span) => {\n\t\t\t\t\t\t\t\t\t// counter-intuitively, we need to clear the event, so that it's not\n\t\t\t\t\t\t\t\t\t// e.g. accessible when loading modules needed to handle the request\n\t\t\t\t\t\t\t\t\treturn with_request_store(null, () =>\n\t\t\t\t\t\t\t\t\t\tresolve(merge_tracing(event, resolve_span), page_nodes, opts).then(\n\t\t\t\t\t\t\t\t\t\t\t(response) => {\n\t\t\t\t\t\t\t\t\t\t\t\t// add headers/cookies here, rather than inside `resolve`, so that we\n\t\t\t\t\t\t\t\t\t\t\t\t// can do it once for all responses instead of once per `return`\n\t\t\t\t\t\t\t\t\t\t\t\tfor (const key in headers) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst value = headers[key];\n\t\t\t\t\t\t\t\t\t\t\t\t\tresponse.headers.set(key, /** @type {string} */ (value));\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\tadd_cookies_to_headers(response.headers, new_cookies.values());\n\n\t\t\t\t\t\t\t\t\t\t\t\tif (state.prerendering && event.route.id !== null) {\n\t\t\t\t\t\t\t\t\t\t\t\t\tresponse.headers.set('x-sveltekit-routeid', encodeURI(event.route.id));\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\t\t\tresolve_span.setAttributes({\n\t\t\t\t\t\t\t\t\t\t\t\t\t'http.response.status_code': response.status,\n\t\t\t\t\t\t\t\t\t\t\t\t\t'http.response.body.size':\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tresponse.headers.get('content-length') || 'unknown'\n\t\t\t\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\t\t\t\treturn response;\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\t// respond with 304 if etag matches\n\t\tif (response.status === 200 && response.headers.has('etag')) {\n\t\t\tlet if_none_match_value = request.headers.get('if-none-match');\n\n\t\t\t// ignore W/ prefix https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/If-None-Match#directives\n\t\t\tif (if_none_match_value?.startsWith('W/\"')) {\n\t\t\t\tif_none_match_value = if_none_match_value.substring(2);\n\t\t\t}\n\n\t\t\tconst etag = /** @type {string} */ (response.headers.get('etag'));\n\n\t\t\tif (if_none_match_value === etag) {\n\t\t\t\tconst headers = new Headers({ etag });\n\n\t\t\t\t// https://datatracker.ietf.org/doc/html/rfc7232#section-4.1 + set-cookie\n\t\t\t\tfor (const key of [\n\t\t\t\t\t'cache-control',\n\t\t\t\t\t'content-location',\n\t\t\t\t\t'date',\n\t\t\t\t\t'expires',\n\t\t\t\t\t'vary',\n\t\t\t\t\t'set-cookie'\n\t\t\t\t]) {\n\t\t\t\t\tconst value = response.headers.get(key);\n\t\t\t\t\tif (value) headers.set(key, value);\n\t\t\t\t}\n\n\t\t\t\treturn new Response(undefined, {\n\t\t\t\t\tstatus: 304,\n\t\t\t\t\theaders\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\t// Edge case: If user does `return Response(30x)` in handle hook while processing a data request,\n\t\t// we need to transform the redirect response to a corresponding JSON response.\n\t\tif (is_data_request && response.status >= 300 && response.status <= 308) {\n\t\t\tconst location = response.headers.get('location');\n\t\t\tif (location) {\n\t\t\t\treturn redirect_json_response(new Redirect(/** @type {any} */ (response.status), location));\n\t\t\t}\n\t\t}\n\n\t\treturn response;\n\t} catch (e) {\n\t\tif (e instanceof Redirect) {\n\t\t\tconst response =\n\t\t\t\tis_data_request || remote_id\n\t\t\t\t\t? redirect_json_response(e)\n\t\t\t\t\t: route?.page && is_action_json_request(event)\n\t\t\t\t\t\t? action_json_redirect(e)\n\t\t\t\t\t\t: redirect_response(e.status, e.location);\n\t\t\tadd_cookies_to_headers(response.headers, new_cookies.values());\n\t\t\treturn response;\n\t\t}\n\t\treturn await handle_fatal_error(event, event_state, options, e);\n\t}\n\n\t/**\n\t * @param {import('@sveltejs/kit').RequestEvent} event\n\t * @param {PageNodes | undefined} page_nodes\n\t * @param {import('@sveltejs/kit').ResolveOptions} [opts]\n\t */\n\tasync function resolve(event, page_nodes, opts) {\n\t\ttry {\n\t\t\tif (opts) {\n\t\t\t\tresolve_opts = {\n\t\t\t\t\ttransformPageChunk: opts.transformPageChunk || default_transform,\n\t\t\t\t\tfilterSerializedResponseHeaders: opts.filterSerializedResponseHeaders || default_filter,\n\t\t\t\t\tpreload: opts.preload || default_preload\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif (options.hash_routing || state.prerendering?.fallback) {\n\t\t\t\treturn await render_response({\n\t\t\t\t\tevent,\n\t\t\t\t\tevent_state,\n\t\t\t\t\toptions,\n\t\t\t\t\tmanifest,\n\t\t\t\t\tstate,\n\t\t\t\t\tpage_config: { ssr: false, csr: true },\n\t\t\t\t\tstatus: 200,\n\t\t\t\t\terror: null,\n\t\t\t\t\tbranch: [],\n\t\t\t\t\tfetched: [],\n\t\t\t\t\tresolve_opts,\n\t\t\t\t\tdata_serializer: server_data_serializer(event, event_state, options)\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (remote_id) {\n\t\t\t\treturn await handle_remote_call(event, event_state, options, manifest, remote_id);\n\t\t\t}\n\n\t\t\tif (route) {\n\t\t\t\tconst method = /** @type {import('types').HttpMethod} */ (event.request.method);\n\n\t\t\t\t/** @type {Response} */\n\t\t\t\tlet response;\n\n\t\t\t\tif (is_data_request) {\n\t\t\t\t\tresponse = await render_data(\n\t\t\t\t\t\tevent,\n\t\t\t\t\t\tevent_state,\n\t\t\t\t\t\troute,\n\t\t\t\t\t\toptions,\n\t\t\t\t\t\tmanifest,\n\t\t\t\t\t\tstate,\n\t\t\t\t\t\tinvalidated_data_nodes,\n\t\t\t\t\t\ttrailing_slash\n\t\t\t\t\t);\n\t\t\t\t} else if (route.endpoint && (!route.page || is_endpoint_request(event))) {\n\t\t\t\t\tresponse = await render_endpoint(event, event_state, await route.endpoint(), state);\n\t\t\t\t} else if (route.page) {\n\t\t\t\t\tif (!page_nodes) {\n\t\t\t\t\t\tthrow new Error('page_nodes not found. This should never happen');\n\t\t\t\t\t} else if (page_methods.has(method)) {\n\t\t\t\t\t\tresponse = await render_page(\n\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\tevent_state,\n\t\t\t\t\t\t\troute.page,\n\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\tmanifest,\n\t\t\t\t\t\t\tstate,\n\t\t\t\t\t\t\tpage_nodes,\n\t\t\t\t\t\t\tresolve_opts\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tconst allowed_methods = new Set(allowed_page_methods);\n\t\t\t\t\t\tconst node = await manifest._.nodes[route.page.leaf]();\n\t\t\t\t\t\tif (node?.server?.actions) {\n\t\t\t\t\t\t\tallowed_methods.add('POST');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (method === 'OPTIONS') {\n\t\t\t\t\t\t\t// This will deny CORS preflight requests implicitly because we don't\n\t\t\t\t\t\t\t// add the required CORS headers to the response.\n\t\t\t\t\t\t\tresponse = new Response(null, {\n\t\t\t\t\t\t\t\tstatus: 204,\n\t\t\t\t\t\t\t\theaders: {\n\t\t\t\t\t\t\t\t\tallow: Array.from(allowed_methods.values()).join(', ')\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst mod = [...allowed_methods].reduce((acc, curr) => {\n\t\t\t\t\t\t\t\tacc[curr] = true;\n\t\t\t\t\t\t\t\treturn acc;\n\t\t\t\t\t\t\t}, /** @type {Record<string, any>} */ ({}));\n\t\t\t\t\t\t\tresponse = method_not_allowed(mod, method);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\t// a route will always have a page or an endpoint, but TypeScript doesn't know that\n\t\t\t\t\tthrow new Error('Route is neither page nor endpoint. This should never happen');\n\t\t\t\t}\n\n\t\t\t\t// If the route contains a page and an endpoint, we need to add a\n\t\t\t\t// `Vary: Accept` header to the response because of browser caching\n\t\t\t\tif (request.method === 'GET' && route.page && route.endpoint) {\n\t\t\t\t\tconst vary = response.headers\n\t\t\t\t\t\t.get('vary')\n\t\t\t\t\t\t?.split(',')\n\t\t\t\t\t\t?.map((v) => v.trim().toLowerCase());\n\t\t\t\t\tif (!(vary?.includes('accept') || vary?.includes('*'))) {\n\t\t\t\t\t\t// the returned response might have immutable headers,\n\t\t\t\t\t\t// so we have to clone them before trying to mutate them\n\t\t\t\t\t\tresponse = new Response(response.body, {\n\t\t\t\t\t\t\tstatus: response.status,\n\t\t\t\t\t\t\tstatusText: response.statusText,\n\t\t\t\t\t\t\theaders: new Headers(response.headers)\n\t\t\t\t\t\t});\n\t\t\t\t\t\tresponse.headers.append('Vary', 'Accept');\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn response;\n\t\t\t}\n\n\t\t\tif (state.error && event.isSubRequest) {\n\t\t\t\t// avoid overwriting the headers. This could be a same origin fetch request\n\t\t\t\t// to an external service from the root layout while rendering an error page\n\t\t\t\tconst headers = new Headers(request.headers);\n\t\t\t\theaders.set('x-sveltekit-error', 'true');\n\t\t\t\treturn await fetch(request, { headers });\n\t\t\t}\n\n\t\t\tif (state.error) {\n\t\t\t\treturn text('Internal Server Error', {\n\t\t\t\t\tstatus: 500\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// if this request came direct from the user, rather than\n\t\t\t// via our own `fetch`, render a 404 page\n\t\t\tif (state.depth === 0) {\n\t\t\t\t// In local development, Chrome requests this file for its 'automatic workspace folders' feature,\n\t\t\t\t// causing console spam. If users want to serve this file they can install\n\t\t\t\t// https://svelte.dev/docs/cli/devtools-json\n\t\t\t\tif (DEV && event.url.pathname === '/.well-known/appspecific/com.chrome.devtools.json') {\n\t\t\t\t\tif (!warned_on_devtools_json_request) {\n\t\t\t\t\t\tconsole.log(\n\t\t\t\t\t\t\t`\\nGoogle Chrome is requesting ${event.url.pathname} to automatically configure devtools project settings. To learn why, and how to prevent this message, see https://svelte.dev/docs/cli/devtools-json\\n`\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\twarned_on_devtools_json_request = true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn new Response(undefined, { status: 404 });\n\t\t\t\t}\n\n\t\t\t\treturn await respond_with_error({\n\t\t\t\t\tevent,\n\t\t\t\t\tevent_state,\n\t\t\t\t\toptions,\n\t\t\t\t\tmanifest,\n\t\t\t\t\tstate,\n\t\t\t\t\tstatus: 404,\n\t\t\t\t\terror: new SvelteKitError(404, 'Not Found', `Not found: ${event.url.pathname}`),\n\t\t\t\t\tresolve_opts\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tif (state.prerendering) {\n\t\t\t\treturn text('not found', { status: 404 });\n\t\t\t}\n\n\t\t\t// we can't load the endpoint from our own manifest,\n\t\t\t// so we need to make an actual HTTP request\n\t\t\tconst response = await fetch(request);\n\n\t\t\t// clone the response so that headers are mutable (https://github.com/sveltejs/kit/issues/13857)\n\t\t\treturn new Response(response.body, response);\n\t\t} catch (e) {\n\t\t\t// TODO if `e` is instead named `error`, some fucked up Vite transformation happens\n\t\t\t// and I don't even know how to describe it. need to investigate at some point\n\n\t\t\t// HttpError from endpoint can end up here - TODO should it be handled there instead?\n\t\t\treturn await handle_fatal_error(event, event_state, options, e);\n\t\t} finally {\n\t\t\tevent.cookies.set = () => {\n\t\t\t\tthrow new Error('Cannot use `cookies.set(...)` after the response has been generated');\n\t\t\t};\n\n\t\t\tevent.setHeaders = () => {\n\t\t\t\tthrow new Error('Cannot use `setHeaders(...)` after the response has been generated');\n\t\t\t};\n\t\t}\n\t}\n}\n\n/**\n * @param {import('types').PageNodeIndexes} page\n * @param {import('@sveltejs/kit').SSRManifest} manifest\n */\nexport function load_page_nodes(page, manifest) {\n\treturn Promise.all([\n\t\t// we use == here rather than === because [undefined] serializes as \"[null]\"\n\t\t...page.layouts.map((n) => (n == undefined ? n : manifest._.nodes[n]())),\n\t\tmanifest._.nodes[page.leaf]()\n\t]);\n}\n\n/**\n * It's likely that, in a distributed system, there are spans starting outside the SvelteKit server -- eg.\n * started on the frontend client, or in a service that calls the SvelteKit server. There are standardized\n * ways to represent this context in HTTP headers, so we can extract that context and run our tracing inside of it\n * so that when our traces are exported, they are associated with the correct parent context.\n * @param {typeof internal_respond} fn\n * @returns {typeof internal_respond}\n */\nfunction propagate_context(fn) {\n\treturn async (req, ...rest) => {\n\t\tif (otel === null) {\n\t\t\treturn fn(req, ...rest);\n\t\t}\n\n\t\tconst { propagation, context } = await otel;\n\t\tconst c = propagation.extract(context.active(), Object.fromEntries(req.headers));\n\t\treturn context.with(c, async () => {\n\t\t\treturn await fn(req, ...rest);\n\t\t});\n\t};\n}\n","/**\n * @param {Record<string, string>} env\n * @param {string} allowed\n * @param {string} disallowed\n * @returns {Record<string, string>}\n */\nexport function filter_env(env, allowed, disallowed) {\n\treturn Object.fromEntries(\n\t\tObject.entries(env).filter(\n\t\t\t([k]) => k.startsWith(allowed) && (disallowed === '' || !k.startsWith(disallowed))\n\t\t)\n\t);\n}\n","/** @import { PromiseWithResolvers } from '../../utils/promise.js' */\nimport { with_resolvers } from '../../utils/promise.js';\nimport { IN_WEBCONTAINER } from './constants.js';\nimport { respond } from './respond.js';\nimport { set_private_env, set_public_env } from '../shared-server.js';\nimport { options, get_hooks } from '__SERVER__/internal.js';\nimport { DEV } from 'esm-env';\nimport { filter_env } from '../../utils/env.js';\nimport { format_server_error } from './utils.js';\nimport { set_read_implementation, set_manifest } from '__sveltekit/server';\nimport { set_app } from './app.js';\n\n/** @type {Promise<any>} */\nlet init_promise;\n\n/** @type {Promise<void> | null} */\nlet current = null;\n\nexport class Server {\n\t/** @type {import('types').SSROptions} */\n\t#options;\n\n\t/** @type {import('@sveltejs/kit').SSRManifest} */\n\t#manifest;\n\n\t/** @param {import('@sveltejs/kit').SSRManifest} manifest */\n\tconstructor(manifest) {\n\t\t/** @type {import('types').SSROptions} */\n\t\tthis.#options = options;\n\t\tthis.#manifest = manifest;\n\n\t\t// Since AsyncLocalStorage is not working in webcontainers, we don't reset `sync_store`\n\t\t// in `src/exports/internal/event.js` and handle only one request at a time.\n\t\tif (IN_WEBCONTAINER) {\n\t\t\tconst respond = this.respond.bind(this);\n\n\t\t\t/** @type {typeof respond} */\n\t\t\tthis.respond = async (...args) => {\n\t\t\t\tconst { promise, resolve } = /** @type {PromiseWithResolvers<void>} */ (with_resolvers());\n\n\t\t\t\tconst previous = current;\n\t\t\t\tcurrent = promise;\n\n\t\t\t\tawait previous;\n\t\t\t\treturn respond(...args).finally(resolve);\n\t\t\t};\n\t\t}\n\n\t\tset_manifest(manifest);\n\t}\n\n\t/**\n\t * @param {import('@sveltejs/kit').ServerInitOptions} opts\n\t */\n\tasync init({ env, read }) {\n\t\t// Take care: Some adapters may have to call `Server.init` per-request to set env vars,\n\t\t// so anything that shouldn't be rerun should be wrapped in an `if` block to make sure it hasn't\n\t\t// been done already.\n\n\t\t// set env, in case it's used in initialisation\n\t\tconst { env_public_prefix, env_private_prefix } = this.#options;\n\n\t\tset_private_env(filter_env(env, env_private_prefix, env_public_prefix));\n\t\tset_public_env(filter_env(env, env_public_prefix, env_private_prefix));\n\n\t\tif (read) {\n\t\t\t// Wrap the read function to handle MaybePromise<ReadableStream>\n\t\t\t// and ensure the public API stays synchronous\n\t\t\t/** @param {string} file */\n\t\t\tconst wrapped_read = (file) => {\n\t\t\t\tconst result = read(file);\n\t\t\t\tif (result instanceof ReadableStream) {\n\t\t\t\t\treturn result;\n\t\t\t\t} else {\n\t\t\t\t\treturn new ReadableStream({\n\t\t\t\t\t\tasync start(controller) {\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst stream = await Promise.resolve(result);\n\t\t\t\t\t\t\t\tif (!stream) {\n\t\t\t\t\t\t\t\t\tcontroller.close();\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tconst reader = stream.getReader();\n\n\t\t\t\t\t\t\t\twhile (true) {\n\t\t\t\t\t\t\t\t\tconst { done, value } = await reader.read();\n\t\t\t\t\t\t\t\t\tif (done) break;\n\t\t\t\t\t\t\t\t\tcontroller.enqueue(value);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tcontroller.close();\n\t\t\t\t\t\t\t} catch (error) {\n\t\t\t\t\t\t\t\tcontroller.error(error);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tset_read_implementation(wrapped_read);\n\t\t}\n\n\t\t// During DEV and for some adapters this function might be called in quick succession,\n\t\t// so we need to make sure we're not invoking this logic (most notably the init hook) multiple times\n\t\tawait (init_promise ??= (async () => {\n\t\t\ttry {\n\t\t\t\tconst module = await get_hooks();\n\n\t\t\t\tthis.#options.hooks = {\n\t\t\t\t\thandle: module.handle || (({ event, resolve }) => resolve(event)),\n\t\t\t\t\thandleError:\n\t\t\t\t\t\tmodule.handleError ||\n\t\t\t\t\t\t(({ status, error, event }) => {\n\t\t\t\t\t\t\tconst error_message = format_server_error(\n\t\t\t\t\t\t\t\tstatus,\n\t\t\t\t\t\t\t\t/** @type {Error} */ (error),\n\t\t\t\t\t\t\t\tevent\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tconsole.error(error_message);\n\t\t\t\t\t\t}),\n\t\t\t\t\thandleFetch: module.handleFetch || (({ request, fetch }) => fetch(request)),\n\t\t\t\t\thandleValidationError:\n\t\t\t\t\t\tmodule.handleValidationError ||\n\t\t\t\t\t\t(({ issues }) => {\n\t\t\t\t\t\t\tconsole.error('Remote function schema validation failed:', issues);\n\t\t\t\t\t\t\treturn { message: 'Bad Request' };\n\t\t\t\t\t\t}),\n\t\t\t\t\treroute: module.reroute || (() => {}),\n\t\t\t\t\ttransport: module.transport || {}\n\t\t\t\t};\n\n\t\t\t\tset_app({\n\t\t\t\t\tdecoders: module.transport\n\t\t\t\t\t\t? Object.fromEntries(Object.entries(module.transport).map(([k, v]) => [k, v.decode]))\n\t\t\t\t\t\t: {}\n\t\t\t\t});\n\n\t\t\t\tif (module.init) {\n\t\t\t\t\tawait module.init();\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tif (DEV) {\n\t\t\t\t\tthis.#options.hooks = {\n\t\t\t\t\t\thandle: () => {\n\t\t\t\t\t\t\tthrow e;\n\t\t\t\t\t\t},\n\t\t\t\t\t\thandleError: ({ error }) => console.error(error),\n\t\t\t\t\t\thandleFetch: ({ request, fetch }) => fetch(request),\n\t\t\t\t\t\thandleValidationError: () => {\n\t\t\t\t\t\t\treturn { message: 'Bad Request' };\n\t\t\t\t\t\t},\n\t\t\t\t\t\treroute: () => {},\n\t\t\t\t\t\ttransport: {}\n\t\t\t\t\t};\n\n\t\t\t\t\tset_app({\n\t\t\t\t\t\tdecoders: {}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\t\t\t}\n\t\t})());\n\t}\n\n\t/**\n\t * @param {Request} request\n\t * @param {import('types').RequestOptions} options\n\t */\n\tasync respond(request, options) {\n\t\treturn respond(request, this.#options, this.#manifest, {\n\t\t\t...options,\n\t\t\terror: false,\n\t\t\tdepth: 0\n\t\t});\n\t}\n}\n"],"names":["with_resolvers","resolve","reject","res","rej","NULL_BODY_STATUS","IN_WEBCONTAINER","SVELTE_KIT_ASSETS","ENDPOINT_METHODS","PAGE_METHODS","negotiate","accept","types","parts","str","i","match","type","subtype","q","b","accepted","min_priority","mimetype","priority","part","is_content_type","request","is_form_content_type","BINARY_FORM_CONTENT_TYPE","coalesce_to_error","err","get_status","error","HttpError","SvelteKitError","get_message","escape_html_attr_dict","escape_html_dict","surrogates","escape_html_attr_regex","escape_html_regex","escape_html","is_attr","dict","method_not_allowed","mod","method","text","allowed_methods","allowed","get_global_name","options","static_error_page","status","message","page","handle_fatal_error","event","state","body","handle_error_and_jsonify","json","with_request_store","redirect_response","location","clarify_devalue_error","serialize_uses","node","uses","has_prerendered_path","manifest","pathname","format_server_error","formatted_text","get_node_type","node_id","filename","render_endpoint","event_state","handler","prerender","response","cloned","e","Redirect","is_endpoint_request","headers","compact","arr","val","DATA_SUFFIX","HTML_DATA_SUFFIX","has_data_suffix","add_data_suffix","strip_data_suffix","ROUTE_SUFFIX","has_resolution_suffix","add_resolution_suffix","strip_resolution_suffix","noop_span","noop_span_context","record_span","name","attributes","fn","is_action_json_request","handle_action_json_request","server","actions","no_actions_error","action_json","check_named_default_separate","data","call_action","ActionFailure","stringify_action_response","action_json_redirect","check_incorrect_fail_use","redirect","init","is_action_request","handle_action_request","url","param","action","current","traced_event","merge_tracing","result","uneval_action_response","route_id","transport","replacer","thing","key","encoded","devalue","try_serialize","value","encoders","create_async_iterator","resolved","returned","deferred","transform","x","next","promise","server_data_serializer","promise_id","max_nodes","iterator","global","get_replacer","index","id","strings","payload","csp","open","close","server_data_serializer_json","reducers","load_server_data","parent","is_tracking","load","slash","make_trackable","disable_search","info","deps","dep","href","target","load_data","fetched","server_data_promise","resolve_opts","csr","server_data_node","create_universal_fetch","universal_fetch","input","cloned_body","cloned_headers","same_origin","dependency","acao","teed_body","proxy","receiver","push_fetched","is_b64","status_number","stream_to_string","a","chunk","combined","base64_encode","buffer","bytes","get","lower","stream","reader","done","text_decoder","hash","values","replacements","pattern","serialize_data","filter","prerendering","cache_control","age","varyAny","safe_payload","attrs","ttl","s","sha256","precompute","out","array","encode","w","tmp","out0","out1","out2","out3","out4","out5","out6","out7","reverse_endianness","frac","prime","is_prime","factor","c","d","text_encoder","length","size","words","generate_nonce","quoted","crypto_pattern","BaseProvider","#use_hashes","#script_needs_csp","#script_src_needs_csp","#script_src_elem_needs_csp","#style_needs_csp","#style_src_needs_csp","#style_src_attr_needs_csp","#style_src_elem_needs_csp","#directives","#script_src","#script_src_elem","#style_src","#style_src_attr","#style_src_elem","#nonce","use_hashes","directives","nonce","effective_script_src","script_src_elem","effective_style_src","style_src_attr","style_src_elem","needs_csp","directive","content","source","sha256_empty_comment_hash","is_meta","header","CspProvider","CspReportOnlyProvider","v","has_report_to","has_report_uri","Csp","mode","reportOnly","exec","params","matchers","values_needing_match","buffered","next_param","next_value","generate_route_object","route","errors","layouts","leaf","nodes","l","n","create_client_import","import_path","assets","path","get_relative_path","base","resolve_route","resolved_path","candidate","matched","decode_params","create_server_routing_response","csr_route","create_css_import","css","node_css","css_path","updated","readable","render_response","branch","page_config","action_result","data_serializer","client","modulepreloads","stylesheets","fonts","link_headers","link_tags","inline_styles","rendered","form_value","paths.base","paths.assets","base_expression","props","writable","render_opts","fetch","paths.relative","paths.override","maybe_promise","r","paths.reset","head","html","k","prefixed","style","ext","chunks","item","paths.app_dir","included_modulepreloads","tag","blocks","load_env_eagerly","properties","public_env","app_declaration","prelude","args","serialized","hydrate","stringified","indent","remote_cache","serialized_remote_data","remote","cache","create_remote_key","boot","opts","service_worker_options","init_app","http_equiv","csp_headers","csp_header","report_only_header","transformed","controller","PageNodes","layout","validate_layout_server_exports","validate_layout_exports","validate_page_server_exports","validate_page_exports","#get_option","option","respond_with_error","default_layout","ssr","server_data","handle_remote_call","handle_remote_call_internal","additional_args","remotes","form_client_refreshes","payloads","parse_remote_arg","get_result","results","arg","stringify","meta","form_data","deserialize_binary_form","serialize_refreshes","refreshes","client_refreshes","loader","handle_remote_form_post","handle_remote_form_post_internal","action_id","form","get_remote_id","app_dir","get_remote_action","MAX_DEPTH","render_page","leaf_node","remote_id","should_prerender","should_prerender_data","data_pathname","DEV","load_error","data_serializer_json","server_promises","j","load_promises","p","once","render_data","invalidated_data_nodes","trailing_slash","node_ids","invalidated","aborted","normalize_path","new_event","functions","promises","json_response","redirect_json_response","INVALID_COOKIE_CHARACTER_REGEX","validate_options","generate_cookie_key","domain","get_cookies","initial_cookies","parse","normalized_url","new_cookies","defaults","cookies","best_match","domain_matches","path_matches","lookup","existing","illegal_characters","set_internal","serialize","get_cookie_header","destination","combined_cookies","cookie","encoder","parsed","internal_queue","cookie_key","set_trailing_slash","hostname","constraint","normalized","add_cookies_to_headers","new_cookie","create_fetch","server_fetch","original_request","normalize_fetch_input","credentials","prefix","decoded","filename_html","is_asset","is_asset_html","file","read_implementation","authorization","internal_fetch","set_cookie","set_cookie_parser","remove_abort_listener","abort_promise","_","on_abort","respond","etag","get_public_env","default_transform","default_filter","default_preload","page_methods","allowed_page_methods","propagate_context","internal_respond","is_route_resolution_request","is_data_request","request_origin","TRAILING_SLASH_PARAM","INVALIDATED_PARAM","new_headers","prerendering_reroute_state","decode_pathname","page_nodes","load_page_nodes","config","root_span","resolve_span","if_none_match_value","acc","curr","vary","req","rest","filter_env","env","disallowed","init_promise","Server","#options","#manifest","previous","read","env_public_prefix","env_private_prefix","set_private_env","set_public_env","set_read_implementation","module","get_hooks","error_message","issues"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35]}